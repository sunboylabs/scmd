{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Welcome to scmd","text":"<p>AI-powered slash commands for any terminal. Works offline by default.</p> <p>scmd brings AI superpowers to your command line\u2014offline, private, and fast. Ask questions in plain English, review code with security templates, chat with AI that remembers context. All without API keys or cloud dependencies.</p> <pre><code># Just ask what you want to do\nscmd /cmd \"find files modified today\"\n# \u2192 find . -type f -mtime -1\n\n# Get instant explanations with beautiful formatting\nscmd /explain main.go\n\n# Review with professional security templates\nscmd /review auth.js --template security-review\n\n# Chat with full context retention\nscmd chat\nYou: How do I set up OAuth2 in Go?\n\ud83e\udd16 Assistant: [Detailed explanation...]\nYou: Show me an example with JWT\n\ud83e\udd16 Assistant: [Builds on previous context...]\n</code></pre>"},{"location":"#key-features","title":"\u2728 Key Features","text":"<ul> <li> <p> 100% Offline &amp; Private</p> <p>Local LLMs via llama.cpp + Qwen models. No API keys, no telemetry, your code stays on your machine. Optional cloud backends available.</p> </li> <li> <p> Smart Conversations</p> <p>Multi-turn chat with context retention, searchable history, auto-save, and markdown export. Pick up conversations anytime.</p> </li> <li> <p> Beautiful Output NEW in v0.4.3</p> <p>Markdown rendering with syntax highlighting for 40+ languages. Multiple themes, auto-detection, NO_COLOR support.</p> </li> <li> <p> Fast &amp; Lightweight</p> <p>14MB binary, 0.5B-7B models, GPU acceleration (Metal/CUDA), streaming output. Choose speed vs quality.</p> </li> <li> <p> Man Page Integration</p> <p><code>/cmd</code> reads system man pages to generate exact, copy-paste ready commands. Works with 60+ common CLI tools.</p> </li> <li> <p> Security Templates NEW in v0.4.0</p> <p>Professional code reviews with OWASP Top 10 focus. 6 built-in templates for security, performance, API design, testing, docs, and education.</p> </li> <li> <p> Repository System</p> <p>Commands install like npm packages. Discover 100+ community commands. Create and share your own.</p> </li> <li> <p> Zero Maintenance</p> <p>Auto-starts, auto-restarts, self-healing. Intelligent error handling with actionable solutions. Never need <code>pkill</code>.</p> </li> </ul>"},{"location":"#quick-start","title":"\ud83d\ude80 Quick Start","text":"<ul> <li> <p> 1. Install</p> <pre><code># Homebrew (macOS/Linux)\nbrew install sunboylabs/tap/scmd\n\n# npm (Cross-platform)\nnpm install -g scmd-cli\n\n# Shell script\ncurl -fsSL https://scmd.sh/install.sh | bash\n</code></pre> <p> Installation Guide</p> </li> <li> <p> 2. First Run</p> <pre><code>scmd /explain \"what is docker\"\n</code></pre> <p>Beautiful setup wizard appears: - Choose model preset (Fast/Balanced/Best/Premium) - Auto-download (~2 min) - Done! Works 100% offline</p> <p> Quick Start</p> </li> <li> <p> 3. Try Commands</p> <pre><code># Generate commands\nscmd /cmd \"compress directory\"\n\n# Explain code\nscmd /explain algorithm.py\n\n# Review code\nscmd /review auth.js --template security-review\n\n# Start chat\nscmd chat\n</code></pre> <p> User Guide</p> </li> <li> <p> 4. Explore</p> <pre><code># Discover 100+ commands\nscmd repo search docker\n\n# Install commands\nscmd repo install official/commit\n\n# Create your own\nscmd template create my-template\n</code></pre> <p> Command Authoring</p> </li> </ul>"},{"location":"#highlights","title":"\ud83c\udfaf Highlights","text":""},{"location":"#beautiful-markdown-output-v051","title":"Beautiful Markdown Output (v0.5.1)","text":"<p>AI responses now render with gorgeous markdown formatting, syntax highlighting, and themes:</p> <pre><code>scmd /explain quicksort.py\n\n# Output includes:\n# - Syntax-highlighted code blocks\n# - Formatted headers and lists\n# - Tables and links\n# - Theme detection (dark/light/auto)\n# - Plain text when piped\n</code></pre> <p>Performance: Lazy-loaded Glamour renderer with &lt; 1\u00b5s overhead when disabled.</p>"},{"location":"#interactive-chat-mode-v040","title":"Interactive Chat Mode (v0.4.0)","text":"<p>Multi-turn conversations with full context retention:</p> <pre><code>scmd chat\n\nYou: How do I implement rate limiting in Express?\n\ud83e\udd16 [Detailed explanation with code]\n\nYou: What about Redis-based rate limiting?\n\ud83e\udd16 [Builds on previous context...]\n\n/export  # Save to markdown\n</code></pre> <p>Features: Auto-save, searchable history, resume anytime, markdown export.</p>"},{"location":"#professional-templates-v040","title":"Professional Templates (v0.4.0)","text":"<p>Standardized code reviews with 6 built-in templates:</p> Template Focus Example security-review OWASP Top 10 <code>scmd review auth.js --template security-review</code> performance Bottlenecks, Big O <code>scmd review sort.py --template performance</code> api-design REST practices <code>scmd review api.go --template api-design</code> testing Coverage, edges <code>scmd review test.ts --template testing</code> documentation Doc generation <code>scmd explain utils.rs --template documentation</code> beginner-explain ELI5 mode <code>scmd explain recursion.go --template beginner-explain</code> <p>Create custom templates for your team. Share as YAML files.</p>"},{"location":"#man-page-integration","title":"Man Page Integration","text":"<p>The <code>/cmd</code> command reads system man pages for exact commands:</p> <pre><code>scmd /cmd \"find files modified in last 24 hours\"\n# \u2192 find . -type f -mtime -1\n\nscmd /cmd \"list processes sorted by memory\"\n# \u2192 ps aux --sort=-%mem | head -n 20\n</code></pre> <p>Detects 60+ common tools. Falls back to general CLI knowledge.</p>"},{"location":"#command-discovery-v050","title":"Command Discovery (v0.5.0)","text":"<p>100+ community commands now properly discoverable:</p> <pre><code># Search commands\nscmd repo search git\nscmd repo search docker\n\n# Install instantly\nscmd repo install official/commit\nscmd repo install official/dockerfile\n\n# Use immediately\ngit diff --staged | scmd /gc\n</code></pre> <p>Repository system fixed in v0.5.0 with legacy manifest support and parallel fetching.</p>"},{"location":"#performance","title":"\ud83d\udcca Performance","text":"<p>Real-World Benchmarks (M1 Mac, 8GB RAM):</p> Task qwen2.5-0.5b qwen2.5-1.5b qwen2.5-3b qwen2.5-7b Explain 50-line file 3.2s 5.8s 9.1s 16.3s Generate commit 2.8s 4.9s 7.5s 14.1s Review 200-line file 6.5s 11.2s 18.7s 32.4s CLI command 2.1s 3.4s 5.8s 10.2s <p>Available Models:</p> Model Size Speed Quality Best For qwen2.5-0.5b 379 MB \u26a1\u26a1\u26a1\u26a1 \u2b50\u2b50\u2b50 Quick tasks qwen2.5-1.5b \u2b50 1.0 GB \u26a1\u26a1\u26a1 \u2b50\u2b50\u2b50\u2b50 Daily work (default) qwen2.5-3b 1.9 GB \u26a1\u26a1 \u2b50\u2b50\u2b50\u2b50\u2b50 Complex analysis qwen2.5-7b 3.8 GB \u26a1 \u2b50\u2b50\u2b50\u2b50\u2b50 Production code <p>All models: 8192 token context, GPU acceleration, 4-bit quantization, function calling.</p>"},{"location":"#stability-reliability","title":"\ud83d\udee1\ufe0f Stability &amp; Reliability","text":"<p>Zero Maintenance Design:</p> <ul> <li>\u2705 Auto-starts - Server starts when needed</li> <li>\u2705 Auto-restarts - Crashes handled gracefully</li> <li>\u2705 Self-healing - Detects OOM, context mismatches, recovers automatically</li> <li>\u2705 Clear feedback - Every error includes actionable solutions</li> <li>\u2705 No manual intervention - Never need server management</li> </ul> <p>Example Error Handling:</p> <pre><code>\u274c Input exceeds available context size\n\nWhat happened:\n  Your input (5502 tokens) exceeds GPU capacity (4096 tokens)\n\nSolutions:\n  1. Use CPU mode: export SCMD_CPU_ONLY=1\n  2. Split input into smaller files\n  3. Use cloud backend: export OPENAI_API_KEY=...\n</code></pre> <p>See Stability Architecture for details.</p>"},{"location":"#use-cases","title":"\ud83c\udf1f Use Cases","text":"<ul> <li> <p> Code Explanation</p> <pre><code>scmd /explain algorithm.py\ncat main.go | scmd explain\nscmd /explain \"what are channels?\"\n</code></pre> </li> <li> <p> Code Review</p> <pre><code>scmd /review code.py\nscmd /review auth.js --template security-review\ngit diff | scmd /review\n</code></pre> </li> <li> <p>:material-terminal: Command Generation</p> <pre><code>scmd /cmd \"find large files\"\nscmd /cmd \"compress directory\"\nscmd /cmd \"list processes by memory\"\n</code></pre> </li> <li> <p> Git Workflows</p> <pre><code>git diff --staged | scmd /gc\ngit log --oneline | scmd /sum\nscmd repo install official/commit\n</code></pre> </li> <li> <p> Learning &amp; Exploration</p> <pre><code>scmd chat\nscmd /explain recursion.go --template beginner-explain\nscmd history search \"docker\"\n</code></pre> </li> <li> <p> Security Analysis</p> <pre><code>scmd /review auth.js --template security-review\nscmd /review api.go --template api-design\nscmd template create team-security\n</code></pre> </li> </ul>"},{"location":"#llm-backends","title":"\ud83d\udd27 LLM Backends","text":"Backend Local Free Setup llama.cpp \u2b50 \u2713 \u2713 Default - no setup Ollama \u2713 \u2713 <code>ollama serve</code> OpenAI \u2717 \u2717 <code>export OPENAI_API_KEY=...</code> Together.ai \u2717 Free tier <code>export TOGETHER_API_KEY=...</code> Groq \u2717 Free tier <code>export GROQ_API_KEY=...</code> <p>Backend Priority: llama.cpp (default) \u2192 Ollama \u2192 OpenAI \u2192 Together.ai \u2192 Groq</p> <pre><code># Use specific backend\nscmd -b ollama /explain main.go\nscmd -b openai -m gpt-4 /review code.py\n\n# List backends\nscmd backends\n</code></pre>"},{"location":"#documentation","title":"\ud83d\udcda Documentation","text":"<ul> <li> <p> User Guide</p> <p>Learn slash commands, model management, chat mode, templates, and repositories.</p> <p> User Guide</p> </li> <li> <p> Command Authoring</p> <p>Create custom AI commands with tools, hooks, composition, and context gathering.</p> <p> Command Authoring</p> </li> <li> <p> Architecture</p> <p>Understand scmd's design: stability, backends, repository system, and more.</p> <p> Architecture</p> </li> <li> <p> Troubleshooting</p> <p>Common issues and solutions for installation, models, and backends.</p> <p> Troubleshooting</p> </li> </ul>"},{"location":"#recent-releases","title":"\ud83d\ude80 Recent Releases","text":""},{"location":"#v051-2026-01-12","title":"v0.5.1 (2026-01-12)","text":"<ul> <li>Fixed: Streaming AI responses now use Glamour markdown renderer</li> <li>Beautiful code blocks with syntax highlighting</li> <li>Markdown headers, lists, and formatting properly rendered</li> </ul>"},{"location":"#v050-2026-01-12","title":"v0.5.0 (2026-01-12)","text":"<ul> <li>Fixed: Repository manifest parsing bug (100+ commands now discoverable)</li> <li>Added legacy manifest format support</li> <li>Enhanced command discovery UI</li> <li>Parallel manifest normalization (10 concurrent requests)</li> </ul>"},{"location":"#v043-2026-01-12","title":"v0.4.3 (2026-01-12)","text":"<ul> <li>Added: Beautiful markdown output with Glamour</li> <li>Lazy rendering (&lt; 1ns overhead when disabled)</li> <li>Syntax highlighting for 40+ languages</li> <li>Theme detection and NO_COLOR support</li> </ul>"},{"location":"#v042-2026-01-11","title":"v0.4.2 (2026-01-11)","text":"<ul> <li>Added: Template-command integration</li> <li>Official commands repository (100+ commands)</li> <li>Unified command specification</li> </ul>"},{"location":"#v041-2026-01-11","title":"v0.4.1 (2026-01-11)","text":"<ul> <li>Fixed: Replaced CGO-dependent SQLite with pure Go</li> <li>Improved cross-platform compatibility</li> </ul>"},{"location":"#v040-2026-01-10","title":"v0.4.0 (2026-01-10)","text":"<ul> <li>Added: Interactive conversation mode with SQLite persistence</li> <li>Beautiful markdown output with syntax highlighting</li> <li>Template/pattern system with 6 built-in templates</li> <li>Conversation history management</li> </ul> <p>See Changelog for full history.</p>"},{"location":"#community","title":"\ud83c\udf0d Community","text":"<ul> <li>GitHub: sunboylabs/scmd</li> <li>Issues: Report bugs or request features</li> <li>Discussions: Ask questions and share commands</li> <li>Commands Repository: sunboylabs/commands (100+ commands)</li> </ul>"},{"location":"#whats-next","title":"\ud83d\udcd6 What's Next?","text":"<ul> <li> <p> Installation</p> <p>Get scmd installed via Homebrew, npm, or packages</p> </li> <li> <p> Quick Start</p> <p>5-minute tutorial to using slash commands</p> </li> <li> <p> First Command</p> <p>Create your first custom AI command</p> </li> <li> <p> Examples</p> <p>Learn from real-world command examples</p> </li> </ul>"},{"location":"#why-scmd","title":"\ud83c\udd9a Why scmd?","text":"Traditional AI Tools scmd API keys required \u2713 Works offline by default Web interfaces \u2713 Native terminal integration Fixed prompts \u2713 Customizable command specs Isolated tools \u2713 Repository system for sharing Text generation only \u2713 Tool calling for actions No automation \u2713 Hook system Single-turn \u2713 Multi-turn chat with history Plain text \u2713 Beautiful markdown output"},{"location":"#license","title":"\ud83d\udcdc License","text":"<p>scmd is open source software licensed under the MIT License.</p> <p>Built with \u2764\ufe0f using Go \u2022 Inspired by the Unix philosophy and modern AI tooling</p>"},{"location":"STABILITY_IMPROVEMENTS/","title":"Stability Improvements Summary","text":""},{"location":"STABILITY_IMPROVEMENTS/#overview","title":"Overview","text":"<p>This document summarizes the comprehensive stability improvements made to scmd to ensure users never need to manually manage the LLM server.</p>"},{"location":"STABILITY_IMPROVEMENTS/#problem-statement","title":"Problem Statement","text":"<p>Users were experiencing: - Context size errors with large files (5502 tokens &gt; 4096 limit) - Metal GPU memory allocation issues causing server crashes - Need to manually kill and restart llama-server - Confusing error messages without clear solutions - Server reuse logic that didn't validate context size</p>"},{"location":"STABILITY_IMPROVEMENTS/#solutions-implemented","title":"Solutions Implemented","text":""},{"location":"STABILITY_IMPROVEMENTS/#1-removed-all-context-size-limits","title":"1. Removed All Context Size Limits \u2705","text":"<p>Files Modified: - <code>internal/config/defaults.go</code> - Changed default from <code>8192</code> to <code>0</code> (no limits) - <code>internal/cli/setup.go</code> - Setup wizard now uses <code>0</code> instead of <code>8192</code> - <code>internal/backend/llamacpp/model.go</code> - Uses model's native 32K context by default - <code>internal/backend/llamacpp/resources.go</code> - Removed artificial context calculations - <code>internal/cli/root.go</code> - Added <code>--context-size</code> flag for user override</p> <p>Result: - Default: Uses model's full 32K context capacity - User override: <code>scmd --context-size &lt;N&gt;</code> flag available if needed - Configuration priority: CLI flag &gt; config file &gt; model's native size</p>"},{"location":"STABILITY_IMPROVEMENTS/#2-intelligent-error-detection-hints","title":"2. Intelligent Error Detection &amp; Hints \u2705","text":"<p>Files Modified: - <code>internal/backend/llamacpp/errors.go</code> - New error handling system</p> <p>New Features: - Added <code>ErrorContextSizeExceeded</code> error type - Parse token counts from error messages (requested vs available) - Detect Metal GPU memory limitations (available &lt; 8192 = GPU issue) - Provide actionable solutions based on root cause</p> <p>Error Message Quality:</p> <p>Before: <pre><code>\u274c Inference failed\nCause: server error (HTTP 400): {...}\nSolutions:\n1. Check server logs\n2. Restart server\n</code></pre></p> <p>After: <pre><code>\u274c Input exceeds available context size\n\nCause: server error (HTTP 400): request (5502 tokens) exceeds available context size (4096 tokens)\n\nSolutions:\n1. Reduce input size (current: 5502 tokens, limit: 4096 tokens)\n2. \ud83d\udca1 GPU memory limitation detected - use CPU-only mode for larger contexts:\n3.    export SCMD_CPU_ONLY=1 &amp;&amp; pkill -9 llama-server\n4.    Then retry your command (will be slower but support full context)\n5. Split large files into smaller chunks\n6. Use cloud backend for large inputs: scmd -b openai /explain\n</code></pre></p>"},{"location":"STABILITY_IMPROVEMENTS/#3-health-check-system","title":"3. Health Check System \u2705","text":"<p>Files Modified: - <code>internal/backend/llamacpp/inference.go</code> - Added health check functions</p> <p>New Functions: - <code>CheckServerHealth(port, expectedContext)</code> - Comprehensive health validation - Returns <code>ServerHealth</code> struct with detailed status - Validates server is running and responsive - Future: Will detect context size mismatches proactively</p> <p>Health Check Flow: <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 User Command    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Health Check    \u2502\n\u2502 \u2022 Running?      \u2502\n\u2502 \u2022 Responsive?   \u2502\n\u2502 \u2022 Context OK?   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n    \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510\n    \u2502Healthy? \u2502\n    \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\n         \u2502\n    \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510\n    \u2502   YES   \u2502 NO\n    \u2502         \u2502\n    \u25bc         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Run \u2502  \u2502 Auto-    \u2502\n\u2502     \u2502  \u2502 Restart  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre></p>"},{"location":"STABILITY_IMPROVEMENTS/#4-documentation-architecture","title":"4. Documentation &amp; Architecture \u2705","text":"<p>New Files: - <code>docs/architecture/STABILITY.md</code> - Complete stability architecture documentation - <code>docs/STABILITY_IMPROVEMENTS.md</code> - This file</p> <p>Updated Files: - <code>README.md</code> - Added prominent \"Stability &amp; Reliability First\" section at top</p> <p>Key Documentation Sections: 1. Design Tenets - Zero manual intervention, clear feedback, intelligent recovery 2. Implementation Details - Health checks, error hierarchy, auto-recovery 3. Testing Strategy - Unit, integration, and user testing approaches 4. Success Metrics - Measurable goals for stability</p>"},{"location":"STABILITY_IMPROVEMENTS/#5-cpu-only-mode-support","title":"5. CPU-Only Mode Support \u2705","text":"<p>Implementation: - <code>SCMD_CPU_ONLY=1</code> environment variable - Automatically sets <code>-ngl 0</code> (no GPU layers) - Allows full 32K context when Metal can't allocate enough VRAM - Trade-off: Slower (~3-5x) but supports larger inputs</p> <p>Usage: <pre><code>export SCMD_CPU_ONLY=1\ncat large-file.go | scmd /explain\n# Works with full 32K context on CPU\n</code></pre></p>"},{"location":"STABILITY_IMPROVEMENTS/#user-experience-improvements","title":"User Experience Improvements","text":""},{"location":"STABILITY_IMPROVEMENTS/#before","title":"Before","text":"<ol> <li>User runs: <code>cat large-file.go | scmd /explain</code></li> <li>Gets error: \"request exceeds context size (4096)\"</li> <li>Confused - why only 4096 when config says 8192?</li> <li>Has to manually: <code>pkill -9 llama-server</code></li> <li>Try again, same error</li> <li>Eventually gives up or searches documentation</li> </ol>"},{"location":"STABILITY_IMPROVEMENTS/#after","title":"After","text":"<ol> <li>User runs: <code>cat large-file.go | scmd /explain</code></li> <li>Gets clear error with root cause detection</li> <li>Sees exact solution: <code>export SCMD_CPU_ONLY=1</code></li> <li>Copies command, runs it</li> <li>Works immediately with full 32K context</li> <li>User understands trade-off (slower but works)</li> </ol>"},{"location":"STABILITY_IMPROVEMENTS/#technical-details","title":"Technical Details","text":""},{"location":"STABILITY_IMPROVEMENTS/#context-size-flow","title":"Context Size Flow","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Model Metadata (model.go)            \u2502\n\u2502 qwen2.5-1.5b: ContextSize = 32768    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n               \u2502\n               \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Backend Initialization (model.go)    \u2502\n\u2502 \u2022 Reads model's native context       \u2502\n\u2502 \u2022 Uses 32768 unless overridden       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n               \u2502\n               \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Server Startup (inference.go)        \u2502\n\u2502 \u2022 Starts with: -c 32768              \u2502\n\u2502 \u2022 Metal tries to allocate KV cache   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n               \u2502\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u2502 Success?    \u2502\n        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n               \u2502\n      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n      \u2502 YES         NO  \u2502\n      \u2502                 \u2502\n      \u25bc                 \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Full 32K \u2502    \u2502 Metal OOM     \u2502\n\u2502 Context  \u2502    \u2502 Falls back to \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502 4096 or less  \u2502\n                \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                        \u2502\n                        \u25bc\n                \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                \u2502 Error Handler \u2502\n                \u2502 Detects &lt; 8K  \u2502\n                \u2502 Suggests CPU  \u2502\n                \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"STABILITY_IMPROVEMENTS/#error-detection-logic","title":"Error Detection Logic","text":"<pre><code>// ParseError in errors.go\nif strings.Contains(errStr, \"exceed_context_size_error\") {\n    // Extract token counts\n    requestedTokens := 5502  // from error\n    availableTokens := 4096  // from error\n\n    // Detect Metal limitation\n    if availableTokens &lt; 8192 {\n        return NewContextSizeExceededError(err, requestedTokens, availableTokens)\n        // Includes CPU-only mode hint\n    }\n}\n</code></pre>"},{"location":"STABILITY_IMPROVEMENTS/#known-limitations-future-work","title":"Known Limitations &amp; Future Work","text":""},{"location":"STABILITY_IMPROVEMENTS/#current-limitations","title":"Current Limitations","text":"<ol> <li>Server Reuse - Server reuse doesn't validate context size matches</li> <li>Impact: If server crashes and restarts with different context, error occurs</li> <li>Workaround: Error message tells user to use CPU-only mode</li> <li> <p>Future Fix: Add context size to reuse validation (line 92 in inference.go)</p> </li> <li> <p>Metal Instability - Metal can crash and restart server silently</p> </li> <li>Impact: Server reports different context than configured</li> <li>Workaround: CPU-only mode bypasses Metal</li> <li> <p>Future Fix: Add health monitoring to detect crashes</p> </li> <li> <p>Manual pkill - Error messages still suggest <code>pkill</code> command</p> </li> <li>Impact: Users need one manual command</li> <li>Workaround: Clear instructions provided</li> <li>Future Fix: Auto-restart server when health check fails</li> </ol>"},{"location":"STABILITY_IMPROVEMENTS/#future-enhancements","title":"Future Enhancements","text":"<ol> <li>Proactive Health Checks (Priority: HIGH)</li> <li>Check server health before every inference request</li> <li>Auto-restart if context mismatch detected</li> <li> <p>No user intervention needed</p> </li> <li> <p>Automatic Fallback (Priority: MEDIUM)</p> </li> <li>If GPU fails repeatedly, auto-enable CPU mode</li> <li>Inform user of performance impact</li> <li> <p>Remember preference for session</p> </li> <li> <p>Context Size Validation (Priority: HIGH)</p> </li> <li>Compare server's actual n_ctx with expected</li> <li>Restart server if mismatch detected</li> <li> <p>Clear feedback about what happened</p> </li> <li> <p>Smart Recovery (Priority: MEDIUM)</p> </li> <li>Track error patterns (3 GPU OOM errors \u2192 suggest CPU mode)</li> <li>Auto-reduce context size if needed</li> <li> <p>Provide proactive suggestions</p> </li> <li> <p>Server Lifecycle Management (Priority: LOW)</p> </li> <li>Keep server running between commands</li> <li>Smart shutdown after idle period</li> <li>Reduce startup overhead</li> </ol>"},{"location":"STABILITY_IMPROVEMENTS/#testing-checklist","title":"Testing Checklist","text":"<ul> <li> Context size errors show helpful messages</li> <li> GPU memory limitation detected correctly</li> <li> CPU-only mode works with full context</li> <li> Error messages include exact commands</li> <li> Documentation updated (README, STABILITY.md)</li> <li> Health check auto-restarts unhealthy server</li> <li> Context mismatch detected and fixed automatically</li> <li> E2E tests for error scenarios</li> <li> User testing with non-technical users</li> </ul>"},{"location":"STABILITY_IMPROVEMENTS/#success-metrics","title":"Success Metrics","text":""},{"location":"STABILITY_IMPROVEMENTS/#target-goals","title":"Target Goals","text":"<ul> <li>Zero manual server management: Users never use <code>pkill</code> or manual restarts</li> <li>Current: Users need one <code>export + pkill</code> command for GPU issues</li> <li> <p>Target: Fully automatic with no manual commands</p> </li> <li> <p>Clear feedback: 100% of errors include actionable next steps</p> </li> <li>Current: \u2705 Achieved - All errors have solutions</li> <li> <p>Target: \u2705 Complete</p> </li> <li> <p>Auto-recovery: 90%+ of issues resolved without user intervention</p> </li> <li>Current: ~40% (GPU issues need manual CPU mode)</li> <li> <p>Target: Auto-detect and enable CPU mode</p> </li> <li> <p>User confidence: Users trust the system will handle server issues</p> </li> <li>Current: Users understand what to do when errors occur</li> <li>Target: Users never think about the server</li> </ul>"},{"location":"STABILITY_IMPROVEMENTS/#conclusion","title":"Conclusion","text":"<p>We've made significant progress toward stability-first UX:</p> <p>\u2705 Completed: - Removed all artificial context limits - Intelligent error detection with root cause analysis - Clear, actionable error messages - CPU-only mode for GPU memory issues - Comprehensive documentation - Prominent README section on stability</p> <p>\ud83d\udea7 In Progress: - Health check system (foundation in place) - Auto-restart logic (planned)</p> <p>\ud83d\udccb Next Steps: 1. Implement proactive health checks before inference 2. Add automatic server restart on health check failures 3. Remove need for manual <code>pkill</code> commands 4. Add E2E tests for error scenarios 5. User testing with stability scenarios</p> <p>The foundation is solid - users now have clear guidance and workarounds. The next phase will eliminate manual intervention entirely.</p>"},{"location":"architecture/","title":"scmd Architecture","text":""},{"location":"architecture/#overview","title":"Overview","text":"<p>scmd uses a repository-first architecture that separates the core tool from the commands it runs. Think of it like a package manager (npm, pip, Homebrew) for AI-powered commands.</p>"},{"location":"architecture/#design-philosophy","title":"Design Philosophy","text":""},{"location":"architecture/#core-principles","title":"Core Principles","text":"<ol> <li>Small Core, Big Ecosystem</li> <li>Minimal built-in functionality (~14MB binary)</li> <li>Commands distributed through repositories</li> <li> <p>Community-driven command library</p> </li> <li> <p>Offline-First</p> </li> <li>Works without network after initial setup</li> <li>Local model inference with llama.cpp</li> <li> <p>Commands cached locally after installation</p> </li> <li> <p>Decentralized &amp; Flexible</p> </li> <li>Anyone can create command repositories</li> <li>No central authority required</li> <li> <p>Teams can host private repositories</p> </li> <li> <p>Reproducible &amp; Shareable</p> </li> <li>Lockfiles ensure consistent command versions</li> <li>Commands have explicit dependencies</li> <li>Team members use identical setups</li> </ol>"},{"location":"architecture/#architecture-layers","title":"Architecture Layers","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              User Interface                      \u2502\n\u2502  - CLI flags and arguments                       \u2502\n\u2502  - Slash command syntax (/explain, /review)      \u2502\n\u2502  - Shell integration (Bash, Zsh, Fish)          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                      \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502            Command Layer                         \u2502\n\u2502  - Built-in: /explain                            \u2502\n\u2502  - Repository-based: /review, /commit, etc.      \u2502\n\u2502  - Custom: user-defined commands                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                      \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         Repository System                        \u2502\n\u2502  - Command discovery and search                  \u2502\n\u2502  - Manifest parsing and validation               \u2502\n\u2502  - Dependency resolution                         \u2502\n\u2502  - Version management                            \u2502\n\u2502  - Local caching                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                      \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502          Backend Layer                           \u2502\n\u2502  - llama.cpp (default, offline)                  \u2502\n\u2502  - Ollama (local, optional)                      \u2502\n\u2502  - OpenAI, Groq, Together.ai (cloud)             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                      \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              LLM Models                          \u2502\n\u2502  - Local: Qwen models (GGUF format)              \u2502\n\u2502  - Cloud: GPT-4, Claude, Llama, etc.             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/#why-repository-first","title":"Why Repository-First?","text":""},{"location":"architecture/#the-problem","title":"The Problem","text":"<p>Traditional approaches bundle all commands into the binary: - \u274c Large binary size - \u274c Slow updates (need to rebuild entire tool) - \u274c Limited to developer-provided commands - \u274c No community contributions without forking</p>"},{"location":"architecture/#the-solution","title":"The Solution","text":"<p>Repository-first architecture: - \u2705 Small binary (~14MB vs 100MB+) - \u2705 Commands update independently - \u2705 Community can create and share commands - \u2705 Teams can create private repositories - \u2705 Reproducible with lockfiles</p>"},{"location":"architecture/#comparison","title":"Comparison","text":"Aspect Monolithic Repository-First (scmd) Binary size 100-500MB 14MB Built-in commands 50-100 1 (explain) Update speed Rebuild entire tool Update individual commands Community contributions Requires fork + PR Publish to any repository Private commands Not possible Host your own repository Version control Single version Per-command versions Offline capability All bundled Cached after install"},{"location":"architecture/#component-details","title":"Component Details","text":""},{"location":"architecture/#1-built-in-commands","title":"1. Built-in Commands","text":"<p>Only one command is built into the scmd binary:</p> <p><code>/explain</code> - Explain code or concepts - Rationale: Core functionality needed for first-run experience - Zero dependencies - Demonstrates core capabilities - Works offline immediately after model download</p>"},{"location":"architecture/#2-repository-system","title":"2. Repository System","text":"<p>Commands are distributed through Git repositories or HTTP endpoints.</p> <p>Repository Structure: <pre><code>my-commands/\n\u251c\u2500\u2500 scmd-repo.yaml          # Manifest\n\u2514\u2500\u2500 commands/\n    \u251c\u2500\u2500 review.yaml\n    \u251c\u2500\u2500 commit.yaml\n    \u2514\u2500\u2500 fix.yaml\n</code></pre></p> <p>Manifest (scmd-repo.yaml): <pre><code>name: my-commands\nversion: \"1.0.0\"\ndescription: Custom AI commands\nauthor: Your Team\n\ncommands:\n  - name: review\n    description: Review code for issues\n    file: commands/review.yaml\n    version: \"1.2.0\"\n\n  - name: commit\n    description: Generate commit messages\n    file: commands/commit.yaml\n    version: \"1.0.0\"\n</code></pre></p> <p>Command Definition (commands/review.yaml): <pre><code>name: review\nversion: \"1.2.0\"\ndescription: Review code for issues and improvements\ncategory: code-quality\nauthor: scmd team\n\ndependencies:\n  - command: official/explain\n    version: \"&gt;=1.0.0\"\n\nargs:\n  - name: severity\n    description: Minimum severity (low, medium, high)\n    default: medium\n\nprompt:\n  system: |\n    You are an expert code reviewer.\n    Focus on bugs, security issues, and best practices.\n\n  template: |\n    Review this code for issues:\n    {{.stdin}}\n\n    Minimum severity: {{.severity}}\n\n    Provide specific suggestions with line numbers.\n\nmodel:\n  temperature: 0.3\n  max_tokens: 1024\n</code></pre></p>"},{"location":"architecture/#3-command-lifecycle","title":"3. Command Lifecycle","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Discover  \u2502  scmd repo search \"git\"\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    Show     \u2502  scmd repo show official/commit\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Install   \u2502  scmd repo install official/commit\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  - Downloads YAML\n       \u2502         - Resolves dependencies\n       \u2502         - Validates command\n       \u2502         - Caches locally (~/.scmd/commands/)\n       \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502     Use     \u2502  scmd /commit\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n       \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Update    \u2502  scmd update --check\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  scmd update official/commit\n       \u2502\n       \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Remove    \u2502  scmd repo uninstall official/commit\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/#4-backend-abstraction","title":"4. Backend Abstraction","text":"<p>scmd supports multiple LLM backends through a unified interface:</p> <pre><code>type Backend interface {\n    Name() string\n    IsAvailable(ctx context.Context) (bool, error)\n    Complete(ctx context.Context, req *CompletionRequest) (*CompletionResponse, error)\n    Stream(ctx context.Context, req *CompletionRequest) (&lt;-chan StreamChunk, error)\n    ModelInfo() ModelInfo\n}\n</code></pre> <p>Backend Priority: 1. llama.cpp - Default, offline, auto-starts server 2. Ollama - If running on localhost 3. Groq - If GROQ_API_KEY set (fast, free tier) 4. OpenAI - If OPENAI_API_KEY set 5. Together.ai - If TOGETHER_API_KEY set</p> <p>This allows users to: - Start with offline llama.cpp - Switch to cloud providers for better quality - Fall back to alternative backends if one fails</p>"},{"location":"architecture/#5-local-storage","title":"5. Local Storage","text":"<pre><code>~/.scmd/\n\u251c\u2500\u2500 config.yaml              # User configuration\n\u251c\u2500\u2500 scmd.lock               # Lockfile for reproducibility\n\u251c\u2500\u2500 models/                 # Downloaded LLM models\n\u2502   \u251c\u2500\u2500 qwen2.5-1.5b-q4_k_m.gguf\n\u2502   \u2514\u2500\u2500 qwen2.5-3b-q4_k_m.gguf\n\u251c\u2500\u2500 commands/               # Installed commands\n\u2502   \u251c\u2500\u2500 official/\n\u2502   \u2502   \u251c\u2500\u2500 review.yaml\n\u2502   \u2502   \u2514\u2500\u2500 commit.yaml\n\u2502   \u2514\u2500\u2500 custom/\n\u2502       \u2514\u2500\u2500 my-command.yaml\n\u251c\u2500\u2500 repos/                  # Repository manifests\n\u2502   \u251c\u2500\u2500 official.yaml\n\u2502   \u2514\u2500\u2500 custom.yaml\n\u251c\u2500\u2500 cache/                  # Temporary cache\n\u2514\u2500\u2500 logs/                   # Server logs\n    \u2514\u2500\u2500 llama-server.log\n</code></pre>"},{"location":"architecture/#advanced-features","title":"Advanced Features","text":""},{"location":"architecture/#1-command-dependencies","title":"1. Command Dependencies","text":"<p>Commands can depend on other commands:</p> <pre><code>dependencies:\n  - command: official/explain\n    version: \"&gt;=1.0.0\"\n  - command: official/summarize\n    version: \"^1.2.0\"\n    optional: true\n</code></pre> <p>When installing a command, scmd: 1. Resolves all dependencies 2. Installs missing commands 3. Validates version constraints 4. Builds dependency graph 5. Detects circular dependencies</p>"},{"location":"architecture/#2-command-composition","title":"2. Command Composition","text":"<p>Chain commands together:</p> <pre><code>compose:\n  pipeline:\n    - command: explain\n      output: explanation\n    - command: summarize\n      input: \"{{.explanation}}\"\n      args:\n        length: short\n</code></pre>"},{"location":"architecture/#3-lockfiles","title":"3. Lockfiles","text":"<p>Ensure reproducible installations:</p> <pre><code># scmd.lock\nversion: \"1.0.0\"\ncommands:\n  - name: official/review\n    version: \"1.2.3\"\n    checksum: sha256:abc123...\n    dependencies:\n      - name: official/explain\n        version: \"1.0.0\"\n        checksum: sha256:def456...\n</code></pre> <p>Team workflow: <pre><code># Developer 1: Install and lock\nscmd repo install official/review\nscmd lock generate\n\n# Commit scmd.lock to git\ngit add scmd.lock\ngit commit -m \"Lock scmd commands\"\n\n# Developer 2: Install from lockfile\nscmd lock install  # Installs exact versions\n</code></pre></p>"},{"location":"architecture/#4-private-repositories","title":"4. Private Repositories","text":"<p>Host your own command repository:</p> <pre><code># Self-hosted (GitHub, GitLab, etc.)\nscmd repo add mycompany https://github.com/mycompany/scmd-commands/raw/main\n\n# HTTP server\nscmd repo add internal http://internal.company.com/scmd-repo.yaml\n\n# Local filesystem (for development)\nscmd repo add local file:///path/to/repo\n</code></pre>"},{"location":"architecture/#design-decisions","title":"Design Decisions","text":""},{"location":"architecture/#why-only-one-built-in-command","title":"Why Only One Built-in Command?","text":"<p>Rationale: - Keeps binary small and focused - Forces dogfooding of repository system - Prevents feature creep - Encourages community contributions</p> <p>Why <code>/explain</code>? - Core use case: understanding code - Demonstrates core capabilities - Useful immediately after install - No external dependencies - Good first-time user experience</p>"},{"location":"architecture/#why-yaml-for-commands","title":"Why YAML for Commands?","text":"<p>Considered alternatives: - JSON: Too verbose, no comments - TOML: Less familiar, limited nesting - Custom DSL: Learning curve, tooling overhead</p> <p>YAML chosen for: - Human-readable and editable - Good for templates (multiline strings) - Familiar to developers - Rich ecosystem of parsers - Comments and anchors support</p>"},{"location":"architecture/#why-not-plugin-system","title":"Why Not Plugin System?","text":"<p>Plugins (compiled binaries) rejected because: - Security concerns (arbitrary code execution) - Platform-specific binaries needed - Larger download sizes - Complex build process - Harder to audit</p> <p>YAML commands preferred: - Safe (declarative, no code execution) - Cross-platform - Small (few KB vs MB) - Easy to audit and review - Shareable as text</p>"},{"location":"architecture/#migration-from-earlier-versions","title":"Migration from Earlier Versions","text":"<p>If you used scmd before the repository-first architecture:</p>"},{"location":"architecture/#before-monolithic","title":"Before (Monolithic)","text":"<pre><code>scmd /review code.py    # Built-in command\nscmd /commit            # Built-in command\nscmd /fix error.log     # Built-in command\n</code></pre>"},{"location":"architecture/#after-repository-first","title":"After (Repository-First)","text":"<pre><code># Only /explain is built-in\nscmd /explain code.py   # \u2713 Works immediately\n\n# Install other commands\nscmd repo add official https://github.com/scmd/commands/raw/main\nscmd repo install official/review\nscmd repo install official/commit\nscmd repo install official/fix\n\n# Now use them\nscmd /review code.py    # \u2713 Works after install\nscmd /commit            # \u2713 Works after install\nscmd /fix error.log     # \u2713 Works after install\n</code></pre>"},{"location":"architecture/#benefits-of-migration","title":"Benefits of Migration","text":"<ul> <li>\u2705 Smaller binary size (500MB \u2192 14MB)</li> <li>\u2705 Faster updates (update individual commands)</li> <li>\u2705 Better version control (per-command versions)</li> <li>\u2705 Community can contribute commands</li> <li>\u2705 Team-specific private commands</li> </ul>"},{"location":"architecture/#future-directions","title":"Future Directions","text":""},{"location":"architecture/#planned-enhancements","title":"Planned Enhancements","text":"<ol> <li>Command Marketplace</li> <li>Central registry of commands</li> <li>Ratings and reviews</li> <li>Usage statistics</li> <li> <p>Featured commands</p> </li> <li> <p>Command Playground</p> </li> <li>Test commands before installing</li> <li>Interactive prompt editor</li> <li> <p>Preview results</p> </li> <li> <p>Enhanced Discovery</p> </li> <li>Semantic search (embeddings)</li> <li>Command recommendations</li> <li>Trending commands</li> <li> <p>Category browsing</p> </li> <li> <p>Enterprise Features</p> </li> <li>Private registry support</li> <li>Access control</li> <li>Audit logs</li> <li>Compliance checks</li> </ol>"},{"location":"architecture/#contributing","title":"Contributing","text":""},{"location":"architecture/#creating-commands","title":"Creating Commands","text":"<ol> <li>Fork the official commands repository</li> <li>Add your command YAML file</li> <li>Update the manifest</li> <li>Test locally: <code>scmd repo add local file:///path/to/repo</code></li> <li>Submit a PR</li> </ol>"},{"location":"architecture/#creating-repositories","title":"Creating Repositories","text":"<ol> <li>Create repository structure (scmd-repo.yaml + commands/)</li> <li>Host on GitHub, GitLab, or any HTTP server</li> <li>Share the repository URL</li> <li>Submit to scmd registry for discovery</li> </ol>"},{"location":"architecture/#conclusion","title":"Conclusion","text":"<p>The repository-first architecture enables: - Small core tool with focused functionality - Vibrant ecosystem of community commands - Flexible deployment (public, private, local) - Reproducible environments with lockfiles - Independent updates without tool rebuilds</p> <p>This design scales from individual developers to large teams, from hobbyist projects to enterprise deployments.</p> <p>Last Updated: January 2026 scmd Version: 1.0.0</p> <p>For questions or suggestions, please open an issue.</p>"},{"location":"template-command-integration/","title":"Template and Command Integration (v0.4.2)","text":"<p>This document describes the integration between slash commands and templates in scmd v0.4.2, enabling powerful template-based command execution with variable mapping.</p>"},{"location":"template-command-integration/#overview","title":"Overview","text":"<p>Commands can now reference templates in three ways: 1. Direct prompts (existing): Uses the <code>Prompt</code> field directly 2. Template reference: References an existing template by name 3. Inline template: Defines a template inline within the command spec</p> <p>This integration allows: - Reusable templates across multiple commands - Variable mapping from command context to template variables - Automatic context population (file content, language detection, etc.) - Repository-based template distribution - Full backward compatibility with existing prompt-based commands</p>"},{"location":"template-command-integration/#commandspec-changes","title":"CommandSpec Changes","text":""},{"location":"template-command-integration/#new-fields","title":"New Fields","text":"<pre><code>type CommandSpec struct {\n    // ... existing fields ...\n\n    // Template integration (NEW in v0.4.2)\n    Template *TemplateRef `yaml:\"template,omitempty\" json:\"template,omitempty\"`\n}\n\ntype TemplateRef struct {\n    // Name of the template to use (references ~/.scmd/templates/&lt;name&gt;.yaml)\n    Name string `yaml:\"name,omitempty\" json:\"name,omitempty\"`\n\n    // Variables to map from command context to template variables\n    // Keys are template variable names, values are command context references\n    // e.g., \"Language\": \"{{.file_extension}}\", \"Code\": \"{{.file_content}}\"\n    Variables map[string]string `yaml:\"variables,omitempty\" json:\"variables,omitempty\"`\n\n    // Inline template definition (alternative to referencing by name)\n    Inline *InlineTemplate `yaml:\"inline,omitempty\" json:\"inline,omitempty\"`\n}\n\ntype InlineTemplate struct {\n    SystemPrompt       string            `yaml:\"system_prompt,omitempty\"`\n    UserPromptTemplate string            `yaml:\"user_prompt_template\"`\n    Variables          []TemplateVariable `yaml:\"variables,omitempty\"`\n}\n</code></pre>"},{"location":"template-command-integration/#manifest-changes","title":"Manifest Changes","text":"<p>Repository manifests can now include templates:</p> <pre><code>name: my-repo\nversion: 1.0.0\ndescription: My command repository\ncommands:\n  - path: commands/review.yaml\n  - path: commands/analyze.yaml\ntemplates:\n  - path: templates/security-review.yaml\n  - path: templates/performance-analysis.yaml\n</code></pre>"},{"location":"template-command-integration/#usage-examples","title":"Usage Examples","text":""},{"location":"template-command-integration/#example-1-command-with-template-reference","title":"Example 1: Command with Template Reference","text":"<pre><code># security-audit.yaml\nname: security-audit\nversion: 1.0.0\ndescription: Security audit using OWASP template\ncategory: security\n\nargs:\n  - name: file\n    description: File to audit\n    required: true\n\nflags:\n  - name: additional-context\n    description: Additional context for the audit\n\ntemplate:\n  name: security-review  # References ~/.scmd/templates/security-review.yaml\n  variables:\n    Language: \"{{.file_extension}}\"  # Auto-detected from file argument\n    Code: \"{{.file_content}}\"        # Populated from stdin\n    Context: \"{{.additional_context}}\"  # Maps flag to template variable\n\nmodel:\n  preferred: qwen2.5-7b\n  temperature: 0.3\n</code></pre> <p>Usage: <pre><code># Audit a file\ncat auth.js | scmd security-audit auth.js\n\n# With additional context\ncat auth.js | scmd security-audit auth.js --additional-context \"JWT authentication system\"\n</code></pre></p>"},{"location":"template-command-integration/#example-2-command-with-inline-template","title":"Example 2: Command with Inline Template","text":"<pre><code># quick-review.yaml\nname: quick-review\nversion: 1.0.0\ndescription: Quick code review with inline template\ncategory: review\n\nargs:\n  - name: file\n    description: File to review\n    required: true\n\ntemplate:\n  inline:\n    system_prompt: |\n      You are an experienced code reviewer.\n      Focus on code quality, best practices, and potential bugs.\n\n    user_prompt_template: |\n      Review this {{.Language}} code:\n\n      ```{{.Language}}\n      {{.Code}}\n      ```\n\n      Provide:\n      1. Overall code quality assessment\n      2. Potential bugs or issues\n      3. Suggestions for improvement\n\n    variables:\n      - name: Language\n        description: Programming language\n        default: unknown\n\n      - name: Code\n        description: Code to review\n        required: true\n</code></pre> <p>Usage: <pre><code># Review a Python file\ncat script.py | scmd quick-review script.py\n</code></pre></p>"},{"location":"template-command-integration/#example-3-repository-with-templates","title":"Example 3: Repository with Templates","text":"<p>Repository structure: <pre><code>my-repo/\n\u251c\u2500\u2500 scmd-repo.yaml\n\u251c\u2500\u2500 commands/\n\u2502   \u251c\u2500\u2500 security-audit.yaml\n\u2502   \u2514\u2500\u2500 perf-analyze.yaml\n\u2514\u2500\u2500 templates/\n    \u251c\u2500\u2500 owasp-security.yaml\n    \u2514\u2500\u2500 performance.yaml\n</code></pre></p> <p>scmd-repo.yaml: <pre><code>name: security-tools\nversion: 1.0.0\ndescription: Security audit commands and templates\n\ncommands:\n  - name: security-audit\n    description: Security audit with OWASP focus\n    file: commands/security-audit.yaml\n\n  - name: perf-analyze\n    description: Performance analysis\n    file: commands/perf-analyze.yaml\n\ntemplates:\n  - path: templates/owasp-security.yaml\n  - path: templates/performance.yaml\n</code></pre></p> <p>Installation: <pre><code># Add repository\nscmd repo add security https://github.com/org/security-tools/raw/main\n\n# Install command (automatically installs referenced templates)\nscmd repo install security/security-audit\n\n# Use the command\ncat auth.js | scmd security-audit auth.js\n</code></pre></p>"},{"location":"template-command-integration/#automatic-variable-mapping","title":"Automatic Variable Mapping","text":"<p>The template executor automatically provides these context variables:</p> Variable Description Example <code>{{.arg_name}}</code> Command argument by name <code>{{.file}}</code> <code>{{.flag_name}}</code> Command flag by name <code>{{.verbose}}</code> <code>{{.stdin}}</code> Content from stdin Full file content <code>{{.input}}</code> Alias for stdin Same as <code>{{.stdin}}</code> <code>{{.file_content}}</code> Alias for stdin (commonly used for code) Same as <code>{{.stdin}}</code> <code>{{.file_extension}}</code> Auto-detected from file argument <code>go</code>, <code>py</code>, <code>js</code> <code>{{.Language}}</code> Full language name from extension <code>Go</code>, <code>Python</code>, <code>JavaScript</code> <code>{{.args}}</code> Array of all positional arguments <code>[\"file1\", \"file2\"]</code> <code>{{.all_args}}</code> All args as space-separated string <code>file1 file2</code>"},{"location":"template-command-integration/#language-detection","title":"Language Detection","text":"<p>The executor automatically detects the programming language from file extensions:</p> Extension Language <code>.go</code> Go <code>.py</code> Python <code>.js</code> JavaScript <code>.ts</code> TypeScript <code>.java</code> Java <code>.c</code> C <code>.cpp</code>, <code>.cc</code>, <code>.cxx</code> C++ <code>.rs</code> Rust <code>.rb</code> Ruby <code>.php</code> PHP <code>.sh</code>, <code>.bash</code> Bash <code>.sql</code> SQL <code>.yaml</code>, <code>.yml</code> YAML <code>.json</code> JSON <code>.html</code> HTML <code>.css</code> CSS <code>.md</code> Markdown"},{"location":"template-command-integration/#template-variable-resolution","title":"Template Variable Resolution","text":"<p>Variables can be:</p> <ol> <li>Direct values: <code>\"Language\": \"Python\"</code></li> <li>Template expressions: <code>\"Code\": \"{{.file_content}}\"</code></li> <li>Chained references: <code>\"Language\": \"{{.Language}}\"</code> (uses auto-detected)</li> </ol> <p>Example: <pre><code>template:\n  name: security-review\n  variables:\n    Language: \"{{.file_extension}}\"   # Auto-detected: \"py\"\n    Code: \"{{.file_content}}\"         # From stdin\n    Context: \"{{.context}}\"           # From --context flag\n    Framework: \"Django\"               # Direct value\n</code></pre></p>"},{"location":"template-command-integration/#validation","title":"Validation","text":"<p>Template references are validated on command installation:</p> <ol> <li>Mutual exclusivity: Must specify either <code>name</code> OR <code>inline</code>, not both</li> <li>Required fields: Inline templates must have <code>user_prompt_template</code></li> <li>Variable names: Inline template variables must have names</li> <li>Template existence: Named templates must exist when referenced (warning only)</li> </ol> <p>Example validation: <pre><code># INVALID - both name and inline\ntemplate:\n  name: security-review\n  inline:\n    user_prompt_template: \"...\"  # Error: cannot specify both\n\n# INVALID - no user prompt\ntemplate:\n  inline:\n    system_prompt: \"...\"  # Error: user_prompt_template required\n\n# VALID - named template\ntemplate:\n  name: security-review\n  variables:\n    Code: \"{{.file_content}}\"\n\n# VALID - inline template\ntemplate:\n  inline:\n    user_prompt_template: \"Review: {{.Code}}\"\n    variables:\n      - name: Code\n        required: true\n</code></pre></p>"},{"location":"template-command-integration/#backward-compatibility","title":"Backward Compatibility","text":"<p>Commands without templates continue to work as before:</p> <pre><code># Old-style command (still works)\nname: old-command\nversion: 1.0.0\ndescription: Legacy command\nprompt:\n  system: \"You are a helpful assistant\"\n  template: \"Answer: {{.input}}\"\n</code></pre> <p>The executor checks for templates first, then falls back to the <code>prompt</code> field: 1. If <code>template</code> is present \u2192 use template executor 2. If <code>compose</code> is present \u2192 use composer 3. Otherwise \u2192 use prompt-based execution (legacy)</p>"},{"location":"template-command-integration/#best-practices","title":"Best Practices","text":""},{"location":"template-command-integration/#1-template-organization","title":"1. Template Organization","text":"<pre><code>~/.scmd/\n\u251c\u2500\u2500 config.yaml\n\u251c\u2500\u2500 templates/\n\u2502   \u251c\u2500\u2500 security/\n\u2502   \u2502   \u251c\u2500\u2500 owasp-review.yaml\n\u2502   \u2502   \u2514\u2500\u2500 crypto-analysis.yaml\n\u2502   \u251c\u2500\u2500 performance/\n\u2502   \u2502   \u251c\u2500\u2500 complexity-analysis.yaml\n\u2502   \u2502   \u2514\u2500\u2500 profiling.yaml\n\u2502   \u2514\u2500\u2500 documentation/\n\u2502       \u251c\u2500\u2500 api-docs.yaml\n\u2502       \u2514\u2500\u2500 readme-gen.yaml\n</code></pre>"},{"location":"template-command-integration/#2-variable-naming-conventions","title":"2. Variable Naming Conventions","text":"<ul> <li>Use <code>PascalCase</code> for template variables: <code>Language</code>, <code>Code</code>, <code>Context</code></li> <li>Use <code>snake_case</code> for command context: <code>file_content</code>, <code>file_extension</code></li> <li>Document expected variables in template metadata</li> </ul>"},{"location":"template-command-integration/#3-template-reusability","title":"3. Template Reusability","text":"<p>Create generic templates that work across multiple commands:</p> <pre><code># templates/code-review-base.yaml\nname: code-review-base\nversion: 1.0.0\ndescription: Base template for code reviews\ncompatible_commands: [\"review\", \"audit\", \"analyze\"]\n\nsystem_prompt: |\n  You are an experienced code reviewer.\n\nuser_prompt_template: |\n  Review this {{.Language}} code:\n\n  {{.Code}}\n\n  {{if .Focus}}\n  Focus on: {{.Focus}}\n  {{end}}\n\n  {{if .Context}}\n  Additional context: {{.Context}}\n  {{end}}\n\nvariables:\n  - name: Language\n    required: true\n  - name: Code\n    required: true\n  - name: Focus\n    required: false\n  - name: Context\n    required: false\n</code></pre>"},{"location":"template-command-integration/#4-command-composition","title":"4. Command Composition","text":"<p>Combine template-based commands with composition:</p> <pre><code>name: full-security-audit\nversion: 1.0.0\ndescription: Complete security audit with multiple checks\n\ntemplate:\n  name: security-review\n  variables:\n    Code: \"{{.file_content}}\"\n    Language: \"{{.file_extension}}\"\n\ncompose:\n  pipeline:\n    - command: vulnerability-scan\n    - command: dependency-check\n    - command: security-review\n\nhooks:\n  post:\n    - shell: \"echo 'Audit complete'\"\n</code></pre>"},{"location":"template-command-integration/#troubleshooting","title":"Troubleshooting","text":""},{"location":"template-command-integration/#template-not-found","title":"Template Not Found","text":"<pre><code>Error: template security-review not found\n</code></pre> <p>Solution: 1. Check template exists: <code>scmd template list</code> 2. Verify template name matches exactly 3. Ensure template is in <code>~/.scmd/templates/</code></p>"},{"location":"template-command-integration/#required-variable-missing","title":"Required Variable Missing","text":"<pre><code>Error: required variable Code not provided\n</code></pre> <p>Solution: 1. Check template variables: <code>scmd template show security-review</code> 2. Ensure command provides all required variables 3. Add variable mapping in command spec</p>"},{"location":"template-command-integration/#invalid-template-reference","title":"Invalid Template Reference","text":"<pre><code>Error: template must specify either 'name' or 'inline'\n</code></pre> <p>Solution: - Choose one: either reference by name OR define inline - Cannot use both in same command</p>"},{"location":"template-command-integration/#migration-guide","title":"Migration Guide","text":""},{"location":"template-command-integration/#migrating-existing-commands-to-templates","title":"Migrating Existing Commands to Templates","text":"<p>Before (v0.4.1): <pre><code>name: security-review\nversion: 1.0.0\ndescription: Security code review\nprompt:\n  system: \"You are a security expert...\"\n  template: |\n    Review this code for security issues:\n    {{.stdin}}\n</code></pre></p> <p>After (v0.4.2): <pre><code>name: security-review\nversion: 1.0.0\ndescription: Security code review\ntemplate:\n  name: owasp-security  # Reusable template\n  variables:\n    Code: \"{{.file_content}}\"\n    Language: \"{{.file_extension}}\"\n</code></pre></p> <p>Benefits: - Template can be shared across multiple commands - Centralized template updates - Better organization and discoverability - Variable mapping makes intent clearer</p>"},{"location":"template-command-integration/#api-reference","title":"API Reference","text":""},{"location":"template-command-integration/#templateexecutor","title":"TemplateExecutor","text":"<pre><code>type TemplateExecutor struct {\n    templateManager *templates.Manager\n    dataDir         string\n}\n\n// NewTemplateExecutor creates a new template executor\nfunc NewTemplateExecutor(dataDir string) (*TemplateExecutor, error)\n\n// ExecuteTemplateCommand executes a command that uses a template\nfunc (te *TemplateExecutor) ExecuteTemplateCommand(\n    ctx context.Context,\n    spec *CommandSpec,\n    args *command.Args,\n    execCtx *command.ExecContext,\n) (*command.Result, error)\n</code></pre>"},{"location":"template-command-integration/#template-manager","title":"Template Manager","text":"<pre><code>// NewManagerWithDir creates a template manager with custom directory\nfunc NewManagerWithDir(templatesDir string) (*Manager, error)\n\n// Load loads a template by name\nfunc (m *Manager) Load(name string) (*Template, error)\n\n// Execute executes a template with data\nfunc (m *Manager) Execute(name string, data map[string]interface{}) (string, string, error)\n</code></pre>"},{"location":"template-command-integration/#examples-repository","title":"Examples Repository","text":"<p>See the official examples repository for more template and command examples: - https://github.com/scmd/commands/tree/main/templates - https://github.com/scmd/commands/tree/main/commands</p>"},{"location":"template-command-integration/#see-also","title":"See Also","text":"<ul> <li>Template System Documentation</li> <li>Command Specification</li> <li>Repository Management</li> <li>Command Composition</li> </ul>"},{"location":"troubleshooting/","title":"Troubleshooting Guide","text":"<p>This guide helps you diagnose and fix common issues with scmd.</p>"},{"location":"troubleshooting/#quick-diagnosis","title":"Quick Diagnosis","text":"<p>First step: Run the doctor command to check your setup:</p> <pre><code>scmd doctor\n</code></pre> <p>This will check: - \u2705 scmd installation - \u2705 Models downloaded - \u2705 llama-server availability - \u2705 System resources - \u2705 Backend connectivity</p>"},{"location":"troubleshooting/#common-issues","title":"Common Issues","text":""},{"location":"troubleshooting/#1-cannot-connect-to-llama-server","title":"1. \"Cannot connect to llama-server\"","text":"<p>Problem: Commands fail with connection errors.</p> <p>Solutions:</p> <ol> <li> <p>Let scmd auto-start the server (recommended):    <pre><code># Just run your command - server will start automatically\necho \"Hello\" | scmd /explain\n</code></pre></p> </li> <li> <p>Manually start the server:    <pre><code>scmd server start\n</code></pre></p> </li> <li> <p>Check server status:    <pre><code>scmd server status\n</code></pre></p> </li> <li> <p>Use a cloud backend instead:    <pre><code>export OPENAI_API_KEY=your-key\nscmd -b openai /explain code.go\n</code></pre></p> </li> </ol>"},{"location":"troubleshooting/#2-llama-server-not-found","title":"2. \"llama-server not found\"","text":"<p>Problem: llama-server binary is not installed.</p> <p>Solutions:</p> <p>macOS: <pre><code>brew install llama.cpp\n</code></pre></p> <p>Linux: <pre><code># Build from source\ngit clone https://github.com/ggerganov/llama.cpp\ncd llama.cpp\nmake llama-server\nsudo cp llama-server /usr/local/bin/\n</code></pre></p> <p>Alternative: Use cloud backends (no local installation needed): <pre><code>export OPENAI_API_KEY=your-key\nscmd -b openai /explain\n</code></pre></p>"},{"location":"troubleshooting/#3-gpu-out-of-memory-oom-crashes","title":"3. GPU Out of Memory (OOM) Crashes","text":"<p>Problem: Server crashes with \"kIOGPUCommandBufferCallbackErrorOutOfMemory\"</p> <p>Solutions:</p> <ol> <li> <p>Restart in CPU mode (slower but stable):    <pre><code>scmd server restart --cpu\n</code></pre></p> </li> <li> <p>Use smaller context size:    <pre><code>scmd server restart -c 2048\n</code></pre></p> </li> <li> <p>Switch to smaller model:    <pre><code>scmd server start -m qwen2.5-1.5b\n</code></pre></p> </li> <li> <p>Close other applications using GPU/memory</p> </li> <li> <p>Check memory with doctor:    <pre><code>scmd doctor\n</code></pre></p> </li> </ol> <p>Prevention: scmd now auto-detects available memory and tunes configuration automatically!</p>"},{"location":"troubleshooting/#4-cpu-mode-is-very-slow","title":"4. CPU Mode is Very Slow","text":"<p>Problem: Queries take 30-60+ seconds.</p> <p>Explanation: CPU-only inference is inherently slow. This is expected behavior.</p> <p>Solutions:</p> <ol> <li> <p>Enable GPU acceleration (if you have a GPU):    <pre><code>scmd server restart --gpu\n</code></pre></p> </li> <li> <p>Use smaller model:    <pre><code>scmd server start -m qwen2.5-0.5b  # Fastest\n</code></pre></p> </li> <li> <p>Use cloud backend for faster results:    <pre><code>export OPENAI_API_KEY=your-key\nscmd -b openai /explain\n</code></pre></p> </li> <li> <p>Use Groq (free tier, very fast):    <pre><code>export GROQ_API_KEY=your-key\nscmd -b groq /explain\n</code></pre></p> </li> </ol> <p>Performance expectations: - CPU mode: 30-60 seconds per query (0.2-0.5 tokens/sec) - GPU mode (M1/M2): 2-5 seconds per query (~20 tokens/sec) - Cloud (OpenAI/Groq): 1-3 seconds per query</p>"},{"location":"troubleshooting/#5-model-not-downloaded","title":"5. Model Not Downloaded","text":"<p>Problem: \"Model 'xxx' not found\"</p> <p>Solution:</p> <p>Models download automatically on first use, but you can also download manually:</p> <pre><code># List available models\nscmd models list\n\n# Download specific model\nscmd models download qwen2.5-1.5b\n\n# Check downloaded models\nscmd doctor\n</code></pre>"},{"location":"troubleshooting/#6-port-8089-already-in-use","title":"6. Port 8089 Already in Use","text":"<p>Problem: Another process is using port 8089.</p> <p>Solutions:</p> <ol> <li> <p>Let scmd use the existing server:    <pre><code># scmd will automatically detect and use it\nscmd /explain code.go\n</code></pre></p> </li> <li> <p>Stop the conflicting process:    <pre><code># Find process on port 8089\nlsof -ti:8089\n\n# Kill it\nkill $(lsof -ti:8089)\n\n# Restart scmd server\nscmd server start\n</code></pre></p> </li> <li> <p>Stop scmd's server:    <pre><code>scmd server stop\n</code></pre></p> </li> </ol>"},{"location":"troubleshooting/#7-commands-fail-with-generic-error","title":"7. Commands Fail with Generic \"Error\"","text":"<p>Problem: Old behavior - should be fixed now!</p> <p>Solution: Update to latest version with improved error messages:</p> <pre><code># Build latest from source\ngo build -o scmd cmd/scmd/main.go\n</code></pre> <p>New error messages include: - \u274c Clear description of the problem - \ud83d\udca1 2-4 actionable solutions - \ud83d\udd17 Links to relevant documentation</p>"},{"location":"troubleshooting/#8-server-wont-start","title":"8. Server Won't Start","text":"<p>Problem: <code>scmd server start</code> fails.</p> <p>Debug steps:</p> <ol> <li> <p>Check logs:    <pre><code>scmd server logs\n</code></pre></p> </li> <li> <p>Run doctor:    <pre><code>scmd doctor\n</code></pre></p> </li> <li> <p>Try manual start with debug:    <pre><code>SCMD_DEBUG=1 scmd server start\n</code></pre></p> </li> <li> <p>Check disk space:    <pre><code>df -h ~/.scmd\n</code></pre></p> </li> <li> <p>Check llama-server installation:    <pre><code>which llama-server\nllama-server --help\n</code></pre></p> </li> </ol>"},{"location":"troubleshooting/#environment-variables","title":"Environment Variables","text":"<p>Control scmd behavior with environment variables:</p> <pre><code># Disable auto-start (for debugging)\nexport SCMD_NO_AUTOSTART=1\n\n# Enable debug output\nexport SCMD_DEBUG=1\n\n# Set custom data directory\nexport SCMD_DATA_DIR=~/custom/path\n\n# Suppress progress messages\nexport SCMD_QUIET=1\n</code></pre>"},{"location":"troubleshooting/#getting-more-help","title":"Getting More Help","text":"<ol> <li> <p>Check logs:    <pre><code>scmd server logs\ntail -f ~/.scmd/logs/llama-server.log\n</code></pre></p> </li> <li> <p>Run diagnostics:    <pre><code>scmd doctor\n</code></pre></p> </li> <li> <p>Enable debug mode:    <pre><code>SCMD_DEBUG=1 scmd /explain test.go\n</code></pre></p> </li> <li> <p>Report issue:</p> </li> <li>GitHub: https://github.com/scmd/scmd/issues</li> <li>Include output from <code>scmd doctor</code></li> <li>Include relevant error messages</li> </ol>"},{"location":"troubleshooting/#performance-tuning","title":"Performance Tuning","text":""},{"location":"troubleshooting/#memory-constrained-systems-8gb-ram","title":"Memory-Constrained Systems (&lt; 8GB RAM)","text":"<pre><code># Use smallest model\nscmd server start -m qwen2.5-0.5b --cpu\n\n# Or use cloud backend\nexport GROQ_API_KEY=your-key\nscmd -b groq\n</code></pre>"},{"location":"troubleshooting/#high-performance-systems-16-gb-ram","title":"High-Performance Systems (16+ GB RAM)","text":"<pre><code># Use larger model with more context\nscmd server start -m qwen2.5-7b -c 8192 --gpu\n</code></pre>"},{"location":"troubleshooting/#m1m2-macs-8gb","title":"M1/M2 Macs (8GB)","text":"<pre><code># Recommended: Medium model with auto-tuned settings\nscmd server start -m qwen2.5-3b\n# scmd will auto-tune context size and GPU layers\n</code></pre>"},{"location":"troubleshooting/#verifying-installation","title":"Verifying Installation","text":"<p>After installation, verify everything works:</p> <pre><code># 1. Check installation\nscmd doctor\n\n# 2. Start server (should auto-start, but let's be explicit)\nscmd server start\n\n# 3. Test with simple query\necho \"Hello world\" | scmd /explain\n\n# 4. Check status\nscmd server status\n\n# 5. View logs\nscmd server logs --tail 20\n</code></pre> <p>Expected output: - \u2705 All <code>scmd doctor</code> checks pass (or have helpful recommendations) - \u2705 Server starts within 10-30 seconds - \u2705 Test query completes successfully - \u2705 No errors in logs</p>"},{"location":"troubleshooting/#uninstalling","title":"Uninstalling","text":"<p>To completely remove scmd:</p> <pre><code># 1. Stop server\nscmd server stop\n\n# 2. Remove data directory\nrm -rf ~/.scmd\n\n# 3. Remove binary\nrm $(which scmd)\n\n# 4. (Optional) Uninstall llama.cpp\nbrew uninstall llama.cpp\n</code></pre>"},{"location":"troubleshooting/#faq","title":"FAQ","text":"<p>Q: Do I need to manually start llama-server?</p> <p>A: No! As of the latest version, scmd automatically starts llama-server when needed.</p> <p>Q: Can I use scmd without installing llama.cpp?</p> <p>A: Yes! Use cloud backends: <pre><code>export OPENAI_API_KEY=your-key\nscmd -b openai /explain\n</code></pre></p> <p>Q: Why is CPU mode so slow?</p> <p>A: CPU inference is inherently slow (30-60s per query). Use GPU mode or cloud backends for better performance.</p> <p>Q: How much disk space do I need?</p> <p>A: Models range from 400MB to 5GB: - qwen2.5-0.5b: ~400MB - qwen2.5-1.5b: ~1GB (default) - qwen2.5-3b: ~2GB - qwen3-4b: ~2.6GB - qwen2.5-7b: ~4.7GB</p> <p>Q: Can I use multiple models?</p> <p>A: Yes! Download multiple models and switch between them: <pre><code>scmd server start -m qwen2.5-3b\nscmd server restart -m qwen2.5-1.5b\n</code></pre></p> <p>Q: Is my data sent to the cloud?</p> <p>A: When using llama.cpp backend: No - everything runs locally. When using cloud backends (OpenAI, Groq, etc): Yes - data is sent to their servers.</p> <p>Last Updated: January 2026 Version: 1.0.0</p>"},{"location":"about/changelog/","title":"Changelog","text":"<p>For the complete, detailed changelog, see CHANGELOG.md in the repository root.</p>"},{"location":"about/changelog/#recent-releases","title":"Recent Releases","text":""},{"location":"about/changelog/#unreleased","title":"[Unreleased]","text":""},{"location":"about/changelog/#man-page-integration-production-readiness-v020","title":"Man Page Integration &amp; Production Readiness (v0.2.0)","text":"<p>Added:</p> <ul> <li>Man Page Integration: New <code>/cmd</code> command that reads system man pages and generates exact commands from natural language queries</li> <li>Intelligent command detection (60+ common CLI tools)</li> <li>Automatic man page parsing for accurate command generation</li> <li>Fallback to general CLI knowledge when man pages unavailable</li> <li>Supports find, grep, sed, awk, tar, curl, git, docker, kubectl, and more</li> <li>Interactive Setup Wizard: Beautiful guided first-run experience</li> <li>Four model presets: Fast (0.5B), Balanced (1.5B), Best (3B), Premium (7B)</li> <li>Clean single-line progress bar (no more 500-line spam)</li> <li>Production-grade downloads with retry logic and resume support</li> <li>Disk space validation before download</li> <li>Optional post-setup quick test</li> <li>Enhanced Model Selection: Switched default from qwen3-4b (2.6GB) to qwen2.5-1.5b (1.0GB)</li> <li>22% faster inference (5-8s avg response vs 6-10s)</li> <li>61% smaller download size</li> <li>Improved quality with better tool calling support</li> <li>Built-in Review Command: Code review functionality now built into core</li> <li>Multi-Platform Distribution: Automated releases via GoReleaser for macOS, Linux, and Windows</li> <li>Homebrew Support: Official Homebrew tap at <code>scmd/tap</code></li> <li>npm Distribution: Cross-platform installation via <code>scmd-cli</code> npm package</li> <li>Linux Packages: Native deb, rpm, and apk packages</li> <li>Install Scripts: Universal wget/curl installation script with checksum verification</li> <li>Docker Images: Multi-arch Docker images on Docker Hub</li> <li>Shell Completions: Auto-generated completions for bash, zsh, fish, and PowerShell</li> <li>Release Automation: GitHub Actions workflow for automated releases</li> <li>Comprehensive Documentation:</li> <li>Detailed installation guide (INSTALL.md)</li> <li>Release process documentation</li> <li>Distribution infrastructure guide</li> </ul> <p>Installation Methods:</p> <pre><code># Homebrew (macOS/Linux)\nbrew install scmd/tap/scmd\n\n# npm (Cross-platform)\nnpm install -g scmd-cli\n\n# Shell script (wget/curl)\ncurl -fsSL https://scmd.sh/install.sh | bash\n\n# Linux packages\n# Debian/Ubuntu\nsudo dpkg -i scmd_VERSION_linux_amd64.deb\n\n# Red Hat/Fedora/CentOS\nsudo rpm -i scmd_VERSION_linux_amd64.rpm\n</code></pre> <p>Enhanced:</p> <ul> <li>Model Performance: Optimized llama.cpp configuration for 22% faster inference</li> <li>Context size increased from 1024 to 8192 tokens</li> <li>Flash attention enabled</li> <li>Continuous batching for multiple requests</li> <li>Memory locking for consistent performance</li> <li>Optimized KV cache (F16)</li> <li>Model Downloads: Production-grade download system</li> <li>Retry logic with exponential backoff (3 attempts)</li> <li>Resume support using HTTP Range headers</li> <li>Disk space validation (1.2x file size buffer)</li> <li>Enhanced error messages with structured help</li> <li>7B Model URL: Fixed qwen2.5-7b download (changed from Q4_K_M to Q3_K_M)</li> <li>Single file download (was multi-part)</li> <li>Reduced size from 4.7GB to 3.8GB</li> <li>Updated README with all installation methods, benchmarks, and new features</li> <li>Makefile with release and distribution targets</li> <li>Shell completion generation command</li> </ul> <p>Fixed:</p> <ul> <li>Setup wizard download URLs (now use DefaultModels instead of hardcoded URLs)</li> <li>7B model multi-part download issue</li> <li>Context size errors on large files</li> <li>Progress bar display (clean single-line instead of spam)</li> </ul> <p>Performance Benchmarks (M1 Mac, 8GB RAM):</p> Model Avg Response Tokens/sec Quality qwen2.5-0.5b 3-5s ~45 tok/s \u2b50\u2b50\u2b50 qwen2.5-1.5b 5-8s ~30 tok/s \u2b50\u2b50\u2b50\u2b50 qwen2.5-3b 8-12s ~18 tok/s \u2b50\u2b50\u2b50\u2b50\u2b50 qwen2.5-7b 15-25s ~8 tok/s \u2b50\u2b50\u2b50\u2b50\u2b50"},{"location":"about/changelog/#010-2025-01-06","title":"[0.1.0] - 2025-01-06","text":"<p>Initial release with core functionality.</p> <p>Added:</p> <ul> <li>Offline-first AI-powered slash commands</li> <li>llama.cpp integration with Qwen models</li> <li>Auto-download of models on first use</li> <li>Built-in <code>/explain</code> command</li> <li>Repository system for command distribution</li> <li>Shell integration for bash, zsh, and fish</li> <li>Multi-backend support (llama.cpp, Ollama, OpenAI, Together.ai, Groq)</li> <li>Command composition and chaining</li> <li>Configuration management</li> <li>Model management (list, pull, remove, info)</li> <li>Slash command system</li> <li>Command lockfiles for reproducibility</li> <li>Context gathering and caching</li> </ul> <p>Security:</p> <ul> <li>Input validation and sanitization</li> <li>Path traversal prevention</li> <li>Resource limits for LLM inference</li> <li>Secure model downloads with checksum verification</li> <li>Comprehensive security documentation</li> </ul> <p>Documentation:</p> <ul> <li>README with quick start guide</li> <li>Architecture documentation</li> <li>Security documentation</li> <li>Troubleshooting guide</li> <li>API documentation</li> <li>Contributing guidelines</li> </ul>"},{"location":"about/changelog/#version-history","title":"Version History","text":"<p>For detailed version information and complete release notes, see:</p> <ul> <li>CHANGELOG.md - Complete changelog</li> <li>GitHub Releases - Release notes and downloads</li> </ul>"},{"location":"about/changelog/#release-schedule","title":"Release Schedule","text":"<p>scmd follows semantic versioning and releases on an as-needed basis:</p> <ul> <li>Major releases (v2.0.0): Breaking changes, significant new features</li> <li>Minor releases (v1.1.0): New features, backward compatible</li> <li>Patch releases (v1.0.1): Bug fixes, backward compatible</li> </ul>"},{"location":"about/changelog/#upgrade-guide","title":"Upgrade Guide","text":""},{"location":"about/changelog/#upgrading-to-latest-version","title":"Upgrading to Latest Version","text":"HomebrewnpmShell ScriptLinux PackagesSource <pre><code>brew upgrade scmd\n</code></pre> <pre><code>npm update -g scmd-cli\n</code></pre> <pre><code>curl -fsSL https://scmd.sh/install.sh | bash\n</code></pre> <pre><code># Debian/Ubuntu\nsudo apt upgrade scmd\n\n# Fedora/RHEL\nsudo dnf upgrade scmd\n</code></pre> <pre><code>cd scmd\ngit pull origin main\nmake build\nsudo make install\n</code></pre>"},{"location":"about/changelog/#staying-updated","title":"Staying Updated","text":"<ul> <li>Watch Releases: GitHub Watch \u2192 Releases only</li> <li>Star the Repo: Get updates in your GitHub feed</li> <li>Follow Changelog: Check this page regularly for updates</li> </ul>"},{"location":"about/changelog/#deprecation-policy","title":"Deprecation Policy","text":"<p>When we deprecate features:</p> <ol> <li>Advance notice: Minimum 1 major version before removal</li> <li>Migration guide: Clear documentation on alternatives</li> <li>Warnings: Deprecation warnings in the application</li> <li>Support period: Bug fixes for deprecated features during transition</li> </ol>"},{"location":"about/changelog/#security-updates","title":"Security Updates","text":"<p>Security updates are released as patch versions as soon as fixes are available. For security advisories, see:</p> <ul> <li>Security Policy</li> <li>GitHub Security Advisories</li> </ul>"},{"location":"about/changelog/#contributing-to-the-changelog","title":"Contributing to the Changelog","text":"<p>When contributing, please update CHANGELOG.md following the Keep a Changelog format:</p> <pre><code>## [Unreleased]\n\n### Added\n- New feature X\n\n### Changed\n- Modified Y for better performance\n\n### Fixed\n- Bug in Z\n\n### Security\n- Patched vulnerability in A\n</code></pre> <p>See Contributing Guidelines for more details.</p>"},{"location":"architecture/STABILITY/","title":"Stability-First Architecture","text":"<p>Core Principle: Users should never need to manually manage the LLM server. The system must be self-healing and provide clear feedback when issues occur.</p>"},{"location":"architecture/STABILITY/#design-tenets","title":"Design Tenets","text":""},{"location":"architecture/STABILITY/#1-zero-manual-intervention","title":"1. Zero Manual Intervention","text":"<ul> <li>Server automatically starts, stops, and restarts as needed</li> <li>No <code>pkill</code> commands required from users</li> <li>System detects and recovers from crashes automatically</li> </ul>"},{"location":"architecture/STABILITY/#2-clear-feedback-loop","title":"2. Clear Feedback Loop","text":"<ul> <li>Every error message includes actionable solutions</li> <li>Users know exactly what's happening and what to do</li> <li>No silent failures or confusing states</li> </ul>"},{"location":"architecture/STABILITY/#3-intelligent-recovery","title":"3. Intelligent Recovery","text":"<ul> <li>Detect server health issues (crashes, context mismatches, OOM)</li> <li>Automatically retry with safer configurations (CPU-only, smaller context)</li> <li>Provide feedback about degraded performance modes</li> </ul>"},{"location":"architecture/STABILITY/#4-graceful-degradation","title":"4. Graceful Degradation","text":"<ul> <li>When GPU fails \u2192 Fall back to CPU mode</li> <li>When context too large \u2192 Suggest splitting input or cloud backend</li> <li>When server unreachable \u2192 Auto-restart with clear messaging</li> </ul>"},{"location":"architecture/STABILITY/#implementation","title":"Implementation","text":""},{"location":"architecture/STABILITY/#health-check-system","title":"Health Check System","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 User runs: scmd /explain                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n               \u2502\n               \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Pre-inference Health Check              \u2502\n\u2502 \u2022 Is server running?                    \u2502\n\u2502 \u2022 Does context size match expected?     \u2502\n\u2502 \u2022 Is server responsive?                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n               \u2502\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u2502 Healthy?    \u2502\n        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n               \u2502\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u2502 YES        NO   \u2502\n        \u2502                 \u2502\n        \u25bc                 \u25bc\n   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n   \u2502 Execute \u2502    \u2502 Auto-Restart \u2502\n   \u2502 Request \u2502    \u2502 with Retry   \u2502\n   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u2502\n                         \u25bc\n                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                  \u2502 Show Clear   \u2502\n                  \u2502 Feedback     \u2502\n                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/STABILITY/#error-handling-hierarchy","title":"Error Handling Hierarchy","text":"<ol> <li>Detection: Parse error to identify root cause</li> <li>Context size exceeded</li> <li>Out of memory</li> <li>Server crashed</li> <li> <p>Connection failed</p> </li> <li> <p>Auto-Recovery: Try to fix automatically</p> </li> <li>Restart server</li> <li>Reduce context size</li> <li>Switch to CPU mode</li> <li> <p>Use different model</p> </li> <li> <p>User Feedback: When auto-recovery fails</p> </li> <li>Show what went wrong (in user terms)</li> <li>Show what was tried (transparency)</li> <li>Show what user can do (actionable steps)</li> <li>Provide one-command fixes when possible</li> </ol>"},{"location":"architecture/STABILITY/#example-error-message-flow","title":"Example Error Message Flow","text":"<p>BAD (Current state in some areas): <pre><code>Error: inference failed\nTry: scmd doctor\n</code></pre></p> <p>GOOD (Target state): <pre><code>\u274c Input too large for available GPU memory\n\nWhat happened:\n  Your input (5502 tokens) exceeds GPU memory capacity (4096 tokens)\n  Metal GPU cannot allocate enough VRAM for the full context\n\nWhat I tried:\n  \u2713 Started llama-server with 32K context\n  \u2717 GPU allocated only 4K (memory limitation)\n\nWhat you can do:\n  1. Use CPU mode (slower, supports full 32K):\n     export SCMD_CPU_ONLY=1\n     scmd /explain &lt;your-input&gt;\n\n  2. Split your input into smaller files\n\n  3. Use cloud backend (fastest):\n     export OPENAI_API_KEY=your-key\n     scmd -b openai /explain &lt;your-input&gt;\n</code></pre></p>"},{"location":"architecture/STABILITY/#testing-strategy","title":"Testing Strategy","text":""},{"location":"architecture/STABILITY/#unit-tests","title":"Unit Tests","text":"<ul> <li>Test each error detection pattern</li> <li>Test auto-recovery logic</li> <li>Test health check functions</li> </ul>"},{"location":"architecture/STABILITY/#integration-tests","title":"Integration Tests","text":"<ul> <li>Simulate server crashes</li> <li>Test recovery from OOM situations</li> <li>Validate error messages are helpful</li> </ul>"},{"location":"architecture/STABILITY/#user-testing","title":"User Testing","text":"<ul> <li>Can users recover from errors without documentation?</li> <li>Do error messages make sense to non-technical users?</li> <li>Are suggested commands copy-pasteable and working?</li> </ul>"},{"location":"architecture/STABILITY/#monitoring-points","title":"Monitoring Points","text":"<ol> <li>Server Startup</li> <li>Did server start successfully?</li> <li>Is reported context size what we requested?</li> <li> <p>Is GPU/CPU mode correct?</p> </li> <li> <p>Inference Request</p> </li> <li>Is server still running?</li> <li>Does context size still match?</li> <li> <p>Is response time acceptable?</p> </li> <li> <p>Error Recovery</p> </li> <li>Did auto-restart succeed?</li> <li>Did fallback configuration work?</li> <li>Was user informed of changes?</li> </ol>"},{"location":"architecture/STABILITY/#success-metrics","title":"Success Metrics","text":"<ul> <li>Zero manual server management: Users never use <code>pkill</code> or manual restarts</li> <li>Clear feedback: 100% of errors include actionable next steps</li> <li>Auto-recovery: 90%+ of issues resolved without user intervention</li> <li>User confidence: Users trust the system will handle server issues</li> </ul>"},{"location":"architecture/STABILITY/#future-enhancements","title":"Future Enhancements","text":"<ol> <li>Persistent Server: Keep server running between commands</li> <li>Smart Caching: Cache model loads to reduce startup time</li> <li>Multi-Model Support: Automatically switch to smaller model when needed</li> <li>Cloud Fallback: Auto-suggest cloud when local fails repeatedly</li> </ol>"},{"location":"command-authoring/automatic-context/","title":"Automatic Context Gathering","text":"<p>Give your commands contextual awareness by automatically gathering files, git status, and environment variables before LLM execution. Context gathering happens transparently - no manual piping or file reading needed.</p> <p>Why Context Matters</p> <p>LLMs make better decisions with relevant context. Instead of manually piping files or explaining your environment, let scmd gather context automatically.</p>"},{"location":"command-authoring/automatic-context/#overview","title":"Overview","text":"<p>The <code>context</code> field in command YAML enables automatic gathering of:</p> <ul> <li>Files: Match patterns and include file contents</li> <li>Git: Branch, status, recent commits, remote URL</li> <li>Environment: Specific environment variables</li> <li>Token Management: Automatic truncation to fit token budgets</li> </ul>"},{"location":"command-authoring/automatic-context/#basic-usage","title":"Basic Usage","text":""},{"location":"command-authoring/automatic-context/#minimal-example","title":"Minimal Example","text":"<pre><code>name: review-changes\ndescription: Review uncommitted changes with git context\n\ncontext:\n  git: true  # Include git branch, status, recent commits\n\nprompt:\n  template: |\n    Review my uncommitted changes.\n    Focus on code quality and potential issues.\n</code></pre> <p>When executed, scmd automatically prepends:</p> <p><pre><code>## Git Context\n\n**Branch:** feature/new-feature\n\n**Status:**\n</code></pre> M  internal/repos/executor.go M  internal/tools/shell.go ?? new-file.go <pre><code>**Recent Commits:**\n</code></pre> a1b2c3d feat: add new feature e4f5g6h fix: bug in processor i7j8k9l docs: update README <pre><code>---\n\n(Your prompt follows here)\n</code></pre></p>"},{"location":"command-authoring/automatic-context/#file-context-example","title":"File Context Example","text":"<pre><code>name: analyze-go-project\ndescription: Analyze Go project structure and dependencies\n\ncontext:\n  files:\n    - \"go.mod\"\n    - \"go.sum\"\n    - \"*.go\"\n    - \"internal/**/*.go\"\n  max_tokens: 8000\n\nprompt:\n  template: |\n    Analyze this Go project's structure and dependencies.\n    {{.input}}\n</code></pre> <p>Gathered context includes:</p> <p><pre><code>## Files\n\n### go.mod\n</code></pre> module github.com/user/project</p> <p>go 1.21</p> <p>require (     github.com/pkg/errors v0.9.1 ) <pre><code>### main.go\n</code></pre> package main</p> <p>func main() {     // ... } <pre><code>### internal/app/app.go\n</code></pre> package app</p> <p>// ... <pre><code>---\n\n(Your prompt follows)\n</code></pre></p>"},{"location":"command-authoring/automatic-context/#context-specification","title":"Context Specification","text":""},{"location":"command-authoring/automatic-context/#full-schema","title":"Full Schema","text":"<pre><code>context:\n  files:     []string  # Glob patterns\n  git:       bool      # Include git context\n  env:       []string  # Environment variable names\n  max_tokens: int      # Maximum context tokens\n</code></pre>"},{"location":"command-authoring/automatic-context/#files","title":"Files","text":"<p>Glob patterns to match files for inclusion:</p> <pre><code>context:\n  files:\n    - \"*.go\"              # All Go files in current dir\n    - \"src/**/*.ts\"       # All TypeScript files in src/ recursively\n    - \"package.json\"      # Specific file\n    - \"config/*.yaml\"     # All YAML files in config/\n    - \"README.md\"         # Documentation\n</code></pre> <p>Features: - Standard glob syntax (<code>*</code>, <code>**</code>, <code>?</code>) - Relative to working directory - Absolute paths supported - Directories are skipped automatically - Files &gt;1MB show size warning instead of content</p> <p>Examples:</p> Pattern Matches <code>*.js</code> All JS files in current directory <code>**/*.py</code> All Python files recursively <code>src/**/*.{ts,tsx}</code> All TypeScript files in src/ <code>test/**/*_test.go</code> All Go test files in test/"},{"location":"command-authoring/automatic-context/#git-context","title":"Git Context","text":"<p>Enable with <code>git: true</code>:</p> <pre><code>context:\n  git: true\n</code></pre> <p>Includes: - Current branch name - Working tree status (<code>git status --short</code>) - Recent 5 commits (<code>git log --oneline -5</code>) - Remote origin URL</p> <p>Example output:</p> <p><pre><code>## Git Context\n\n**Branch:** main\n\n**Status:**\n</code></pre> M  src/app.ts A  src/new-feature.ts D  src/old-file.ts <pre><code>**Recent Commits:**\n</code></pre> abc123 feat: add new feature def456 fix: resolve bug in handler ghi789 docs: update API documentation jkl012 refactor: simplify error handling mno345 test: add unit tests <pre><code>\n</code></pre></p> <p>Non-blocking: If not a git repository, context gathering continues without error.</p>"},{"location":"command-authoring/automatic-context/#environment-variables","title":"Environment Variables","text":"<p>Specify environment variables to include:</p> <pre><code>context:\n  env:\n    - \"GOPATH\"\n    - \"GO111MODULE\"\n    - \"NODE_ENV\"\n    - \"DATABASE_URL\"\n    - \"API_KEY\"\n</code></pre> <p>Example output:</p> <pre><code>## Environment\n\n- `GOPATH`: /Users/user/go\n- `GO111MODULE`: on\n- `NODE_ENV`: development\n</code></pre> <p>Security note: Be careful with sensitive variables. Consider: - Only include variables needed for the task - Don't include secrets if sharing LLM conversations - Use environment-specific commands</p>"},{"location":"command-authoring/automatic-context/#token-limits","title":"Token Limits","text":"<p>Control context size with <code>max_tokens</code>:</p> <pre><code>context:\n  files:\n    - \"**/*.go\"\n  max_tokens: 8000  # ~32KB of text\n</code></pre> <p>Token estimation: - Rough estimate: 1 token \u2248 4 characters - Files contribute most tokens - Git context: ~50-200 tokens - Environment: minimal</p> <p>Truncation behavior: When context exceeds <code>max_tokens</code>:</p> <ol> <li>Files are removed largest-first</li> <li>Git context is preserved</li> <li>Environment variables are preserved</li> <li>Truncation continues until under limit</li> </ol> <p>Example:</p> <p>If you have: - 100 Go files totaling 50,000 tokens - <code>max_tokens: 8000</code></p> <p>Result: - Largest files removed first - ~20 most important files kept - Git and env context preserved</p> <p>Choosing Token Limits</p> <ul> <li>Small models (7B): 2000-4000 tokens</li> <li>Medium models (13B): 4000-8000 tokens</li> <li>Large models (70B): 8000-16000 tokens</li> <li>Consider leaving room for response (~2000 tokens)</li> </ul>"},{"location":"command-authoring/automatic-context/#complete-examples","title":"Complete Examples","text":""},{"location":"command-authoring/automatic-context/#example-1-code-review-command","title":"Example 1: Code Review Command","text":"<pre><code>name: contextual-code-review\nversion: 1.0.0\ndescription: Review code with full project context\n\ncontext:\n  files:\n    - \"*.go\"\n    - \"go.mod\"\n    - \"internal/**/*.go\"\n  git: true\n  env:\n    - \"GOPATH\"\n    - \"GO111MODULE\"\n  max_tokens: 10000\n\nprompt:\n  system: |\n    You are an expert Go code reviewer.\n\n    You have access to:\n    - Project Go files\n    - Go module dependencies\n    - Git status and recent commits\n    - Go environment configuration\n\n    Review for:\n    - Code quality\n    - Go best practices\n    - Potential bugs\n    - Performance issues\n\n  template: |\n    Review the following changes: {{.input}}\n\n    Consider the project context provided above.\n\nargs:\n  - name: focus\n    description: \"Focus area (quality, security, performance)\"\n    required: false\n    default: \"all\"\n\nexamples:\n  - \"git diff | scmd /contextual-code-review\"\n  - \"cat new-feature.go | scmd /contextual-code-review security\"\n</code></pre> <p>Usage:</p> <pre><code>git diff | scmd /contextual-code-review\n\n# Context automatically gathered:\n# - All .go files\n# - go.mod\n# - Git branch: feature/new-api\n# - Git status: 3 modified files\n# - GOPATH and GO111MODULE\n# Then: LLM reviews diff with full context\n</code></pre>"},{"location":"command-authoring/automatic-context/#example-2-documentation-generator","title":"Example 2: Documentation Generator","text":"<pre><code>name: auto-docs\nversion: 1.0.0\ndescription: Generate documentation from code\n\ncontext:\n  files:\n    - \"src/**/*.ts\"\n    - \"package.json\"\n    - \"README.md\"\n  max_tokens: 12000\n\nprompt:\n  system: |\n    You are a technical writer creating API documentation.\n\n    You have access to:\n    - All source code\n    - Package dependencies\n    - Existing README\n\n    Generate:\n    - API reference\n    - Usage examples\n    - Installation instructions\n\n  template: |\n    Generate comprehensive documentation for this project.\n\n    {{.format | default \"markdown\"}}\n\nhooks:\n  post:\n    - shell: cat $OUTPUT &gt; docs/API.md\n\nexamples:\n  - \"scmd /auto-docs &gt; docs/API.md\"\n</code></pre>"},{"location":"command-authoring/automatic-context/#example-3-test-generator","title":"Example 3: Test Generator","text":"<pre><code>name: generate-tests\nversion: 1.0.0\ndescription: Generate tests based on code context\n\ncontext:\n  files:\n    - \"{{.file}}\"\n    - \"*_test.go\"\n  git: true\n  max_tokens: 6000\n\nprompt:\n  system: |\n    You are an expert at writing Go tests.\n\n    Context provided:\n    - Source file to test\n    - Existing test files (patterns to follow)\n    - Git history (understand recent changes)\n\n    Generate:\n    - Table-driven tests\n    - Edge cases\n    - Error conditions\n    - Follow existing test patterns\n\n  template: |\n    Generate comprehensive tests for: {{.file}}\n\nargs:\n  - name: file\n    description: \"File to generate tests for\"\n    required: true\n\nexamples:\n  - \"scmd /generate-tests handler.go &gt; handler_test.go\"\n</code></pre>"},{"location":"command-authoring/automatic-context/#example-4-environment-aware-deployment","title":"Example 4: Environment-Aware Deployment","text":"<pre><code>name: deploy-check\nversion: 1.0.0\ndescription: Pre-deployment checks with environment awareness\n\ncontext:\n  files:\n    - \"Dockerfile\"\n    - \"docker-compose.yml\"\n    - \".env.example\"\n  git: true\n  env:\n    - \"NODE_ENV\"\n    - \"DATABASE_URL\"\n    - \"REDIS_URL\"\n    - \"API_VERSION\"\n  max_tokens: 5000\n\nprompt:\n  system: |\n    You are a DevOps expert performing pre-deployment checks.\n\n    Context provided:\n    - Docker configuration\n    - Environment variables\n    - Git status and branch\n\n    Verify:\n    - No uncommitted changes\n    - Environment variables set correctly\n    - Docker config matches environment\n    - Not deploying from wrong branch\n\n  template: |\n    Perform pre-deployment check for {{.environment}}.\n\n    Report any issues or confirm ready to deploy.\n\nargs:\n  - name: environment\n    description: \"Target environment (staging, production)\"\n    required: true\n\nexamples:\n  - \"scmd /deploy-check production\"\n</code></pre>"},{"location":"command-authoring/automatic-context/#how-it-works","title":"How It Works","text":""},{"location":"command-authoring/automatic-context/#execution-flow","title":"Execution Flow","text":"<ol> <li> <p>Command Invoked <pre><code>scmd /my-command\n</code></pre></p> </li> <li> <p>Pre-Processing</p> </li> <li>Parse command spec</li> <li> <p>Check if <code>context</code> field exists</p> </li> <li> <p>Context Gathering (if specified)</p> </li> <li>Gather files matching patterns</li> <li>Collect git information</li> <li>Read environment variables</li> <li>Estimate token count</li> <li> <p>Truncate if exceeds <code>max_tokens</code></p> </li> <li> <p>Context Formatting</p> </li> <li>Format as markdown</li> <li> <p>Structure: Files \u2192 Git \u2192 Environment</p> </li> <li> <p>Prompt Construction</p> </li> <li>Prepend formatted context</li> <li>Add separator (<code>---</code>)</li> <li> <p>Add user prompt</p> </li> <li> <p>LLM Execution</p> </li> <li>Send combined prompt to LLM</li> <li>LLM has full context</li> <li> <p>Generate response</p> </li> <li> <p>Result</p> </li> <li>Return LLM output to user</li> </ol>"},{"location":"command-authoring/automatic-context/#context-format","title":"Context Format","text":"<p>Formatted context structure:</p> <p><pre><code>## Files\n\n### path/to/file1.go\n</code></pre> (file contents) <pre><code>### path/to/file2.go\n</code></pre> (file contents) <pre><code>## Git Context\n\n**Branch:** feature-branch\n\n**Status:**\n</code></pre> (git status --short output) <pre><code>**Recent Commits:**\n</code></pre> (git log --oneline -5 output) <pre><code>## Environment\n\n- `VAR1`: value1\n- `VAR2`: value2\n\n---\n\n(Your prompt here)\n</code></pre></p>"},{"location":"command-authoring/automatic-context/#performance-considerations","title":"Performance Considerations","text":""},{"location":"command-authoring/automatic-context/#token-budget","title":"Token Budget","text":"<p>Context gathering can be expensive in tokens:</p> Context Type Typical Tokens Notes Small file (100 lines) ~500 1 token \u2248 4 chars Large file (1000 lines) ~5000 Consider truncation Git context ~100-200 Minimal impact Environment (5 vars) ~50 Negligible Total for 10 files ~5000-10000 Set <code>max_tokens</code> appropriately"},{"location":"command-authoring/automatic-context/#file-reading","title":"File Reading","text":"<ul> <li>Files are read synchronously</li> <li>Large projects may have slight delay</li> <li>Use specific patterns to reduce files read</li> <li>Consider <code>max_tokens</code> to auto-limit</li> </ul>"},{"location":"command-authoring/automatic-context/#git-commands","title":"Git Commands","text":"<ul> <li>Git operations are fast (&lt; 100ms typically)</li> <li>Run in parallel where possible</li> <li>Fail gracefully if not a git repo</li> </ul>"},{"location":"command-authoring/automatic-context/#best-practices","title":"Best Practices","text":""},{"location":"command-authoring/automatic-context/#1-be-specific-with-file-patterns","title":"1. Be Specific with File Patterns","text":"<p>Good: <pre><code>context:\n  files:\n    - \"src/handlers/*.go\"  # Only handlers\n    - \"config/app.yaml\"    # Specific config\n</code></pre></p> <p>Bad: <pre><code>context:\n  files:\n    - \"**/*\"  # Everything (may hit token limit)\n</code></pre></p>"},{"location":"command-authoring/automatic-context/#2-set-appropriate-token-limits","title":"2. Set Appropriate Token Limits","text":"<pre><code>context:\n  files:\n    - \"**/*.go\"\n  max_tokens: 8000  # Explicit limit\n</code></pre> <p>Without <code>max_tokens</code>, large projects may send too much context.</p>"},{"location":"command-authoring/automatic-context/#3-use-environment-variables-wisely","title":"3. Use Environment Variables Wisely","text":"<p>Good: <pre><code>context:\n  env:\n    - \"NODE_ENV\"  # Relevant to task\n</code></pre></p> <p>Bad: <pre><code>context:\n  env:\n    - \"DATABASE_PASSWORD\"  # Security risk!\n</code></pre></p>"},{"location":"command-authoring/automatic-context/#4-combine-context-types","title":"4. Combine Context Types","text":"<pre><code>context:\n  files:\n    - \"*.go\"\n  git: true  # Git provides extra context\n  env:\n    - \"GOPATH\"\n</code></pre> <p>More context = better decisions, but watch token limits.</p>"},{"location":"command-authoring/automatic-context/#5-document-context-usage","title":"5. Document Context Usage","text":"<pre><code>name: my-command\ndescription: |\n  Does X with automatic context.\n\n  Context gathered:\n  - All Go files\n  - Git status\n  - GOPATH environment\n\ncontext:\n  files: [\"*.go\"]\n  git: true\n  env: [\"GOPATH\"]\n</code></pre> <p>Helps users understand what information is used.</p>"},{"location":"command-authoring/automatic-context/#troubleshooting","title":"Troubleshooting","text":""},{"location":"command-authoring/automatic-context/#context-not-appearing","title":"Context Not Appearing","text":"<p>Symptom: LLM doesn't seem to have context</p> <p>Debug: 1. Check command spec has <code>context:</code> field 2. Verify files match patterns 3. Check <code>max_tokens</code> not too restrictive 4. Look for errors in output</p> <p>Solution: <pre><code># Run with debug to see context gathering\nSCMD_DEBUG=1 scmd /my-command\n</code></pre></p>"},{"location":"command-authoring/automatic-context/#token-limit-exceeded","title":"Token Limit Exceeded","text":"<p>Symptom: Context warning about truncation</p> <p>Cause: Files exceed <code>max_tokens</code></p> <p>Solution: - Increase <code>max_tokens</code> - Use more specific file patterns - Exclude large generated files</p> <pre><code>context:\n  files:\n    - \"*.go\"\n    - \"!*_generated.go\"  # Exclude generated\n  max_tokens: 12000  # Increase limit\n</code></pre>"},{"location":"command-authoring/automatic-context/#sensitive-data-exposure","title":"Sensitive Data Exposure","text":"<p>Symptom: Environment variables include secrets</p> <p>Solution: Only include non-sensitive variables:</p> <pre><code>context:\n  env:\n    - \"NODE_ENV\"     # Safe\n    - \"LOG_LEVEL\"    # Safe\n    # NOT: DATABASE_PASSWORD, API_SECRET\n</code></pre>"},{"location":"command-authoring/automatic-context/#file-too-large","title":"File Too Large","text":"<p>Symptom: <code>[File too large: X bytes]</code> in context</p> <p>Cause: File &gt;1MB (safety limit)</p> <p>Solution: - Exclude large files with patterns - Split large files into smaller modules - Use more specific patterns</p>"},{"location":"command-authoring/automatic-context/#limitations","title":"Limitations","text":""},{"location":"command-authoring/automatic-context/#current-limitations","title":"Current Limitations","text":"<ol> <li>No Recursive Limits: <code>**/*.go</code> may match thousands of files</li> <li> <p>Mitigate with <code>max_tokens</code></p> </li> <li> <p>No File Filtering: Can't filter file contents</p> </li> <li> <p>Workaround: Use hooks to preprocess</p> </li> <li> <p>Static Patterns: Can't use dynamic patterns</p> </li> <li> <p>Planned: Template support in patterns</p> </li> <li> <p>No Caching: Context re-gathered each execution</p> </li> <li> <p>Planned: Context caching</p> </li> <li> <p>English Only: Context headers in English</p> </li> <li>Planned: Internationalization</li> </ol>"},{"location":"command-authoring/automatic-context/#future-enhancements","title":"Future Enhancements","text":"<ul> <li> Dynamic file patterns with templates</li> <li> File content filtering (e.g., only public functions)</li> <li> Context caching for repeated executions</li> <li> Semantic file selection (most relevant files)</li> <li> Custom context sources (databases, APIs)</li> <li> Context compression strategies</li> </ul>"},{"location":"command-authoring/automatic-context/#related-documentation","title":"Related Documentation","text":"<ul> <li>Command YAML Specification - Full spec reference</li> <li>Prompts and Templates - Writing effective prompts</li> <li>Tool Calling Guide - Combining with tools</li> <li>Best Practices - Command design patterns</li> </ul>"},{"location":"command-authoring/automatic-context/#examples","title":"Examples","text":"<p>See full examples for: - code-review-with-context.yaml - Real command using context - Tool calling examples - Context + tools</p>"},{"location":"command-authoring/composition/","title":"Command Composition","text":"<p>Command composition allows you to chain multiple commands together in powerful workflows. Build complex AI pipelines by combining simple, focused commands.</p> <p>Why Composition?</p> <ul> <li>Modularity: Reuse existing commands as building blocks</li> <li>Complexity: Solve complex problems with simple components</li> <li>Maintainability: Update individual commands without changing workflows</li> <li>Flexibility: Mix and match commands for different scenarios</li> </ul>"},{"location":"command-authoring/composition/#composition-types","title":"Composition Types","text":"<p>scmd supports three types of composition:</p>"},{"location":"command-authoring/composition/#1-pipeline-sequential","title":"1. Pipeline (Sequential)","text":"<p>Chain commands sequentially, passing output as input to the next command.</p> <pre><code>compose:\n  pipeline:\n    - command: step1\n    - command: step2\n    - command: step3\n</code></pre> <p>Flow: <pre><code>Input \u2192 step1 \u2192 output1 \u2192 step2 \u2192 output2 \u2192 step3 \u2192 Final Output\n</code></pre></p>"},{"location":"command-authoring/composition/#2-parallel-concurrent","title":"2. Parallel (Concurrent)","text":"<p>Run commands concurrently and merge their results.</p> <pre><code>compose:\n  parallel:\n    - command1\n    - command2\n    - command3\n</code></pre> <p>Flow: <pre><code>Input \u2192 command1 \u2192 output1 \u2510\n      \u2192 command2 \u2192 output2 \u251c\u2500\u2192 Merged Output\n      \u2192 command3 \u2192 output3 \u2518\n</code></pre></p>"},{"location":"command-authoring/composition/#3-fallback-try-until-success","title":"3. Fallback (Try Until Success)","text":"<p>Try commands in order until one succeeds.</p> <pre><code>compose:\n  fallback:\n    - primary-command\n    - backup-command\n    - last-resort\n</code></pre> <p>Flow: <pre><code>Input \u2192 primary \u2717 \u2192 backup \u2717 \u2192 last-resort \u2713 \u2192 Output\n</code></pre></p>"},{"location":"command-authoring/composition/#pipeline-composition","title":"Pipeline Composition","text":""},{"location":"command-authoring/composition/#basic-pipeline","title":"Basic Pipeline","text":"<pre><code>name: analyze-and-summarize\nversion: 1.0.0\ndescription: Analyze code then summarize findings\n\ncompose:\n  pipeline:\n    - command: analyze-code\n    - command: summarize\n\nprompt:\n  template: \"Placeholder - using composition instead\"\n</code></pre> <p>Usage: <pre><code>cat main.go | scmd analyze-and-summarize\n</code></pre></p> <p>What happens: 1. <code>analyze-code</code> receives main.go content 2. Produces detailed analysis 3. <code>summarize</code> receives analysis 4. Produces concise summary</p>"},{"location":"command-authoring/composition/#pipeline-with-arguments","title":"Pipeline with Arguments","text":"<p>Pass custom arguments to each step:</p> <pre><code>compose:\n  pipeline:\n    - command: explain\n      args:\n        detail: high\n        format: markdown\n    - command: summarize\n      args:\n        length: short\n        style: bullet-points\n</code></pre>"},{"location":"command-authoring/composition/#pipeline-with-transforms","title":"Pipeline with Transforms","text":"<p>Transform output between steps:</p> <pre><code>compose:\n  pipeline:\n    - command: analyze-code\n      transform: trim  # Remove whitespace\n    - command: extract-issues\n      transform: json.issues  # Extract JSON field\n    - command: summarize\n      transform: upper  # Convert to uppercase\n</code></pre> <p>Available transforms: - <code>trim</code>: Remove leading/trailing whitespace - <code>upper</code>: Convert to uppercase - <code>lower</code>: Convert to lowercase - <code>first</code>: Get first line - <code>last</code>: Get last non-empty line - <code>lines</code>: Count lines - <code>json.field</code>: Extract JSON field</p>"},{"location":"command-authoring/composition/#error-handling-in-pipelines","title":"Error Handling in Pipelines","text":"<pre><code>compose:\n  pipeline:\n    - command: try-fast-analysis\n      on_error: continue  # Continue even if fails\n    - command: deep-analysis\n      on_error: stop      # Stop pipeline if fails (default)\n    - command: summarize\n</code></pre> <p>Error handling options: - <code>stop</code> (default): Stop pipeline on error - <code>continue</code>: Skip failed step, continue with next - <code>fallback</code>: Try alternative command (requires <code>fallback_command</code>)</p>"},{"location":"command-authoring/composition/#parallel-composition","title":"Parallel Composition","text":""},{"location":"command-authoring/composition/#basic-parallel","title":"Basic Parallel","text":"<pre><code>name: multi-perspective-review\nversion: 1.0.0\ndescription: Review code from multiple angles\n\ncompose:\n  parallel:\n    - security-review\n    - performance-review\n    - style-review\n</code></pre> <p>Usage: <pre><code>cat app.js | scmd multi-perspective-review\n</code></pre></p> <p>Output: <pre><code>## security-review\n- Line 42: Potential SQL injection\n- Line 78: Missing input validation\n...\n\n## performance-review\n- Line 15: O(n\u00b2) loop can be optimized\n- Line 93: Redundant database query\n...\n\n## style-review\n- Inconsistent indentation\n- Missing JSDoc comments\n...\n</code></pre></p>"},{"location":"command-authoring/composition/#parallel-with-dependencies","title":"Parallel with Dependencies","text":"<p>Commands run in parallel but respect dependencies:</p> <pre><code>compose:\n  parallel:\n    - command1  # Runs immediately\n    - command2  # Runs immediately\n    - command3  # Runs immediately\n\n  # All must complete before next step\n  then:\n    - combine-results\n</code></pre>"},{"location":"command-authoring/composition/#fallback-composition","title":"Fallback Composition","text":""},{"location":"command-authoring/composition/#basic-fallback","title":"Basic Fallback","text":"<pre><code>name: smart-explain\nversion: 1.0.0\ndescription: Try multiple explanation strategies\n\ncompose:\n  fallback:\n    - explain-with-examples    # Try first (detailed)\n    - explain-simple           # Fallback (simpler)\n    - explain-minimal          # Last resort (basic)\n</code></pre> <p>Usage: <pre><code>cat complex-code.rs | scmd smart-explain\n</code></pre></p> <p>What happens: 1. Tries <code>explain-with-examples</code> 2. If it fails or times out, tries <code>explain-simple</code> 3. If that fails, tries <code>explain-minimal</code> 4. Returns first successful result</p>"},{"location":"command-authoring/composition/#fallback-with-different-backends","title":"Fallback with Different Backends","text":"<pre><code>compose:\n  fallback:\n    - local-explain       # Try local model first\n    - cloud-explain       # Fallback to cloud if local fails\n</code></pre>"},{"location":"command-authoring/composition/#advanced-patterns","title":"Advanced Patterns","text":""},{"location":"command-authoring/composition/#mixed-composition","title":"Mixed Composition","text":"<p>Combine composition types:</p> <pre><code>name: comprehensive-analysis\ncompose:\n  pipeline:\n    # Stage 1: Parallel analysis\n    - parallel:\n        - static-analysis\n        - complexity-check\n        - security-scan\n      merge: true  # Merge parallel outputs\n\n    # Stage 2: Process combined results\n    - command: aggregate-findings\n\n    # Stage 3: Try summaries until one works\n    - fallback:\n        - detailed-summary\n        - basic-summary\n</code></pre>"},{"location":"command-authoring/composition/#conditional-steps","title":"Conditional Steps","text":"<pre><code>compose:\n  pipeline:\n    - command: check-type\n      output_var: file_type  # Store output in variable\n\n    - command: process-javascript\n      if: \"{{.file_type}} == 'javascript'\"\n\n    - command: process-python\n      if: \"{{.file_type}} == 'python'\"\n</code></pre> <p>Coming Soon</p> <p>Advanced conditional logic is planned for future releases.</p>"},{"location":"command-authoring/composition/#dynamic-pipeline","title":"Dynamic Pipeline","text":"<p>Generate pipeline steps dynamically:</p> <pre><code>compose:\n  pipeline:\n    # First step discovers what to do\n    - command: discover-tasks\n      output_format: json\n\n    # Remaining steps created from JSON\n    dynamic:\n      source: \"{{.tasks}}\"\n      template: |\n        {% for task in tasks %}\n        - command: {{task.command}}\n          args: {{task.args}}\n        {% endfor %}\n</code></pre> <p>Experimental</p> <p>Dynamic composition is experimental. Schema may change.</p>"},{"location":"command-authoring/composition/#real-world-examples","title":"Real-World Examples","text":""},{"location":"command-authoring/composition/#example-1-code-review-pipeline","title":"Example 1: Code Review Pipeline","text":"<pre><code>name: full-code-review\nversion: 1.0.0\ndescription: Complete code review workflow\n\ncompose:\n  pipeline:\n    # Stage 1: Run linters and tests\n    - command: run-lint\n      on_error: continue\n      transform: trim\n\n    # Stage 2: Parallel static analysis\n    - parallel:\n        - security-scan\n        - complexity-analysis\n        - dependency-check\n\n    # Stage 3: AI review\n    - command: ai-review\n      args:\n        focus: critical-issues\n\n    # Stage 4: Generate report\n    - command: format-review-report\n      args:\n        format: markdown\n        include_metrics: true\n\n# Fallback prompt if composition not available\nprompt:\n  template: \"This command requires composition support\"\n</code></pre> <p>Usage: <pre><code>git diff | scmd full-code-review &gt; review.md\n</code></pre></p>"},{"location":"command-authoring/composition/#example-2-documentation-pipeline","title":"Example 2: Documentation Pipeline","text":"<pre><code>name: auto-documentation\nversion: 1.0.0\ndescription: Generate comprehensive documentation\n\ncompose:\n  pipeline:\n    # Extract code structure\n    - command: extract-exports\n      transform: json\n\n    # Generate documentation sections in parallel\n    - parallel:\n        - generate-api-docs\n        - generate-examples\n        - generate-usage-guide\n\n    # Combine and format\n    - command: merge-docs\n      args:\n        format: markdown\n        toc: true\n\n    # Add diagrams\n    - command: add-diagrams\n      args:\n        types: [sequence, class, flow]\n\n# Output to file with post-hook\nhooks:\n  post:\n    - shell: cat $OUTPUT &gt; README.md\n</code></pre>"},{"location":"command-authoring/composition/#example-3-multi-stage-analysis","title":"Example 3: Multi-Stage Analysis","text":"<pre><code>name: deep-code-analysis\nversion: 1.0.0\ndescription: Progressive code analysis with fallbacks\n\ncompose:\n  pipeline:\n    # Quick scan first\n    - command: quick-scan\n      transform: trim\n\n    # Decide if deep analysis needed\n    - command: triage-issues\n      output_var: severity\n\n    # Deep analysis with fallbacks\n    - fallback:\n        # Try comprehensive analysis\n        - command: deep-analysis-with-tools\n          timeout: 60\n\n        # Fallback to standard analysis\n        - command: standard-analysis\n          timeout: 30\n\n        # Last resort: basic analysis\n        - command: basic-analysis\n          timeout: 10\n\n    # Generate recommendations\n    - command: generate-recommendations\n      args:\n        severity: \"{{.severity}}\"\n</code></pre>"},{"location":"command-authoring/composition/#example-4-multi-language-project","title":"Example 4: Multi-Language Project","text":"<pre><code>name: polyglot-review\nversion: 1.0.0\ndescription: Review multi-language projects\n\ncompose:\n  parallel:\n    # Language-specific reviews\n    - command: review-javascript\n      filter: \"*.js\"\n    - command: review-python\n      filter: \"*.py\"\n    - command: review-go\n      filter: \"*.go\"\n    - command: review-rust\n      filter: \"*.rs\"\n\n  # Then combine results\n  then:\n    pipeline:\n      - command: merge-reviews\n      - command: prioritize-issues\n      - command: generate-unified-report\n</code></pre>"},{"location":"command-authoring/composition/#composition-with-hooks","title":"Composition with Hooks","text":"<p>Combine composition with hooks for powerful workflows:</p> <pre><code>name: tested-refactor\nversion: 1.0.0\ndescription: Refactor code with automated testing\n\nhooks:\n  pre:\n    # Backup original\n    - shell: cp {{.file}} {{.file}}.backup\n    # Run tests (baseline)\n    - shell: npm test &gt; /tmp/tests-before.txt\n\ncompose:\n  pipeline:\n    # Analyze code\n    - command: analyze-for-refactor\n      transform: json\n\n    # Generate refactoring plan\n    - command: plan-refactor\n      args:\n        safe_mode: true\n\n    # Apply refactoring\n    - command: apply-refactor\n\nhooks:\n  post:\n    # Run tests again\n    - shell: npm test &gt; /tmp/tests-after.txt\n    # Compare results\n    - shell: diff /tmp/tests-before.txt /tmp/tests-after.txt\n    # If tests fail, restore backup\n    - shell: |\n        if [ $? -ne 0 ]; then\n          echo \"Tests failed, restoring backup\"\n          mv {{.file}}.backup {{.file}}\n        else\n          rm {{.file}}.backup\n        fi\n</code></pre>"},{"location":"command-authoring/composition/#composition-with-tool-calling","title":"Composition with Tool Calling","text":"<p>Tool calling works within composed commands:</p> <pre><code>name: autonomous-project-setup\ncompose:\n  pipeline:\n    # Analyze project requirements (uses tools to read files)\n    - command: analyze-requirements\n\n    # Generate project structure (uses tools to write files)\n    - command: generate-structure\n\n    # Install dependencies (uses shell tool)\n    - command: install-deps\n\n    # Initialize git (uses shell tool)\n    - command: init-git\n\n    # Generate docs (uses write_file tool)\n    - command: generate-docs\n</code></pre> <p>Each command in the pipeline can use tools independently.</p>"},{"location":"command-authoring/composition/#performance-considerations","title":"Performance Considerations","text":""},{"location":"command-authoring/composition/#pipeline-performance","title":"Pipeline Performance","text":"<p>Pipelines run sequentially:</p> <pre><code>Time = time(cmd1) + time(cmd2) + time(cmd3) + ...\n</code></pre> <p>Optimization: - Use parallel composition where possible - Minimize number of steps - Use transforms instead of full commands when possible</p>"},{"location":"command-authoring/composition/#parallel-performance","title":"Parallel Performance","text":"<p>Parallel commands run concurrently:</p> <pre><code>Time \u2248 max(time(cmd1), time(cmd2), time(cmd3))\n</code></pre> <p>Optimization: - Balance command complexity - Be aware of resource limits (CPU, memory, API rate limits) - Don't overuse (3-5 parallel commands is usually optimal)</p>"},{"location":"command-authoring/composition/#fallback-performance","title":"Fallback Performance","text":"<p>Best case: first command succeeds Worst case: all commands fail</p> <pre><code>Time = time(cmd1) + time(cmd2) + ... + time(cmdN)\n</code></pre> <p>Optimization: - Order commands by success probability (most likely first) - Set appropriate timeouts - Use cheaper models for fallbacks</p>"},{"location":"command-authoring/composition/#best-practices","title":"Best Practices","text":""},{"location":"command-authoring/composition/#1-keep-commands-focused","title":"1. Keep Commands Focused","text":"<p>Each command should do one thing well:</p> <p>Good: <pre><code>compose:\n  pipeline:\n    - command: extract-functions  # Single responsibility\n    - command: analyze-complexity # Single responsibility\n    - command: suggest-improvements # Single responsibility\n</code></pre></p> <p>Bad: <pre><code>compose:\n  pipeline:\n    - command: do-everything  # Too broad\n</code></pre></p>"},{"location":"command-authoring/composition/#2-handle-errors-gracefully","title":"2. Handle Errors Gracefully","text":"<pre><code>compose:\n  pipeline:\n    - command: optional-lint\n      on_error: continue  # Non-critical\n\n    - command: critical-security-scan\n      on_error: stop      # Critical\n\n    - command: generate-report\n</code></pre>"},{"location":"command-authoring/composition/#3-use-meaningful-transforms","title":"3. Use Meaningful Transforms","text":"<pre><code>compose:\n  pipeline:\n    - command: analyze\n      transform: json.critical_issues  # Clear intent\n\n    - command: format\n      transform: trim  # Remove clutter\n</code></pre>"},{"location":"command-authoring/composition/#4-document-complex-compositions","title":"4. Document Complex Compositions","text":"<pre><code># Multi-stage analysis pipeline\n# 1. Quick scan for obvious issues\n# 2. Parallel deep analysis (security, performance, style)\n# 3. Aggregate findings\n# 4. Generate prioritized report\ncompose:\n  pipeline:\n    - command: quick-scan\n    - parallel:\n        - security-analysis\n        - performance-analysis\n        - style-analysis\n    - command: aggregate\n    - command: prioritize\n</code></pre>"},{"location":"command-authoring/composition/#5-test-compositions","title":"5. Test Compositions","text":"<p>Test individual commands first:</p> <pre><code># Test each command\ncat test.js | scmd analyze-code\ncat test.js | scmd summarize\n\n# Then test composition\ncat test.js | scmd analyze-and-summarize\n</code></pre>"},{"location":"command-authoring/composition/#troubleshooting","title":"Troubleshooting","text":""},{"location":"command-authoring/composition/#command-not-found-in-pipeline","title":"\"Command not found\" in Pipeline","text":"<p>Command in pipeline doesn't exist:</p> <pre><code># List available commands\nscmd slash list\n\n# Install missing command\nscmd repo install official/missing-command\n</code></pre>"},{"location":"command-authoring/composition/#parallel-commands-timing-out","title":"Parallel Commands Timing Out","text":"<p>Too many parallel commands or commands too slow:</p> <ol> <li>Reduce parallel count</li> <li>Increase timeouts</li> <li>Use faster models</li> <li>Simplify commands</li> </ol>"},{"location":"command-authoring/composition/#pipeline-stops-unexpectedly","title":"Pipeline Stops Unexpectedly","text":"<p>A command failed with <code>on_error: stop</code> (default):</p> <pre><code># Run with debug to see which command failed\nSCMD_DEBUG=1 scmd your-pipeline\n</code></pre>"},{"location":"command-authoring/composition/#transforms-not-working","title":"Transforms Not Working","text":"<p>Transform name is incorrect or not supported:</p> <p>Supported transforms: - <code>trim</code>, <code>upper</code>, <code>lower</code>, <code>first</code>, <code>last</code>, <code>lines</code> - <code>json.fieldname</code></p> <p>Custom transforms: Not yet supported, coming in future release.</p>"},{"location":"command-authoring/composition/#limitations","title":"Limitations","text":""},{"location":"command-authoring/composition/#current-limitations","title":"Current Limitations","text":"<ol> <li>Maximum 20 steps per pipeline</li> <li>No nested composition (compose within compose)</li> <li>Limited transforms (fixed set, no custom)</li> <li>No conditional logic (planned for future)</li> <li>No loops (planned for future)</li> <li>Sequential only within parallel (can't have pipeline within parallel)</li> </ol>"},{"location":"command-authoring/composition/#future-enhancements","title":"Future Enhancements","text":"<ul> <li> Nested composition support</li> <li> Custom transforms</li> <li> Conditional steps (<code>if/else</code>)</li> <li> Loops (<code>for each file</code>)</li> <li> Variables and state passing</li> <li> Composition templates</li> <li> Visual pipeline editor</li> </ul>"},{"location":"command-authoring/composition/#next-steps","title":"Next Steps","text":"<ul> <li>Tool Calling Guide - Use tools in composed commands</li> <li>Hooks Guide - Add automation to compositions</li> <li>Advanced Examples - Complex real-world pipelines</li> <li>Best Practices - Command design tips</li> </ul>"},{"location":"command-authoring/hooks/","title":"Hooks (Pre/Post Execution)","text":"<p>Hooks let you run shell commands or other scmd commands before and after the main LLM execution. Perfect for automation, validation, and integration with existing workflows.</p> <p>When to Use Hooks</p> <ul> <li>Pre-hooks: Gather context, validate inputs, check prerequisites</li> <li>Post-hooks: Process results, trigger actions, cleanup resources</li> </ul>"},{"location":"command-authoring/hooks/#basic-example","title":"Basic Example","text":"<pre><code>name: git-commit-with-checks\nversion: 1.0.0\ndescription: Generate commit message with pre/post validation\n\nhooks:\n  pre:\n    - shell: git status --short\n    - shell: git diff --check  # Check for whitespace errors\n  post:\n    - shell: echo \"Commit message generated!\"\n    - shell: git diff --stat\n\nprompt:\n  system: |\n    Generate a clear, conventional commit message.\n  template: |\n    Based on the staged changes, create a commit message.\n\nmodel:\n  temperature: 0.3\n</code></pre> <p>Execution flow: <pre><code>1. Run pre-hooks\n   \u2193\n2. Execute LLM completion\n   \u2193\n3. Run post-hooks\n   \u2193\n4. Return result\n</code></pre></p>"},{"location":"command-authoring/hooks/#hook-types","title":"Hook Types","text":""},{"location":"command-authoring/hooks/#shell-hooks","title":"Shell Hooks","text":"<p>Execute shell commands directly:</p> <pre><code>hooks:\n  pre:\n    - shell: echo \"Starting analysis...\"\n    - shell: mkdir -p ./output\n    - shell: date +%Y-%m-%d &gt; ./output/timestamp.txt\n</code></pre> <p>Features: - Full shell syntax support - Output is captured but not shown to user - Errors stop execution (can be configured) - 30-second timeout per command</p>"},{"location":"command-authoring/hooks/#command-hooks","title":"Command Hooks","text":"<p>Execute other scmd commands:</p> <pre><code>hooks:\n  pre:\n    - command: validate-code\n    - command: check-style\n  post:\n    - command: update-docs\n</code></pre> <p>Use cases: - Chain multiple AI commands - Reuse existing command logic - Build complex workflows</p>"},{"location":"command-authoring/hooks/#hook-specifications","title":"Hook Specifications","text":""},{"location":"command-authoring/hooks/#full-hook-schema","title":"Full Hook Schema","text":"<pre><code>hooks:\n  pre:\n    - shell: \"command\"           # Shell command\n      if: \"condition\"            # Optional condition\n    - command: \"scmd-command\"    # scmd command\n      if: \"condition\"\n  post:\n    - shell: \"command\"\n    - command: \"scmd-command\"\n</code></pre>"},{"location":"command-authoring/hooks/#conditional-hooks","title":"Conditional Hooks","text":"<p>Run hooks only when conditions are met:</p> <pre><code>hooks:\n  pre:\n    - shell: git status\n      if: \"{{.git}}\"  # Only if git context enabled\n    - shell: npm test\n      if: \"{{.run_tests}}\"  # Only if run_tests flag set\n</code></pre> <p>Note: Conditional hook evaluation is currently basic. Complex conditions coming in future releases.</p>"},{"location":"command-authoring/hooks/#common-patterns","title":"Common Patterns","text":""},{"location":"command-authoring/hooks/#1-git-integration","title":"1. Git Integration","text":"<pre><code>name: smart-commit\nhooks:\n  pre:\n    # Check for unstaged changes\n    - shell: git diff --quiet || echo \"Warning: Unstaged changes\"\n    # Check current branch\n    - shell: git branch --show-current\n    # Run linter\n    - shell: npm run lint 2&gt;&amp;1\n  post:\n    # Show what will be committed\n    - shell: git diff --staged --stat\n    # Copy commit message to clipboard (macOS)\n    - shell: echo \"$COMMIT_MSG\" | pbcopy\n\nprompt:\n  template: |\n    Generate a commit message for these changes:\n    {{.stdin}}\n</code></pre>"},{"location":"command-authoring/hooks/#2-test-execution","title":"2. Test Execution","text":"<pre><code>name: test-and-explain\nhooks:\n  pre:\n    # Run tests and capture output\n    - shell: go test ./... &gt; /tmp/test-output.txt 2&gt;&amp;1 || true\n  post:\n    # If tests failed, open results\n    - shell: |\n        if [ $? -ne 0 ]; then\n          cat /tmp/test-output.txt\n        fi\n\nprompt:\n  template: |\n    Analyze the test results and explain failures:\n    $(cat /tmp/test-output.txt)\n</code></pre>"},{"location":"command-authoring/hooks/#3-environment-validation","title":"3. Environment Validation","text":"<pre><code>name: deploy-check\nhooks:\n  pre:\n    # Check if kubectl is installed\n    - shell: which kubectl || echo \"kubectl not found\"\n    # Verify cluster connection\n    - shell: kubectl cluster-info\n    # Check current context\n    - shell: kubectl config current-context\n  post:\n    # Log deployment\n    - shell: echo \"Deployed at $(date)\" &gt;&gt; deploy.log\n\nprompt:\n  template: |\n    Generate a deployment plan for:\n    {{.service}}\n</code></pre>"},{"location":"command-authoring/hooks/#4-file-operations","title":"4. File Operations","text":"<pre><code>name: code-review-with-backup\nhooks:\n  pre:\n    # Create backup\n    - shell: cp {{.file}} {{.file}}.backup\n    # Get file stats\n    - shell: wc -l {{.file}}\n  post:\n    # Save review to file\n    - shell: echo \"$REVIEW\" &gt; review-$(date +%Y%m%d).md\n    # Clean up backup\n    - shell: rm {{.file}}.backup\n\nprompt:\n  template: |\n    Review the code in {{.file}}:\n    $(cat {{.file}})\n</code></pre>"},{"location":"command-authoring/hooks/#5-notification-hooks","title":"5. Notification Hooks","text":"<pre><code>name: ai-task-with-notifications\nhooks:\n  pre:\n    - shell: osascript -e 'display notification \"AI task started\"'\n  post:\n    - shell: osascript -e 'display notification \"AI task completed\"'\n    # Send to Slack\n    - shell: |\n        curl -X POST $SLACK_WEBHOOK_URL \\\n          -H 'Content-Type: application/json' \\\n          -d '{\"text\": \"AI task completed\"}'\n\nprompt:\n  template: |\n    {{.task}}\n</code></pre>"},{"location":"command-authoring/hooks/#advanced-features","title":"Advanced Features","text":""},{"location":"command-authoring/hooks/#multi-line-shell-scripts","title":"Multi-Line Shell Scripts","text":"<pre><code>hooks:\n  pre:\n    - shell: |\n        #!/bin/bash\n        set -e  # Exit on error\n\n        echo \"Preparing environment...\"\n\n        # Create directories\n        mkdir -p ./output/{reports,logs,temp}\n\n        # Set variables\n        export TIMESTAMP=$(date +%Y%m%d_%H%M%S)\n        export OUTPUT_DIR=\"./output/reports\"\n\n        echo \"Environment ready\"\n</code></pre>"},{"location":"command-authoring/hooks/#error-handling","title":"Error Handling","text":"<p>By default, hook errors stop execution. Override with <code>|| true</code>:</p> <pre><code>hooks:\n  pre:\n    # This failure won't stop execution\n    - shell: npm run optional-check || true\n\n    # This failure WILL stop execution\n    - shell: npm run critical-check\n</code></pre>"},{"location":"command-authoring/hooks/#accessing-hook-output","title":"Accessing Hook Output","text":"<p>Currently, hook output is captured but not passed to the LLM. Workaround using files:</p> <pre><code>hooks:\n  pre:\n    # Write to temporary file\n    - shell: git log -1 --pretty=%B &gt; /tmp/last-commit.txt\n\nprompt:\n  template: |\n    Previous commit message:\n    $(cat /tmp/last-commit.txt)\n\n    Generate a new commit message for:\n    {{.stdin}}\n</code></pre>"},{"location":"command-authoring/hooks/#template-variables-in-hooks","title":"Template Variables in Hooks","text":"<p>Use command arguments in hooks:</p> <pre><code>args:\n  - name: file\n    required: true\n  - name: output_dir\n    default: ./output\n\nhooks:\n  pre:\n    - shell: echo \"Processing {{.file}}\"\n    - shell: mkdir -p {{.output_dir}}\n  post:\n    - shell: cp {{.file}} {{.output_dir}}/\n</code></pre>"},{"location":"command-authoring/hooks/#real-world-examples","title":"Real-World Examples","text":""},{"location":"command-authoring/hooks/#example-1-automated-code-review","title":"Example 1: Automated Code Review","text":"<pre><code>name: auto-review\nversion: 1.0.0\ndescription: Review code with automated checks\n\nargs:\n  - name: file\n    description: File to review\n    required: true\n\nhooks:\n  pre:\n    # Run linter\n    - shell: eslint {{.file}} &gt; /tmp/lint-results.txt || true\n    # Check complexity\n    - shell: npx complexity-report {{.file}} &gt; /tmp/complexity.txt || true\n    # Run tests\n    - shell: npm test -- {{.file}} &gt; /tmp/test-results.txt || true\n  post:\n    # Save complete review\n    - shell: |\n        cat /tmp/lint-results.txt \\\n            /tmp/complexity.txt \\\n            /tmp/test-results.txt \\\n            &gt; review-{{.file}}.txt\n    # Clean up\n    - shell: rm /tmp/{lint,complexity,test}-results.txt\n\nprompt:\n  system: |\n    You are a senior code reviewer.\n    Consider linting, complexity, and test results in your review.\n  template: |\n    Review {{.file}}:\n\n    Linter output: $(cat /tmp/lint-results.txt)\n    Complexity: $(cat /tmp/complexity.txt)\n    Test results: $(cat /tmp/test-results.txt)\n\n    Code:\n    $(cat {{.file}})\n</code></pre> <p>Usage: <pre><code>scmd auto-review src/app.js\n</code></pre></p>"},{"location":"command-authoring/hooks/#example-2-documentation-generator","title":"Example 2: Documentation Generator","text":"<pre><code>name: doc-gen\nversion: 1.0.0\ndescription: Generate documentation from code\n\nargs:\n  - name: module\n    required: true\n\nhooks:\n  pre:\n    # Extract exports\n    - shell: |\n        grep -E \"^export|^function|^class\" {{.module}} \\\n          &gt; /tmp/exports.txt\n    # Get git info\n    - shell: |\n        echo \"Last modified: $(git log -1 --format=%cd {{.module}})\" \\\n          &gt; /tmp/git-info.txt\n  post:\n    # Save to docs directory\n    - shell: mkdir -p ./docs/api\n    - shell: |\n        echo \"# {{.module}} API Documentation\" &gt; ./docs/api/{{.module}}.md\n        echo \"\" &gt;&gt; ./docs/api/{{.module}}.md\n        cat $AI_OUTPUT &gt;&gt; ./docs/api/{{.module}}.md\n    # Update index\n    - shell: |\n        echo \"- [{{.module}}](./api/{{.module}}.md)\" \\\n          &gt;&gt; ./docs/index.md\n\nprompt:\n  template: |\n    Generate API documentation for {{.module}}:\n\n    Exports:\n    $(cat /tmp/exports.txt)\n\n    Git info:\n    $(cat /tmp/git-info.txt)\n\n    Code:\n    $(cat {{.module}})\n</code></pre>"},{"location":"command-authoring/hooks/#example-3-database-migration-helper","title":"Example 3: Database Migration Helper","text":"<pre><code>name: migration-helper\nversion: 1.0.0\ndescription: Generate database migration from schema changes\n\nhooks:\n  pre:\n    # Dump current schema\n    - shell: pg_dump --schema-only mydb &gt; /tmp/old-schema.sql\n    # Check migration directory\n    - shell: mkdir -p ./migrations\n    # Get next migration number\n    - shell: |\n        LAST=$(ls ./migrations | tail -1 | cut -d_ -f1)\n        NEXT=$((LAST + 1))\n        echo $NEXT &gt; /tmp/migration-number.txt\n  post:\n    # Save migration file\n    - shell: |\n        NUM=$(cat /tmp/migration-number.txt)\n        DATE=$(date +%Y%m%d)\n        cp $AI_OUTPUT ./migrations/${NUM}_${DATE}_migration.sql\n    # Test migration (dry run)\n    - shell: |\n        psql mydb_test &lt; ./migrations/${NUM}_${DATE}_migration.sql || \\\n        echo \"Warning: Migration test failed\"\n\nprompt:\n  template: |\n    Generate a migration from old to new schema:\n\n    Old schema:\n    $(cat /tmp/old-schema.sql)\n\n    New schema:\n    $(cat {{.new_schema_file}})\n</code></pre>"},{"location":"command-authoring/hooks/#security-considerations","title":"Security Considerations","text":""},{"location":"command-authoring/hooks/#safe-commands-only","title":"Safe Commands Only","text":"<p>Hooks run with your shell permissions. Be careful with:</p> <ul> <li><code>rm -rf</code> (deletion)</li> <li><code>chmod</code> (permissions)</li> <li><code>curl -X POST</code> (write operations)</li> <li><code>sudo</code> (privilege escalation)</li> </ul>"},{"location":"command-authoring/hooks/#validating-user-input","title":"Validating User Input","text":"<p>Always validate arguments used in hooks:</p> <pre><code>args:\n  - name: file\n    required: true\n\nhooks:\n  pre:\n    # Bad - vulnerable to injection\n    - shell: cat {{.file}}\n\n    # Better - validate extension\n    - shell: |\n        if [[ \"{{.file}}\" == *.js ]]; then\n          cat {{.file}}\n        else\n          echo \"Error: Only .js files allowed\"\n          exit 1\n        fi\n</code></pre>"},{"location":"command-authoring/hooks/#secrets-in-hooks","title":"Secrets in Hooks","text":"<p>Never hardcode secrets:</p> <pre><code>hooks:\n  post:\n    # Bad\n    - shell: curl -H \"Token: sk-abc123\" api.com/notify\n\n    # Good - use environment variables\n    - shell: curl -H \"Token: $API_TOKEN\" api.com/notify\n</code></pre>"},{"location":"command-authoring/hooks/#debugging-hooks","title":"Debugging Hooks","text":"<p>Enable debug mode to see hook execution:</p> <pre><code>SCMD_DEBUG=1 scmd git-commit-with-checks\n</code></pre> <p>Output: <pre><code>[DEBUG] Executing pre-hook 1: git status --short\n[DEBUG] Hook output: M  src/main.go\n[DEBUG] Hook completed successfully\n\n[DEBUG] Executing pre-hook 2: git diff --check\n[DEBUG] Hook output: (no output)\n[DEBUG] Hook completed successfully\n\n[DEBUG] Executing LLM completion...\n[DEBUG] Completion successful\n\n[DEBUG] Executing post-hook 1: echo \"Commit message generated!\"\n[DEBUG] Hook output: Commit message generated!\n</code></pre></p>"},{"location":"command-authoring/hooks/#limitations","title":"Limitations","text":""},{"location":"command-authoring/hooks/#current-limitations","title":"Current Limitations","text":"<ol> <li>No hook output to LLM: Hook output isn't automatically passed to the prompt (workaround: use files)</li> <li>Basic conditionals: <code>if</code> condition support is limited</li> <li>No hook chaining: Can't pass output from one hook to another directly</li> <li>Fixed timeout: All hooks have 30-second timeout</li> <li>No async hooks: All hooks run synchronously</li> </ol>"},{"location":"command-authoring/hooks/#future-enhancements","title":"Future Enhancements","text":"<ul> <li> Pass hook output to prompt via <code>{{.hook_output}}</code></li> <li> Advanced conditionals (regex, comparisons)</li> <li> Hook dependencies (<code>depends_on: hook-name</code>)</li> <li> Configurable timeouts</li> <li> Parallel hook execution</li> <li> Hook templates/reusable hooks</li> </ul>"},{"location":"command-authoring/hooks/#best-practices","title":"Best Practices","text":""},{"location":"command-authoring/hooks/#1-keep-hooks-simple","title":"1. Keep Hooks Simple","text":"<p>Each hook should do one thing:</p> <p>Good: <pre><code>hooks:\n  pre:\n    - shell: git status\n    - shell: npm run lint\n    - shell: npm test\n</code></pre></p> <p>Bad: <pre><code>hooks:\n  pre:\n    - shell: |\n        git status &amp;&amp; npm run lint &amp;&amp; npm test &amp;&amp; \\\n        do-many-other-things...\n</code></pre></p>"},{"location":"command-authoring/hooks/#2-use-descriptive-comments","title":"2. Use Descriptive Comments","text":"<pre><code>hooks:\n  pre:\n    # Validate git repository\n    - shell: git rev-parse --git-dir\n\n    # Check for uncommitted changes\n    - shell: git diff --quiet || echo \"Warning: uncommitted changes\"\n\n    # Run linter\n    - shell: npm run lint\n</code></pre>"},{"location":"command-authoring/hooks/#3-handle-errors-gracefully","title":"3. Handle Errors Gracefully","text":"<pre><code>hooks:\n  pre:\n    # Optional check - don't fail if missing\n    - shell: which prettier || echo \"prettier not installed\"\n\n    # Critical check - fail if missing\n    - shell: which git || exit 1\n</code></pre>"},{"location":"command-authoring/hooks/#4-clean-up-after-yourself","title":"4. Clean Up After Yourself","text":"<pre><code>hooks:\n  pre:\n    - shell: mkdir -p /tmp/scmd-work\n  post:\n    - shell: rm -rf /tmp/scmd-work  # Clean up\n</code></pre>"},{"location":"command-authoring/hooks/#5-log-important-actions","title":"5. Log Important Actions","text":"<pre><code>hooks:\n  post:\n    - shell: echo \"[$(date)] Command executed\" &gt;&gt; ~/.scmd/command.log\n</code></pre>"},{"location":"command-authoring/hooks/#combining-with-other-features","title":"Combining with Other Features","text":""},{"location":"command-authoring/hooks/#hooks-tool-calling","title":"Hooks + Tool Calling","text":"<pre><code>hooks:\n  pre:\n    # Prepare environment for tools\n    - shell: mkdir -p ./tool-workspace\n    - shell: export TOOL_DIR=./tool-workspace\n\nprompt:\n  system: |\n    You have access to tools.\n    Write any files to ./tool-workspace directory.\n  template: |\n    {{.task}}\n\nhooks:\n  post:\n    # Process tool-generated files\n    - shell: cat ./tool-workspace/* &gt; combined-output.txt\n    - shell: rm -rf ./tool-workspace\n</code></pre>"},{"location":"command-authoring/hooks/#hooks-composition","title":"Hooks + Composition","text":"<pre><code>compose:\n  pipeline:\n    - command: analyze\n    - command: summarize\n\nhooks:\n  pre:\n    - shell: echo \"Starting pipeline...\"\n  post:\n    - shell: echo \"Pipeline complete!\"\n    - shell: cat $PIPELINE_OUTPUT &gt; results.txt\n</code></pre>"},{"location":"command-authoring/hooks/#troubleshooting","title":"Troubleshooting","text":""},{"location":"command-authoring/hooks/#hook-fails-silently","title":"Hook Fails Silently","text":"<p>Hooks don't show output by default. Enable debug:</p> <pre><code>SCMD_DEBUG=1 scmd your-command\n</code></pre>"},{"location":"command-authoring/hooks/#command-not-found-in-hook","title":"\"Command not found\" in Hook","text":"<p>Hook can't find your command. Options:</p> <ol> <li>Use full path: <code>/usr/local/bin/mycommand</code></li> <li>Add to PATH in hook: <code>export PATH=$PATH:/custom/path</code></li> <li>Use shell wrapper: <code>/bin/bash -c \"source ~/.bashrc &amp;&amp; mycommand\"</code></li> </ol>"},{"location":"command-authoring/hooks/#hook-timeout","title":"Hook Timeout","text":"<p>30-second timeout is too short. Options:</p> <ol> <li>Optimize the command</li> <li>Run long tasks in background: <code>long-command &amp;</code></li> <li>Use post-hook instead of pre-hook</li> </ol>"},{"location":"command-authoring/hooks/#variables-not-expanding","title":"Variables Not Expanding","text":"<p>Template variables only work in YAML strings:</p> <p>Works: <pre><code>hooks:\n  pre:\n    - shell: echo \"File: {{.file}}\"\n</code></pre></p> <p>Doesn't work: <pre><code>hooks:\n  pre:\n    - shell: MYVAR={{.file}}  # Variables in assignments don't expand\n</code></pre></p>"},{"location":"command-authoring/hooks/#next-steps","title":"Next Steps","text":"<ul> <li>Composition Guide - Chain commands with hooks</li> <li>Tool Calling Guide - Combine hooks with tools</li> <li>Examples - Real-world hook examples</li> <li>Best Practices - Command authoring tips</li> </ul>"},{"location":"command-authoring/tool-calling/","title":"Tool Calling (Agentic Behavior)","text":"<p>Tool calling enables LLMs to autonomously execute actions instead of just generating text. Commands can use tools to read files, run shell commands, fetch URLs, and more - automatically.</p> <p>What is Tool Calling?</p> <p>Tool calling (also called function calling or agentic behavior) allows the LLM to:</p> <ol> <li>Decide which tools to use based on the task</li> <li>Execute those tools with appropriate parameters</li> <li>See the results and decide next steps</li> <li>Iterate up to 5 rounds to complete complex tasks</li> </ol> <p>This enables commands to perform autonomous research, file manipulation, and multi-step workflows.</p>"},{"location":"command-authoring/tool-calling/#how-it-works","title":"How It Works","text":"<pre><code>sequenceDiagram\n    participant User\n    participant scmd\n    participant LLM\n    participant Tools\n\n    User-&gt;&gt;scmd: /project-analyzer ./myapp\n    scmd-&gt;&gt;LLM: Analyze project at ./myapp\n    LLM-&gt;&gt;Tools: shell(\"ls -la ./myapp\")\n    Tools--&gt;&gt;LLM: [file listings]\n    LLM-&gt;&gt;Tools: read_file(\"./myapp/package.json\")\n    Tools--&gt;&gt;LLM: [package.json content]\n    LLM-&gt;&gt;Tools: read_file(\"./myapp/README.md\")\n    Tools--&gt;&gt;LLM: [README content]\n    LLM--&gt;&gt;scmd: Analysis with recommendations\n    scmd--&gt;&gt;User: Project analysis complete</code></pre>"},{"location":"command-authoring/tool-calling/#built-in-tools","title":"Built-in Tools","text":"<p>scmd provides 4 built-in tools that work with any command that has tool calling enabled:</p>"},{"location":"command-authoring/tool-calling/#1-shell-tool","title":"1. Shell Tool","text":"<p>Execute safe shell commands (whitelist enforced).</p> <p>Parameters: - <code>command</code> (string, required): Shell command to execute - <code>working_dir</code> (string, optional): Working directory</p> <p>Example: <pre><code>{\n  \"name\": \"shell\",\n  \"parameters\": {\n    \"command\": \"git status --short\"\n  }\n}\n</code></pre></p> <p>Security: Only whitelisted commands are allowed: <pre><code>ls, cat, head, tail, find, grep, wc, diff, file, stat, du, df\ngit, pwd, whoami, date, uname, which, env, echo, printf\ncurl, wget, ping, dig, nslookup\ngo, python, python3, node, npm, cargo, make, docker, kubectl\nawk, sed, sort, uniq, cut, tr, jq\n</code></pre></p> <p>Custom commands can be added to the whitelist.</p>"},{"location":"command-authoring/tool-calling/#2-read-file-tool","title":"2. Read File Tool","text":"<p>Read file contents with optional line limits.</p> <p>Parameters: - <code>path</code> (string, required): File path to read - <code>max_lines</code> (number, optional): Maximum lines to read</p> <p>Example: <pre><code>{\n  \"name\": \"read_file\",\n  \"parameters\": {\n    \"path\": \"./config.yaml\",\n    \"max_lines\": 50\n  }\n}\n</code></pre></p>"},{"location":"command-authoring/tool-calling/#3-write-file-tool","title":"3. Write File Tool","text":"<p>Write content to files (requires user confirmation).</p> <p>Parameters: - <code>path</code> (string, required): File path to write - <code>content</code> (string, required): Content to write - <code>append</code> (boolean, optional): Append instead of overwrite</p> <p>Example: <pre><code>{\n  \"name\": \"write_file\",\n  \"parameters\": {\n    \"path\": \"./output.txt\",\n    \"content\": \"Analysis results...\",\n    \"append\": false\n  }\n}\n</code></pre></p> <p>Security: Requires user confirmation before writing.</p>"},{"location":"command-authoring/tool-calling/#4-http-get-tool","title":"4. HTTP GET Tool","text":"<p>Fetch data from URLs.</p> <p>Parameters: - <code>url</code> (string, required): URL to fetch - <code>max_size</code> (number, optional): Max response size in bytes (default: 1MB, max: 10MB)</p> <p>Example: <pre><code>{\n  \"name\": \"http_get\",\n  \"parameters\": {\n    \"url\": \"https://api.github.com/repos/golang/go\",\n    \"max_size\": 10485760\n  }\n}\n</code></pre></p>"},{"location":"command-authoring/tool-calling/#creating-tool-enabled-commands","title":"Creating Tool-Enabled Commands","text":"<p>To enable tool calling, simply write a command that expects the LLM to use tools. The tool calling system is enabled automatically when the backend supports it.</p>"},{"location":"command-authoring/tool-calling/#example-1-project-analyzer","title":"Example 1: Project Analyzer","text":"<pre><code>name: project-analyzer\nversion: 1.0.0\ndescription: Analyze project structure and suggest improvements\ncategory: code\n\nargs:\n  - name: path\n    description: Path to project directory\n    required: false\n    default: \".\"\n\nprompt:\n  system: |\n    You are an expert software architect and project analyzer.\n    You have access to tools to read files and execute shell commands.\n\n    Use these tools to:\n    1. Explore the project structure\n    2. Read configuration files\n    3. Check for common patterns and anti-patterns\n    4. Identify missing files (README, tests, docs)\n\n    Provide actionable recommendations for improving the project.\n\n  template: |\n    Analyze the project at: {{.path}}\n\n    Please:\n    1. List the directory structure\n    2. Read key files (package.json, README.md, go.mod, etc.)\n    3. Check for test files\n    4. Identify the tech stack\n    5. Provide recommendations for:\n       - Missing documentation\n       - Missing tests\n       - Project structure improvements\n       - Configuration best practices\n\nmodel:\n  temperature: 0.5\n  max_tokens: 2000\n</code></pre> <p>Usage: <pre><code>scmd project-analyzer ./my-app\n</code></pre></p> <p>What happens: 1. LLM reads the prompt 2. Decides to use <code>shell</code> tool to list directory: <code>ls -la ./my-app</code> 3. Sees the file list, decides to read <code>package.json</code> 4. Uses <code>read_file</code> tool: <code>read_file(\"./my-app/package.json\")</code> 5. Reads <code>README.md</code>, <code>tsconfig.json</code>, etc. 6. Analyzes all gathered information 7. Provides comprehensive recommendations</p>"},{"location":"command-authoring/tool-calling/#example-2-code-refactorer","title":"Example 2: Code Refactorer","text":"<pre><code>name: auto-refactor\nversion: 1.0.0\ndescription: Automatically refactor code with improvements\ncategory: code\n\nargs:\n  - name: file\n    description: File to refactor\n    required: true\n\nprompt:\n  system: |\n    You are a code refactoring expert.\n    You have access to read_file and write_file tools.\n\n    Process:\n    1. Read the specified file\n    2. Analyze for improvements (naming, structure, patterns)\n    3. Generate refactored version\n    4. Write improvements to a new file with .refactored suffix\n\n  template: |\n    Refactor the code in {{.file}}\n\n    Focus on:\n    - Better variable/function names\n    - Improved structure\n    - Modern best practices\n    - Remove code smells\n\n    Write the refactored code to {{.file}}.refactored\n\nmodel:\n  temperature: 0.3\n  max_tokens: 3000\n</code></pre> <p>Usage: <pre><code>scmd auto-refactor src/legacy-code.js\n</code></pre></p> <p>Tool calls: 1. <code>read_file(\"src/legacy-code.js\")</code> - Read original 2. [LLM analyzes and refactors] 3. <code>write_file(\"src/legacy-code.js.refactored\", &lt;refactored code&gt;)</code> - Write improved version</p>"},{"location":"command-authoring/tool-calling/#example-3-dependency-checker","title":"Example 3: Dependency Checker","text":"<pre><code>name: check-deps\nversion: 1.0.0\ndescription: Check for outdated dependencies and security issues\ncategory: tools\n\nprompt:\n  system: |\n    You are a dependency management expert.\n    Use tools to analyze project dependencies.\n\n  template: |\n    Check the dependencies for this project:\n\n    1. Read package.json or go.mod or requirements.txt\n    2. For each dependency, fetch latest version from registry\n    3. Check for known security vulnerabilities\n    4. Provide update recommendations\n\nmodel:\n  temperature: 0.4\n  max_tokens: 2000\n</code></pre> <p>Tool sequence: <pre><code>1. shell(\"find . -name package.json -o -name go.mod\")\n2. read_file(\"./package.json\")\n3. http_get(\"https://registry.npmjs.org/react/latest\")\n4. http_get(\"https://registry.npmjs.org/express/latest\")\n...\n[Analyzes versions and security]\n</code></pre></p>"},{"location":"command-authoring/tool-calling/#the-agent-loop","title":"The Agent Loop","text":"<p>scmd implements an agent loop that allows the LLM to iteratively use tools:</p> <pre><code>for round in range(max_rounds):  # max_rounds = 5\n    # 1. Call LLM with available tools\n    response = llm.complete_with_tools(prompt, tools)\n\n    # 2. If no tool calls, return final answer\n    if not response.tool_calls:\n        return response.content\n\n    # 3. Execute all tool calls\n    results = []\n    for tool_call in response.tool_calls:\n        result = execute_tool(tool_call.name, tool_call.parameters)\n        results.append(result)\n\n    # 4. Feed results back to LLM\n    prompt = build_next_prompt(response, results)\n\n# Return final result\nreturn final_response\n</code></pre> <p>Key points: - Maximum 5 rounds to prevent infinite loops - LLM can call multiple tools in each round - Tool results are fed back for next iteration - Loop ends when LLM provides final answer</p>"},{"location":"command-authoring/tool-calling/#backend-support","title":"Backend Support","text":"<p>Not all backends support tool calling. Here's the current status:</p> Backend Tool Calling Notes llama.cpp (qwen2.5-1.5b) \u2705 Full support Default, works offline Ollama (some models) \u2705 Full support Depends on model OpenAI \u2705 Full support GPT-4, GPT-3.5-turbo Together.ai \u2705 Full support Most models Groq \u2705 Full support llama, mixtral models <p>Check if your backend supports tool calling:</p> <pre><code>scmd backends\n</code></pre> <p>If tool calling is not supported, commands fall back to regular text generation.</p>"},{"location":"command-authoring/tool-calling/#security-safety","title":"Security &amp; Safety","text":""},{"location":"command-authoring/tool-calling/#command-whitelist","title":"Command Whitelist","text":"<p>The shell tool only allows safe, whitelisted commands:</p> <pre><code>// internal/tools/shell.go\nallowedCommands := map[string]bool{\n    \"ls\": true,\n    \"git\": true,\n    \"cat\": true,\n    // ... safe read-only and dev commands\n}\n</code></pre> <p>Blocked by default: - <code>rm</code>, <code>rmdir</code> (deletion) - <code>chmod</code>, <code>chown</code> (permissions) - <code>sudo</code>, <code>su</code> (privilege escalation) - <code>curl -X POST</code> (write operations)</p>"},{"location":"command-authoring/tool-calling/#confirmation-prompts","title":"Confirmation Prompts","text":"<p>Destructive tools require user confirmation:</p> <pre><code>[scmd] Tool write_file wants to write to /important/file.txt\n[scmd] Content: 1234 bytes\n[scmd] Continue? [y/N]:\n</code></pre> <p>You can bypass confirmations in scripts:</p> <pre><code>echo \"y\" | scmd auto-refactor file.js\n</code></pre>"},{"location":"command-authoring/tool-calling/#size-limits","title":"Size Limits","text":"<ul> <li>HTTP GET: Max 10MB per request</li> <li>File Read: Truncated at specified max_lines</li> <li>File Write: No size limit, but requires confirmation</li> <li>Shell Output: Captured but not limited (use with caution)</li> </ul>"},{"location":"command-authoring/tool-calling/#timeouts","title":"Timeouts","text":"<p>All tool operations have timeouts:</p> <ul> <li>Shell commands: 30 seconds</li> <li>HTTP requests: 30 seconds</li> <li>File operations: No timeout</li> </ul>"},{"location":"command-authoring/tool-calling/#advanced-patterns","title":"Advanced Patterns","text":""},{"location":"command-authoring/tool-calling/#conditional-tool-use","title":"Conditional Tool Use","text":"<pre><code>prompt:\n  template: |\n    Analyze the project at {{.path}}\n\n    If go.mod exists, read it and analyze Go dependencies.\n    If package.json exists, check npm dependencies.\n    If requirements.txt exists, check Python dependencies.\n\n    Use appropriate tools based on what you find.\n</code></pre>"},{"location":"command-authoring/tool-calling/#multi-step-workflows","title":"Multi-Step Workflows","text":"<pre><code>name: comprehensive-review\nprompt:\n  template: |\n    Perform a comprehensive code review:\n\n    1. Use shell to find all source files\n    2. Read each file (up to 10 files)\n    3. Run tests with shell (go test, npm test, etc.)\n    4. Read test output\n    5. Fetch coding standards from http://company.com/standards\n    6. Generate report\n    7. Write report to review-YYYY-MM-DD.md\n</code></pre>"},{"location":"command-authoring/tool-calling/#error-handling","title":"Error Handling","text":"<p>The LLM can handle tool errors gracefully:</p> <pre><code>prompt:\n  template: |\n    Try to read ./config.yaml\n    If that fails, try ./config.yml\n    If that fails, try ./.config/config.yaml\n    If all fail, use defaults\n</code></pre>"},{"location":"command-authoring/tool-calling/#debugging-tool-calls","title":"Debugging Tool Calls","text":"<p>Enable debug mode to see tool execution:</p> <pre><code>SCMD_DEBUG=1 scmd project-analyzer ./myapp\n</code></pre> <p>Output: <pre><code>[DEBUG] LLM requested tool: shell\n[DEBUG] Parameters: {\"command\": \"ls -la ./myapp\"}\n[DEBUG] Tool result: total 48\ndrwxr-xr-x  12 user  staff   384 Jan  5 10:30 .\ndrwxr-xr-x  25 user  staff   800 Jan  5 10:25 ..\n-rw-r--r--   1 user  staff  1024 Jan  5 10:30 package.json\n...\n\n[DEBUG] LLM requested tool: read_file\n[DEBUG] Parameters: {\"path\": \"./myapp/package.json\"}\n[DEBUG] Tool result: {\n  \"name\": \"myapp\",\n  \"version\": \"1.0.0\",\n  ...\n}\n\n[DEBUG] No more tool calls, finalizing response\n</code></pre></p>"},{"location":"command-authoring/tool-calling/#best-practices","title":"Best Practices","text":""},{"location":"command-authoring/tool-calling/#1-clear-instructions","title":"1. Clear Instructions","text":"<p>Tell the LLM exactly what tools to use:</p> <p>Good: <pre><code>prompt:\n  template: |\n    Use the shell tool to list files in {{.path}}\n    Then use read_file to read package.json\n    Analyze the dependencies\n</code></pre></p> <p>Bad: <pre><code>prompt:\n  template: |\n    Analyze the project  # Too vague\n</code></pre></p>"},{"location":"command-authoring/tool-calling/#2-provide-context","title":"2. Provide Context","text":"<p>Give the LLM information about available tools:</p> <pre><code>prompt:\n  system: |\n    You have access to these tools:\n    - shell: Execute safe shell commands (ls, git, cat, etc.)\n    - read_file: Read file contents\n    - write_file: Write files (requires confirmation)\n    - http_get: Fetch URLs\n\n    Use them wisely to complete tasks autonomously.\n</code></pre>"},{"location":"command-authoring/tool-calling/#3-set-appropriate-limits","title":"3. Set Appropriate Limits","text":"<pre><code>model:\n  max_tokens: 3000     # Enough for multiple tool calls\n  temperature: 0.5     # Not too creative for tool use\n</code></pre>"},{"location":"command-authoring/tool-calling/#4-handle-errors","title":"4. Handle Errors","text":"<pre><code>prompt:\n  template: |\n    Try to complete the task.\n    If tools fail, explain what went wrong.\n    Provide alternative approaches when possible.\n</code></pre>"},{"location":"command-authoring/tool-calling/#5-limit-scope","title":"5. Limit Scope","text":"<p>Don't let the LLM go wild:</p> <p>Good: <pre><code>prompt:\n  template: |\n    Read package.json and analyze dependencies.\n    Limit to top 10 most important packages.\n</code></pre></p> <p>Bad: <pre><code>prompt:\n  template: |\n    Read all files in the project and analyze everything.\n    # This could trigger hundreds of file reads!\n</code></pre></p>"},{"location":"command-authoring/tool-calling/#examples","title":"Examples","text":"<p>See Tool Calling Examples for complete, runnable examples:</p> <ul> <li>Project structure analyzer</li> <li>Automated code refactorer</li> <li>Dependency security checker</li> <li>Documentation generator</li> <li>Test coverage analyzer</li> </ul>"},{"location":"command-authoring/tool-calling/#troubleshooting","title":"Troubleshooting","text":""},{"location":"command-authoring/tool-calling/#tool-calling-not-supported","title":"\"Tool calling not supported\"","text":"<p>Your backend doesn't support tool calling. Options:</p> <ol> <li>Use llama.cpp with qwen2.5-1.5b (default) or qwen3-4b</li> <li>Use Ollama with a tool-calling model</li> <li>Use OpenAI (GPT-4 or GPT-3.5-turbo)</li> <li>Command falls back to text-only mode</li> </ol>"},{"location":"command-authoring/tool-calling/#command-not-in-whitelist","title":"\"Command not in whitelist\"","text":"<p>The shell command you're trying to use is blocked for security. Options:</p> <ol> <li>Use a different, allowed command</li> <li>Modify the command spec to use read_file instead</li> <li>Add the command to whitelist (advanced)</li> </ol>"},{"location":"command-authoring/tool-calling/#tool-loop-exceeded","title":"Tool Loop Exceeded","text":"<p>LLM hit the 5-round limit. This usually means:</p> <ol> <li>Task is too complex (break into smaller commands)</li> <li>LLM is confused (improve prompt clarity)</li> <li>Tool results aren't helpful (check tool output)</li> </ol> <p>Fix: Simplify the task or improve the prompt.</p>"},{"location":"command-authoring/tool-calling/#tool-results-too-large","title":"Tool Results Too Large","text":"<p>HTTP or file reads returning huge responses:</p> <pre><code># Limit HTTP response size\nhttp_get(url, max_size=1048576)  # 1MB\n\n# Limit file lines\nread_file(path, max_lines=100)\n</code></pre>"},{"location":"command-authoring/tool-calling/#next-steps","title":"Next Steps","text":"<ul> <li>Hooks Documentation - Add pre/post automation</li> <li>Composition Documentation - Chain tool-enabled commands</li> <li>Tool API Reference - Complete tool specifications</li> <li>Adding Tools - Create custom tools</li> </ul>"},{"location":"contributing/distribution/","title":"Distribution Infrastructure","text":"<p>This document explains scmd's distribution infrastructure, covering all the channels we use to deliver scmd to users.</p>"},{"location":"contributing/distribution/#overview","title":"Overview","text":"<p>scmd is distributed through multiple channels to reach users on different platforms:</p> <ul> <li>Homebrew - macOS and Linux package manager</li> <li>npm - Cross-platform via Node.js</li> <li>Shell scripts - Universal wget/curl installer</li> <li>Linux packages - Native deb, rpm, and apk packages</li> <li>GitHub Releases - Direct binary downloads</li> <li>Docker Hub - Container images</li> </ul>"},{"location":"contributing/distribution/#architecture","title":"Architecture","text":""},{"location":"contributing/distribution/#build-pipeline","title":"Build Pipeline","text":"<pre><code>graph TD\n    A[Git Tag Push] --&gt; B[GitHub Actions Triggered]\n    B --&gt; C[Run Tests]\n    C --&gt; D[GoReleaser Build]\n    D --&gt; E[Create Artifacts]\n    E --&gt; F[GitHub Release]\n    E --&gt; G[Homebrew Tap]\n    E --&gt; H[npm Registry]\n    E --&gt; I[Docker Hub]\n    E --&gt; J[Package Repos]</code></pre>"},{"location":"contributing/distribution/#file-structure","title":"File Structure","text":"<pre><code>.\n\u251c\u2500\u2500 .goreleaser.yml              # GoReleaser configuration\n\u251c\u2500\u2500 .github/workflows/\n\u2502   \u2514\u2500\u2500 release.yml              # Release automation\n\u251c\u2500\u2500 scripts/\n\u2502   \u251c\u2500\u2500 install.sh               # Universal installer\n\u2502   \u251c\u2500\u2500 uninstall.sh             # Uninstaller\n\u2502   \u251c\u2500\u2500 postinstall.sh           # Package post-install\n\u2502   \u2514\u2500\u2500 preremove.sh             # Package pre-remove\n\u251c\u2500\u2500 npm/\n\u2502   \u251c\u2500\u2500 package.json             # npm package config\n\u2502   \u251c\u2500\u2500 install.js               # Binary downloader\n\u2502   \u2514\u2500\u2500 uninstall.js             # Cleanup script\n\u2514\u2500\u2500 Makefile                     # Build targets\n</code></pre>"},{"location":"contributing/distribution/#distribution-channels","title":"Distribution Channels","text":""},{"location":"contributing/distribution/#1-homebrew","title":"1. Homebrew","text":"<p>Repository: scmd/homebrew-tap</p>"},{"location":"contributing/distribution/#how-it-works","title":"How It Works","text":"<ol> <li>GoReleaser generates Homebrew formula</li> <li>Pushes to <code>scmd/homebrew-tap</code> repository</li> <li>Formula includes:</li> <li>Binary URL and checksums</li> <li>Dependencies (suggests llama.cpp)</li> <li>Install scripts</li> <li>Shell completions</li> </ol>"},{"location":"contributing/distribution/#formula-structure","title":"Formula Structure","text":"<pre><code>class Scmd &lt; Formula\n  desc \"AI-powered slash commands for any terminal\"\n  homepage \"https://github.com/scmd/scmd\"\n  url \"https://github.com/scmd/scmd/releases/download/v1.0.0/scmd_1.0.0_macOS_arm64.tar.gz\"\n  sha256 \"abc123...\"\n  license \"MIT\"\n\n  depends_on \"llama.cpp\" =&gt; :recommended\n\n  def install\n    bin.install \"scmd\"\n    bash_completion.install \"completions/scmd.bash\" =&gt; \"scmd\"\n    zsh_completion.install \"completions/scmd.zsh\" =&gt; \"_scmd\"\n    fish_completion.install \"completions/scmd.fish\"\n  end\n\n  test do\n    system \"#{bin}/scmd\", \"--version\"\n  end\nend\n</code></pre>"},{"location":"contributing/distribution/#user-installation","title":"User Installation","text":"<pre><code>brew tap scmd/tap\nbrew install scmd\n</code></pre>"},{"location":"contributing/distribution/#configuration","title":"Configuration","text":"<p>In <code>.goreleaser.yml</code>:</p> <pre><code>brews:\n  - name: scmd\n    repository:\n      owner: scmd\n      name: homebrew-tap\n      token: \"{{ .Env.HOMEBREW_TAP_GITHUB_TOKEN }}\"\n    directory: Formula\n    homepage: https://github.com/scmd/scmd\n    description: \"AI-powered slash commands for any terminal\"\n    license: MIT\n    install: |\n      bin.install \"scmd\"\n      bash_completion.install \"completions/scmd.bash\" =&gt; \"scmd\"\n      zsh_completion.install \"completions/scmd.zsh\" =&gt; \"_scmd\"\n      fish_completion.install \"completions/scmd.fish\"\n    dependencies:\n      - name: llama.cpp\n        type: optional\n</code></pre>"},{"location":"contributing/distribution/#2-npm-registry","title":"2. npm Registry","text":"<p>Package: scmd-cli</p>"},{"location":"contributing/distribution/#how-it-works_1","title":"How It Works","text":"<ol> <li>User runs <code>npm install -g scmd-cli</code></li> <li>npm runs <code>postinstall</code> script</li> <li><code>install.js</code> detects platform and architecture</li> <li>Downloads appropriate binary from GitHub releases</li> <li>Verifies checksums</li> <li>Installs to <code>npm/bin/</code></li> <li>npm adds to user's PATH</li> </ol>"},{"location":"contributing/distribution/#package-structure","title":"Package Structure","text":"<pre><code>{\n  \"name\": \"scmd-cli\",\n  \"version\": \"1.0.0\",\n  \"bin\": {\n    \"scmd\": \"bin/scmd\"\n  },\n  \"scripts\": {\n    \"postinstall\": \"node install.js\",\n    \"preuninstall\": \"node uninstall.js\"\n  }\n}\n</code></pre>"},{"location":"contributing/distribution/#installjs-logic","title":"install.js Logic","text":"<pre><code>// Detect platform\nconst platform = process.platform; // darwin, linux, win32\nconst arch = process.arch;         // x64, arm64\n\n// Map to GitHub release names\nconst binaryName = `scmd_${version}_${platform}_${arch}.tar.gz`;\n\n// Download from GitHub\nconst url = `https://github.com/scmd/scmd/releases/download/v${version}/${binaryName}`;\n\n// Verify checksum\ndownloadChecksums();\nverifyChecksum(binaryPath);\n\n// Extract and install\nextractArchive(binaryPath, 'npm/bin/');\n</code></pre>"},{"location":"contributing/distribution/#user-installation_1","title":"User Installation","text":"<pre><code>npm install -g scmd-cli\n</code></pre>"},{"location":"contributing/distribution/#3-shell-install-script","title":"3. Shell Install Script","text":"<p>Location: <code>scripts/install.sh</code></p>"},{"location":"contributing/distribution/#how-it-works_2","title":"How It Works","text":"<ol> <li>User runs <code>curl -fsSL https://scmd.sh/install.sh | bash</code></li> <li>Script detects OS and architecture</li> <li>Downloads binary and checksums from GitHub</li> <li>Verifies SHA256 checksum</li> <li>Installs to <code>/usr/local/bin</code> (with sudo) or <code>~/.local/bin</code></li> <li>Installs shell completions</li> <li>Checks PATH configuration</li> </ol>"},{"location":"contributing/distribution/#features","title":"Features","text":"<ul> <li>Platform detection (macOS, Linux, Windows)</li> <li>Architecture detection (amd64, arm64)</li> <li>Checksum verification</li> <li>Custom install directory</li> <li>No-sudo mode</li> <li>Version selection</li> </ul>"},{"location":"contributing/distribution/#environment-variables","title":"Environment Variables","text":"<pre><code>SCMD_INSTALL_DIR=/custom/path    # Custom installation directory\nSCMD_VERSION=v1.0.0              # Specific version\nSCMD_NO_SUDO=true                # User-local install\n</code></pre>"},{"location":"contributing/distribution/#user-installation_2","title":"User Installation","text":"<pre><code># Default installation\ncurl -fsSL https://scmd.sh/install.sh | bash\n\n# Custom installation\ncurl -fsSL https://scmd.sh/install.sh | SCMD_INSTALL_DIR=$HOME/bin bash\n</code></pre>"},{"location":"contributing/distribution/#4-linux-packages","title":"4. Linux Packages","text":""},{"location":"contributing/distribution/#supported-formats","title":"Supported Formats","text":"<ul> <li>deb - Debian, Ubuntu, Linux Mint</li> <li>rpm - Red Hat, Fedora, CentOS, SUSE</li> <li>apk - Alpine Linux</li> </ul>"},{"location":"contributing/distribution/#how-it-works_3","title":"How It Works","text":"<ol> <li>GoReleaser uses nfpm to create packages</li> <li>Packages include:</li> <li>Binary in <code>/usr/bin/scmd</code></li> <li>Shell completions in <code>/usr/share/</code></li> <li>Man pages (future)</li> <li>Post-install scripts</li> </ol>"},{"location":"contributing/distribution/#configuration_1","title":"Configuration","text":"<p>In <code>.goreleaser.yml</code>:</p> <pre><code>nfpms:\n  - id: scmd\n    package_name: scmd\n    vendor: scmd\n    homepage: https://github.com/scmd/scmd\n    maintainer: scmd team &lt;team@scmd.dev&gt;\n    description: \"AI-powered slash commands for any terminal\"\n    license: MIT\n    formats:\n      - deb\n      - rpm\n      - apk\n    bindir: /usr/bin\n    contents:\n      - src: ./scmd\n        dst: /usr/bin/scmd\n      - src: ./completions/scmd.bash\n        dst: /usr/share/bash-completion/completions/scmd\n    scripts:\n      postinstall: \"scripts/postinstall.sh\"\n      preremove: \"scripts/preremove.sh\"\n    recommends:\n      - llama-cpp\n</code></pre>"},{"location":"contributing/distribution/#package-metadata","title":"Package Metadata","text":"<p>Debian (.deb):</p> <pre><code>Package: scmd\nVersion: 1.0.0\nArchitecture: amd64\nMaintainer: scmd team &lt;team@scmd.dev&gt;\nDescription: AI-powered slash commands for any terminal\nDepends:\nRecommends: llama-cpp\n</code></pre> <p>RPM (.rpm):</p> <pre><code>Name: scmd\nVersion: 1.0.0\nRelease: 1\nSummary: AI-powered slash commands for any terminal\nLicense: MIT\nRecommends: llama-cpp\n</code></pre>"},{"location":"contributing/distribution/#user-installation_3","title":"User Installation","text":"<pre><code># Debian/Ubuntu\nsudo dpkg -i scmd_1.0.0_linux_amd64.deb\n\n# Red Hat/Fedora\nsudo rpm -i scmd_1.0.0_linux_amd64.rpm\n\n# Alpine\nsudo apk add --allow-untrusted scmd_1.0.0_linux_amd64.apk\n</code></pre>"},{"location":"contributing/distribution/#5-github-releases","title":"5. GitHub Releases","text":""},{"location":"contributing/distribution/#artifacts","title":"Artifacts","text":"<p>Each release includes:</p> <ul> <li>Binaries for all platforms</li> <li>Archives (.tar.gz for Unix, .zip for Windows)</li> <li>Checksums (SHA256)</li> <li>Release notes (auto-generated from commits)</li> <li>Linux packages (deb, rpm, apk)</li> </ul>"},{"location":"contributing/distribution/#release-structure","title":"Release Structure","text":"<pre><code>v1.0.0\n\u251c\u2500\u2500 scmd_1.0.0_macOS_amd64.tar.gz\n\u251c\u2500\u2500 scmd_1.0.0_macOS_arm64.tar.gz\n\u251c\u2500\u2500 scmd_1.0.0_linux_amd64.tar.gz\n\u251c\u2500\u2500 scmd_1.0.0_linux_arm64.tar.gz\n\u251c\u2500\u2500 scmd_1.0.0_windows_amd64.zip\n\u251c\u2500\u2500 scmd_1.0.0_linux_amd64.deb\n\u251c\u2500\u2500 scmd_1.0.0_linux_amd64.rpm\n\u251c\u2500\u2500 scmd_1.0.0_linux_amd64.apk\n\u251c\u2500\u2500 checksums.txt\n\u2514\u2500\u2500 Release Notes\n</code></pre>"},{"location":"contributing/distribution/#checksum-verification","title":"Checksum Verification","text":"<p>Users can verify downloads:</p> <pre><code># Download checksums\nwget https://github.com/scmd/scmd/releases/download/v1.0.0/checksums.txt\n\n# Verify\nshasum -a 256 -c checksums.txt 2&gt;&amp;1 | grep scmd_1.0.0_macOS_arm64.tar.gz\n</code></pre>"},{"location":"contributing/distribution/#6-docker-hub","title":"6. Docker Hub","text":"<p>Repository: scmd/scmd</p>"},{"location":"contributing/distribution/#multi-arch-images","title":"Multi-Arch Images","text":"<pre><code>scmd/scmd:latest        # Latest release\nscmd/scmd:1.0.0         # Specific version\nscmd/scmd:1.0.0-amd64   # Platform-specific\nscmd/scmd:1.0.0-arm64   # Platform-specific\n</code></pre>"},{"location":"contributing/distribution/#dockerfile","title":"Dockerfile","text":"<pre><code>FROM alpine:latest\n\nRUN apk add --no-cache ca-certificates\n\nCOPY scmd /usr/local/bin/scmd\n\nENTRYPOINT [\"scmd\"]\n</code></pre>"},{"location":"contributing/distribution/#user-usage","title":"User Usage","text":"<pre><code># Run scmd in Docker\ndocker run scmd/scmd:latest --version\n\n# Interactive\ndocker run -it scmd/scmd:latest /explain \"what is a goroutine\"\n</code></pre>"},{"location":"contributing/distribution/#binary-naming-convention","title":"Binary Naming Convention","text":""},{"location":"contributing/distribution/#platforms","title":"Platforms","text":"<ul> <li><code>macOS</code> - macOS (formerly darwin)</li> <li><code>linux</code> - Linux</li> <li><code>windows</code> - Windows</li> </ul>"},{"location":"contributing/distribution/#architectures","title":"Architectures","text":"<ul> <li><code>amd64</code> - x86_64, Intel/AMD 64-bit</li> <li><code>arm64</code> - ARM 64-bit (Apple Silicon, ARM servers)</li> </ul>"},{"location":"contributing/distribution/#archive-names","title":"Archive Names","text":"<p>Pattern: <code>scmd_{VERSION}_{OS}_{ARCH}.{EXT}</code></p> <p>Examples:</p> <ul> <li><code>scmd_1.0.0_macOS_arm64.tar.gz</code></li> <li><code>scmd_1.0.0_linux_amd64.tar.gz</code></li> <li><code>scmd_1.0.0_windows_amd64.zip</code></li> </ul>"},{"location":"contributing/distribution/#installation-paths","title":"Installation Paths","text":""},{"location":"contributing/distribution/#system-wide","title":"System-Wide","text":"<pre><code>/usr/local/bin/scmd                              # Binary (macOS, manual)\n/usr/bin/scmd                                    # Binary (Linux packages)\n/usr/local/share/bash-completion/completions/   # Bash completions\n/usr/local/share/zsh/site-functions/            # Zsh completions\n/usr/share/fish/vendor_completions.d/           # Fish completions\n</code></pre>"},{"location":"contributing/distribution/#user-local","title":"User-Local","text":"<pre><code>~/.local/bin/scmd                    # Binary\n~/.bash_completion.d/                # Bash completions\n~/.config/fish/completions/          # Fish completions\n</code></pre>"},{"location":"contributing/distribution/#data-directory","title":"Data Directory","text":"<pre><code>~/.scmd/                             # Default data directory\n$XDG_CONFIG_HOME/scmd/              # XDG config\n$XDG_DATA_HOME/scmd/                # XDG data\n$XDG_CACHE_HOME/scmd/               # XDG cache\n</code></pre>"},{"location":"contributing/distribution/#shell-completions","title":"Shell Completions","text":""},{"location":"contributing/distribution/#generation","title":"Generation","text":"<p>Completions are generated using Cobra:</p> <pre><code>// In cmd/completion/completion.go\ncmd.GenBashCompletion(os.Stdout)\ncmd.GenZshCompletion(os.Stdout)\ncmd.GenFishCompletion(os.Stdout, true)\ncmd.GenPowerShellCompletionWithDesc(os.Stdout)\n</code></pre>"},{"location":"contributing/distribution/#installation","title":"Installation","text":""},{"location":"contributing/distribution/#homebrew","title":"Homebrew","text":"<p>Automatically installs completions during <code>brew install</code>.</p>"},{"location":"contributing/distribution/#linux-packages","title":"Linux Packages","text":"<p>Completions included in deb/rpm/apk packages.</p>"},{"location":"contributing/distribution/#manual","title":"Manual","text":"<pre><code>scmd completion bash &gt; ~/.bash_completion.d/scmd\nscmd completion zsh &gt; ~/.zsh/completion/_scmd\nscmd completion fish &gt; ~/.config/fish/completions/scmd.fish\n</code></pre>"},{"location":"contributing/distribution/#security","title":"Security","text":""},{"location":"contributing/distribution/#checksum-verification_1","title":"Checksum Verification","text":"<p>All releases include SHA256 checksums:</p> <pre><code># checksums.txt format\nabc123... scmd_1.0.0_macOS_arm64.tar.gz\ndef456... scmd_1.0.0_linux_amd64.tar.gz\n</code></pre>"},{"location":"contributing/distribution/#binary-signing-future","title":"Binary Signing (Future)","text":"<p>Plan to add GPG signing:</p> <pre><code>signs:\n  - artifacts: checksum\n    args:\n      - \"--batch\"\n      - \"--local-user\"\n      - \"{{ .Env.GPG_FINGERPRINT }}\"\n</code></pre>"},{"location":"contributing/distribution/#supply-chain-security","title":"Supply Chain Security","text":"<ul> <li>Builds run in GitHub Actions (auditable)</li> <li>Reproducible builds with GoReleaser</li> <li>Checksums for all artifacts</li> <li>HTTPS for all downloads</li> </ul>"},{"location":"contributing/distribution/#monitoring","title":"Monitoring","text":""},{"location":"contributing/distribution/#release-health","title":"Release Health","text":"<p>After each release, verify:</p> <ul> <li> GitHub release created</li> <li> All platform binaries present</li> <li> Checksums correct</li> <li> Homebrew tap updated</li> <li> npm package published</li> <li> Docker images pushed</li> <li> Download URLs work</li> <li> Installation methods tested</li> </ul>"},{"location":"contributing/distribution/#analytics","title":"Analytics","text":"<p>Track (future):</p> <ul> <li>Download counts per platform</li> <li>Installation method distribution</li> <li>Version adoption rates</li> <li>Geographic distribution</li> </ul>"},{"location":"contributing/distribution/#maintenance","title":"Maintenance","text":""},{"location":"contributing/distribution/#updating-dependencies","title":"Updating Dependencies","text":""},{"location":"contributing/distribution/#homebrew_1","title":"Homebrew","text":"<pre><code># In Formula/scmd.rb\ndepends_on \"llama.cpp\" =&gt; :recommended\n</code></pre>"},{"location":"contributing/distribution/#npm","title":"npm","text":"<pre><code>// In npm/package.json\n\"engines\": {\n  \"node\": \"&gt;=14.0.0\"\n}\n</code></pre>"},{"location":"contributing/distribution/#linux-packages_1","title":"Linux Packages","text":"<pre><code># In .goreleaser.yml\nrecommends:\n  - llama-cpp\n</code></pre>"},{"location":"contributing/distribution/#deprecating-versions","title":"Deprecating Versions","text":""},{"location":"contributing/distribution/#npm_1","title":"npm","text":"<pre><code>npm deprecate scmd-cli@1.0.0 \"Critical bug, please upgrade\"\n</code></pre>"},{"location":"contributing/distribution/#github","title":"GitHub","text":"<p>Add warning to release notes.</p>"},{"location":"contributing/distribution/#future-improvements","title":"Future Improvements","text":""},{"location":"contributing/distribution/#planned","title":"Planned","text":"<ul> <li> Publish to Homebrew core (not just tap)</li> <li> APT/YUM repositories (not just releases)</li> <li> Snap packages</li> <li> Flatpak</li> <li> Windows package managers (Chocolatey, Scoop, winget)</li> <li> Binary signing with GPG</li> <li> SLSA provenance</li> <li> Software Bill of Materials (SBOM)</li> </ul>"},{"location":"contributing/distribution/#under-consideration","title":"Under Consideration","text":"<ul> <li> Arch User Repository (AUR)</li> <li> Nix packages</li> <li> Guix packages</li> <li> Gentoo ebuild</li> <li> FreeBSD ports</li> </ul>"},{"location":"contributing/distribution/#troubleshooting","title":"Troubleshooting","text":""},{"location":"contributing/distribution/#homebrew-tap-issues","title":"Homebrew Tap Issues","text":"<p>Problem: Tap not updating</p> <p>Solution:</p> <pre><code># Force tap update\nbrew update\nbrew upgrade scmd\n\n# Or reinstall\nbrew uninstall scmd\nbrew install scmd\n</code></pre>"},{"location":"contributing/distribution/#npm-binary-download-issues","title":"npm Binary Download Issues","text":"<p>Problem: Binary download fails</p> <p>Solution:</p> <p>Check GitHub connectivity:</p> <pre><code>curl -I https://github.com\ncurl -I https://github.com/scmd/scmd/releases/download/v1.0.0/checksums.txt\n</code></pre>"},{"location":"contributing/distribution/#package-installation-fails","title":"Package Installation Fails","text":"<p>Problem: Linux package won't install</p> <p>Solution:</p> <p>Check package format and architecture:</p> <pre><code># Check file type\nfile scmd_1.0.0_linux_amd64.deb\n\n# Check architecture\ndpkg --print-architecture\nuname -m\n</code></pre>"},{"location":"contributing/distribution/#references","title":"References","text":"<ul> <li>GoReleaser Documentation</li> <li>nfpm Documentation</li> <li>Homebrew Formula Cookbook</li> <li>npm Package Creation</li> <li>Debian Package Guidelines</li> <li>RPM Packaging Guide</li> </ul>"},{"location":"contributing/release-process/","title":"Release Process","text":"<p>This guide explains how to create and publish new releases of scmd using our automated distribution pipeline.</p>"},{"location":"contributing/release-process/#overview","title":"Overview","text":"<p>scmd uses GoReleaser for automated multi-platform releases. When you push a git tag, GitHub Actions automatically:</p> <ol> <li>Runs tests</li> <li>Builds binaries for all platforms</li> <li>Creates Linux packages (deb, rpm, apk)</li> <li>Updates Homebrew tap</li> <li>Publishes to npm</li> <li>Creates Docker images</li> <li>Generates release notes</li> </ol>"},{"location":"contributing/release-process/#prerequisites","title":"Prerequisites","text":""},{"location":"contributing/release-process/#required-tools","title":"Required Tools","text":"<pre><code># Install GoReleaser\nmake install-goreleaser\n\n# Or manually\ngo install github.com/goreleaser/goreleaser/v2@latest\n</code></pre>"},{"location":"contributing/release-process/#required-github-secrets","title":"Required GitHub Secrets","text":"<p>Set these in your repository settings (<code>Settings</code> \u2192 <code>Secrets and variables</code> \u2192 <code>Actions</code>):</p> Secret Purpose How to Get <code>GITHUB_TOKEN</code> Auto-generated Automatically available in GitHub Actions <code>HOMEBREW_TAP_GITHUB_TOKEN</code> Update Homebrew tap Personal Access Token with <code>repo</code> scope <code>NPM_TOKEN</code> Publish to npm Create at npmjs.com <code>DOCKERHUB_USERNAME</code> Docker Hub login Your Docker Hub username <code>DOCKERHUB_TOKEN</code> Docker Hub authentication Create at hub.docker.com"},{"location":"contributing/release-process/#release-workflow","title":"Release Workflow","text":""},{"location":"contributing/release-process/#1-prepare-the-release","title":"1. Prepare the Release","text":""},{"location":"contributing/release-process/#update-version-information","title":"Update Version Information","text":"<p>No manual version updates are needed. GoReleaser automatically uses the git tag as the version.</p>"},{"location":"contributing/release-process/#update-changelogmd","title":"Update CHANGELOG.md","text":"<p>Document all changes since the last release:</p> <pre><code>## [1.2.0] - 2025-01-15\n\n### Added\n- New feature X\n- Support for Y\n\n### Changed\n- Updated Z for better performance\n\n### Fixed\n- Bug in component A\n- Issue with B\n\n### Security\n- Patched vulnerability CVE-2025-XXXX\n</code></pre>"},{"location":"contributing/release-process/#commit-changes","title":"Commit Changes","text":"<pre><code>git add CHANGELOG.md\ngit commit -m \"docs: update changelog for v1.2.0\"\ngit push origin main\n</code></pre>"},{"location":"contributing/release-process/#2-create-a-git-tag","title":"2. Create a Git Tag","text":"<pre><code># Create and push tag using Makefile\nmake tag VERSION=v1.2.0\n\n# Push the tag to trigger release\ngit push origin v1.2.0\n</code></pre> <p>Or manually:</p> <pre><code># Create annotated tag\ngit tag -a v1.2.0 -m \"Release v1.2.0\"\n\n# Push tag\ngit push origin v1.2.0\n</code></pre>"},{"location":"contributing/release-process/#3-monitor-the-release","title":"3. Monitor the Release","text":"<ol> <li>Go to the Actions tab</li> <li>Find the \"Release\" workflow</li> <li>Monitor progress through each step:</li> <li>\u2705 Run Tests</li> <li>\u2705 Build with GoReleaser</li> <li>\u2705 Publish to npm</li> <li>\u2705 Create install script</li> <li>\u2705 Notify</li> </ol>"},{"location":"contributing/release-process/#4-verify-the-release","title":"4. Verify the Release","text":"<p>Once the workflow completes, verify:</p>"},{"location":"contributing/release-process/#github-release","title":"GitHub Release","text":"<ol> <li>Go to Releases</li> <li>Check that the new release appears with:</li> <li>Release notes</li> <li>All platform binaries</li> <li>Checksums</li> <li>Linux packages</li> </ol>"},{"location":"contributing/release-process/#homebrew","title":"Homebrew","text":"<pre><code># Test Homebrew installation\nbrew uninstall scmd\nbrew tap scmd/tap\nbrew install scmd\nscmd --version  # Should show v1.2.0\n</code></pre>"},{"location":"contributing/release-process/#npm","title":"npm","text":"<pre><code># Test npm installation\nnpm uninstall -g scmd-cli\nnpm install -g scmd-cli\nscmd --version  # Should show 1.2.0 (without 'v')\n</code></pre>"},{"location":"contributing/release-process/#docker","title":"Docker","text":"<pre><code># Test Docker image\ndocker pull scmd/scmd:1.2.0\ndocker run scmd/scmd:1.2.0 --version\n</code></pre>"},{"location":"contributing/release-process/#install-script","title":"Install Script","text":"<pre><code># Test install script\ncurl -fsSL https://raw.githubusercontent.com/scmd/scmd/v1.2.0/scripts/install.sh | bash\nscmd --version\n</code></pre>"},{"location":"contributing/release-process/#testing-releases-locally","title":"Testing Releases Locally","text":""},{"location":"contributing/release-process/#snapshot-release-no-publishing","title":"Snapshot Release (No Publishing)","text":"<p>Test the full release process without publishing:</p> <pre><code># Create a snapshot release\nmake release-snapshot\n\n# Check dist/ directory for artifacts\nls -lh dist/\n</code></pre> <p>This creates:</p> <ul> <li>Binaries for all platforms in <code>dist/</code></li> <li>Archives and checksums</li> <li>Linux packages</li> <li>Test the installation locally</li> </ul>"},{"location":"contributing/release-process/#dry-run-test-without-publishing","title":"Dry Run (Test Without Publishing)","text":"<p>Test GoReleaser configuration:</p> <pre><code># Validate configuration\nmake check-goreleaser\n\n# Dry run (skip publishing)\nmake release-dry-run\n</code></pre>"},{"location":"contributing/release-process/#local-testing-workflow","title":"Local Testing Workflow","text":"<pre><code># 1. Validate GoReleaser config\nmake check-goreleaser\n\n# 2. Run tests\nmake test\n\n# 3. Create snapshot\nmake release-snapshot\n\n# 4. Test binary locally\n./dist/scmd-darwin-arm64 --version\n\n# 5. Test install script locally\n./scripts/install.sh\n</code></pre>"},{"location":"contributing/release-process/#distribution-channels","title":"Distribution Channels","text":""},{"location":"contributing/release-process/#homebrew-tap","title":"Homebrew Tap","text":"<p>Repository: scmd/homebrew-tap</p> <p>GoReleaser automatically updates the tap with:</p> <ul> <li>New formula version</li> <li>Updated checksums</li> <li>Binary URLs</li> </ul> <p>Users install with:</p> <pre><code>brew tap scmd/tap\nbrew install scmd\n</code></pre> <p>To submit to homebrew-core (future):</p> <ol> <li>Fork Homebrew/homebrew-core</li> <li>Copy formula from tap to <code>Formula/scmd.rb</code></li> <li>Update URLs to point to main release</li> <li>Submit PR</li> </ol>"},{"location":"contributing/release-process/#npm-registry","title":"npm Registry","text":"<p>Package: scmd-cli</p> <p>The npm package is a wrapper that:</p> <ol> <li>Downloads the correct binary for the user's platform</li> <li>Installs it to npm's bin directory</li> <li>Automatically adds to PATH</li> </ol> <p>Publishing is automated via GitHub Actions.</p>"},{"location":"contributing/release-process/#linux-package-repositories","title":"Linux Package Repositories","text":"<p>Packages are created for:</p> <ul> <li>Debian/Ubuntu (<code>.deb</code>)</li> <li>Red Hat/Fedora/CentOS (<code>.rpm</code>)</li> <li>Alpine Linux (<code>.apk</code>)</li> </ul> <p>Packages include:</p> <ul> <li>Binary in <code>/usr/bin/scmd</code></li> <li>Shell completions</li> <li>Man pages (future)</li> <li>Post-install/remove scripts</li> </ul>"},{"location":"contributing/release-process/#docker-hub","title":"Docker Hub","text":"<p>Repository: scmd/scmd</p> <p>Multi-arch images are built for:</p> <ul> <li><code>scmd/scmd:latest</code></li> <li><code>scmd/scmd:1.2.0</code></li> <li><code>scmd/scmd:1.2.0-amd64</code></li> <li><code>scmd/scmd:1.2.0-arm64</code></li> </ul>"},{"location":"contributing/release-process/#version-strategy","title":"Version Strategy","text":""},{"location":"contributing/release-process/#semantic-versioning","title":"Semantic Versioning","text":"<p>We follow Semantic Versioning 2.0.0:</p> <ul> <li>Major (v2.0.0): Breaking changes</li> <li>Minor (v1.2.0): New features, backward compatible</li> <li>Patch (v1.2.1): Bug fixes, backward compatible</li> </ul>"},{"location":"contributing/release-process/#pre-release-versions","title":"Pre-release Versions","text":"<p>For testing:</p> <pre><code># Alpha\ngit tag -a v1.3.0-alpha.1 -m \"Alpha release\"\n\n# Beta\ngit tag -a v1.3.0-beta.1 -m \"Beta release\"\n\n# Release candidate\ngit tag -a v1.3.0-rc.1 -m \"Release candidate\"\n</code></pre> <p>Pre-releases are marked as \"pre-release\" on GitHub and not promoted as \"latest\".</p>"},{"location":"contributing/release-process/#version-tags","title":"Version Tags","text":"<ul> <li>Use <code>v</code> prefix: <code>v1.2.0</code> (not <code>1.2.0</code>)</li> <li>Create annotated tags (not lightweight)</li> <li>Include meaningful tag message</li> </ul>"},{"location":"contributing/release-process/#release-checklist","title":"Release Checklist","text":"<p>Before creating a release:</p> <ul> <li> All tests pass (<code>make test</code>)</li> <li> Documentation is updated</li> <li> CHANGELOG.md is updated</li> <li> Breaking changes are documented</li> <li> Security advisories are published (if applicable)</li> <li> Migration guide exists (for breaking changes)</li> </ul> <p>After creating a release:</p> <ul> <li> GitHub release created successfully</li> <li> All binaries are uploaded</li> <li> Checksums are correct</li> <li> Homebrew tap updated</li> <li> npm package published</li> <li> Docker images pushed</li> <li> Installation methods verified</li> <li> Release notes reviewed</li> <li> Announcements posted (if major release)</li> </ul>"},{"location":"contributing/release-process/#hotfix-releases","title":"Hotfix Releases","text":"<p>For urgent fixes:</p> <pre><code># 1. Create hotfix branch from tag\ngit checkout -b hotfix/v1.2.1 v1.2.0\n\n# 2. Make fix\ngit commit -m \"fix: critical bug in X\"\n\n# 3. Create tag\ngit tag -a v1.2.1 -m \"Hotfix: critical bug in X\"\n\n# 4. Push tag\ngit push origin v1.2.1\n\n# 5. Merge back to main\ngit checkout main\ngit merge hotfix/v1.2.1\ngit push origin main\n</code></pre>"},{"location":"contributing/release-process/#rollback","title":"Rollback","text":"<p>If a release has issues:</p>"},{"location":"contributing/release-process/#delete-github-release","title":"Delete GitHub Release","text":"<pre><code># Delete tag locally\ngit tag -d v1.2.0\n\n# Delete tag remotely\ngit push origin :refs/tags/v1.2.0\n\n# Delete GitHub release via UI or API\ngh release delete v1.2.0\n</code></pre>"},{"location":"contributing/release-process/#revert-npm-package","title":"Revert npm Package","text":"<pre><code># Deprecate version\nnpm deprecate scmd-cli@1.2.0 \"This version has been deprecated due to critical bug\"\n\n# Publish fixed version\n# ... fix code ...\nnpm version patch\nnpm publish\n</code></pre>"},{"location":"contributing/release-process/#update-homebrew","title":"Update Homebrew","text":"<p>The tap will auto-update, but for homebrew-core:</p> <pre><code># Submit PR to revert formula\n</code></pre>"},{"location":"contributing/release-process/#troubleshooting","title":"Troubleshooting","text":""},{"location":"contributing/release-process/#goreleaser-fails","title":"GoReleaser Fails","text":"<p>Check configuration:</p> <pre><code>make check-goreleaser\n</code></pre> <p>Common issues:</p> <ul> <li>Missing GITHUB_TOKEN</li> <li>Invalid .goreleaser.yml syntax</li> <li>Build failures for specific platforms</li> </ul> <p>Debug:</p> <pre><code># Run with verbose output\ngoreleaser release --clean --verbose\n</code></pre>"},{"location":"contributing/release-process/#npm-publish-fails","title":"npm Publish Fails","text":"<p>Check token:</p> <pre><code># Verify npm token is valid\nnpm whoami\n</code></pre> <p>Manual publish (if automation fails):</p> <pre><code>cd npm\nnpm version 1.2.0 --no-git-tag-version\nnpm publish --access public\n</code></pre>"},{"location":"contributing/release-process/#homebrew-tap-not-updated","title":"Homebrew Tap Not Updated","text":"<p>Check:</p> <ol> <li>Verify <code>HOMEBREW_TAP_GITHUB_TOKEN</code> is set</li> <li>Check token has <code>repo</code> scope</li> <li>Verify repository exists: <code>scmd/homebrew-tap</code></li> </ol> <p>Manual update:</p> <pre><code># Clone tap\ngit clone https://github.com/scmd/homebrew-tap\ncd homebrew-tap\n\n# Update formula\n# Edit Formula/scmd.rb with new version and checksums\n\n# Commit and push\ngit commit -am \"Update to v1.2.0\"\ngit push\n</code></pre>"},{"location":"contributing/release-process/#docker-build-fails","title":"Docker Build Fails","text":"<p>Check Docker Hub credentials:</p> <ul> <li>Verify <code>DOCKERHUB_USERNAME</code> and <code>DOCKERHUB_TOKEN</code></li> </ul> <p>Manual build and push:</p> <pre><code># Build locally\ndocker build -t scmd/scmd:1.2.0 .\n\n# Push\ndocker push scmd/scmd:1.2.0\n</code></pre>"},{"location":"contributing/release-process/#advanced-topics","title":"Advanced Topics","text":""},{"location":"contributing/release-process/#custom-binary-names","title":"Custom Binary Names","text":"<p>Edit <code>.goreleaser.yml</code>:</p> <pre><code>builds:\n  - id: scmd\n    binary: scmd\n    # Add custom naming\n</code></pre>"},{"location":"contributing/release-process/#platform-specific-builds","title":"Platform-Specific Builds","text":"<p>Skip platforms:</p> <pre><code>builds:\n  - id: scmd\n    ignore:\n      - goos: windows\n        goarch: arm64\n</code></pre>"},{"location":"contributing/release-process/#signing-binaries","title":"Signing Binaries","text":"<p>Add GPG signing:</p> <pre><code>signs:\n  - artifacts: checksum\n    args:\n      - \"--batch\"\n      - \"--local-user\"\n      - \"{{ .Env.GPG_FINGERPRINT }}\"\n      - \"--output\"\n      - \"${signature}\"\n      - \"--detach-sign\"\n      - \"${artifact}\"\n</code></pre>"},{"location":"contributing/release-process/#custom-release-notes","title":"Custom Release Notes","text":"<p>Edit <code>.goreleaser.yml</code>:</p> <pre><code>changelog:\n  filters:\n    exclude:\n      - '^docs:'\n      - '^test:'\n  groups:\n    - title: 'Features'\n      regexp: '^.*?feat(\\([[:word:]]+\\))??!?:.+$'\n      order: 0\n    - title: 'Bug Fixes'\n      regexp: '^.*?fix(\\([[:word:]]+\\))??!?:.+$'\n      order: 1\n</code></pre>"},{"location":"contributing/release-process/#references","title":"References","text":"<ul> <li>GoReleaser Documentation</li> <li>Semantic Versioning</li> <li>GitHub Actions</li> <li>Homebrew Formula Cookbook</li> <li>npm Publishing Guide</li> </ul>"},{"location":"getting-started/installation/","title":"Installation","text":"<p>scmd works offline by default using llama.cpp and local Qwen models. This guide covers installation on all supported platforms using multiple installation methods.</p>"},{"location":"getting-started/installation/#quick-install","title":"Quick Install","text":"<p>Choose the installation method that works best for you:</p> Homebrew (macOS/Linux)npm (Cross-Platform)Shell Script (wget/curl)Linux PackagesBinary DownloadBuild from Source <p>The easiest way to install on macOS and Linux:</p> <pre><code># Add the scmd tap\nbrew tap scmd/tap\n\n# Install scmd\nbrew install scmd\n\n# Verify installation\nscmd --version\n\n# Install llama.cpp for offline usage\nbrew install llama.cpp\n</code></pre> <p>Homebrew automatically:</p> <ul> <li>Installs the binary to your PATH</li> <li>Adds shell completions for bash, zsh, and fish</li> <li>Manages updates via <code>brew upgrade scmd</code></li> </ul> <p>Works on any platform with Node.js:</p> <pre><code># Install globally\nnpm install -g scmd-cli\n\n# Verify installation\nscmd --version\n\n# Install llama.cpp for offline usage\n# macOS:\nbrew install llama.cpp\n# Linux: build from source (see below)\n</code></pre> <p>The npm package:</p> <ul> <li>Downloads the correct binary for your platform</li> <li>Automatically adds scmd to your PATH</li> <li>Works on macOS, Linux, and Windows</li> </ul> <p>Universal installer for Unix-like systems:</p> <pre><code># Using curl (recommended)\ncurl -fsSL https://scmd.sh/install.sh | bash\n\n# Using wget\nwget -qO- https://scmd.sh/install.sh | bash\n\n# Verify installation\nscmd --version\n</code></pre> <p>The install script:</p> <ul> <li>Auto-detects your OS and architecture</li> <li>Verifies checksums for security</li> <li>Installs to <code>/usr/local/bin</code> or <code>~/.local/bin</code></li> <li>Sets up shell completions</li> </ul> <p>Custom installation:</p> <pre><code># Install to custom directory\ncurl -fsSL https://scmd.sh/install.sh | SCMD_INSTALL_DIR=$HOME/bin bash\n\n# Install without sudo (user-local)\ncurl -fsSL https://scmd.sh/install.sh | SCMD_NO_SUDO=true bash\n\n# Install specific version\ncurl -fsSL https://scmd.sh/install.sh | SCMD_VERSION=v1.0.0 bash\n</code></pre> <p>Native packages for Debian, Red Hat, and Alpine:</p> <p>Debian/Ubuntu (apt): <pre><code># Download and install\nwget https://github.com/scmd/scmd/releases/latest/download/scmd_VERSION_linux_amd64.deb\nsudo dpkg -i scmd_VERSION_linux_amd64.deb\n\n# Or use apt for dependency resolution\nsudo apt install ./scmd_VERSION_linux_amd64.deb\n\n# Verify\nscmd --version\n</code></pre></p> <p>Red Hat/Fedora/CentOS (rpm): <pre><code># Download and install\nwget https://github.com/scmd/scmd/releases/latest/download/scmd_VERSION_linux_amd64.rpm\n\n# Fedora/RHEL 8+\nsudo dnf install scmd_VERSION_linux_amd64.rpm\n\n# CentOS 7/RHEL 7\nsudo yum install scmd_VERSION_linux_amd64.rpm\n\n# Verify\nscmd --version\n</code></pre></p> <p>Alpine Linux (apk): <pre><code>wget https://github.com/scmd/scmd/releases/latest/download/scmd_VERSION_linux_amd64.apk\nsudo apk add --allow-untrusted scmd_VERSION_linux_amd64.apk\n</code></pre></p> <p>Linux packages include:</p> <ul> <li>Binary in <code>/usr/bin/scmd</code></li> <li>Shell completions (bash, zsh, fish)</li> <li>Integration with system package manager</li> </ul> <p>Download pre-built binaries from GitHub:</p> <ol> <li>Visit GitHub Releases</li> <li>Download the archive for your platform:</li> <li>macOS (Intel): <code>scmd_VERSION_macOS_amd64.tar.gz</code></li> <li>macOS (Apple Silicon): <code>scmd_VERSION_macOS_arm64.tar.gz</code></li> <li>Linux (x64): <code>scmd_VERSION_linux_amd64.tar.gz</code></li> <li>Linux (ARM64): <code>scmd_VERSION_linux_arm64.tar.gz</code></li> <li> <p>Windows (x64): <code>scmd_VERSION_windows_amd64.zip</code></p> </li> <li> <p>Extract and install:    <pre><code># macOS/Linux\ntar -xzf scmd_VERSION_macOS_arm64.tar.gz\nsudo mv scmd /usr/local/bin/\n\n# Windows (PowerShell)\nExpand-Archive scmd_VERSION_windows_amd64.zip\n# Add to PATH\n</code></pre></p> </li> <li> <p>Verify checksums (recommended):    <pre><code>wget https://github.com/scmd/scmd/releases/download/v1.0.0/checksums.txt\nshasum -a 256 -c checksums.txt 2&gt;&amp;1 | grep scmd\n</code></pre></p> </li> </ol> <p>For developers or custom builds:</p> <pre><code># Prerequisites: Go 1.24 or later\n\n# Clone the repository\ngit clone https://github.com/scmd/scmd\ncd scmd\n\n# Build using Makefile\nmake build\n\n# Install to /usr/local/bin\nsudo make install\n\n# Or install to $GOPATH/bin\nmake install-go\n\n# Or build with Go directly\ngo build -o scmd ./cmd/scmd\n\n# Verify\n./scmd --version\n</code></pre>"},{"location":"getting-started/installation/#prerequisites","title":"Prerequisites","text":""},{"location":"getting-started/installation/#llamacpp-for-offline-usage","title":"llama.cpp (for offline usage)","text":"<p>scmd requires llama.cpp for offline inference:</p> macOSLinuxWindows <pre><code>brew install llama.cpp\n\n# Verify\nwhich llama-server\nllama-server --version\n</code></pre> <pre><code># Ubuntu/Debian - from package manager (if available)\nsudo apt install llama-cpp\n\n# Or build from source (recommended for latest version)\ngit clone https://github.com/ggerganov/llama.cpp\ncd llama.cpp\nmkdir build &amp;&amp; cd build\n\n# For NVIDIA GPU support\ncmake .. -DLLAMA_CUDA=ON\n\n# For CPU only\n# cmake ..\n\ncmake --build . --config Release\nsudo cp bin/llama-server /usr/local/bin/\n\n# Verify\nwhich llama-server\nllama-server --version\n</code></pre> <p>Download pre-built binaries or build from source:</p> <ol> <li>Visit llama.cpp releases</li> <li>Download Windows binaries</li> <li>Add to PATH</li> </ol> <p>Or build with CMake: <pre><code>git clone https://github.com/ggerganov/llama.cpp\ncd llama.cpp\nmkdir build\ncd build\ncmake ..\ncmake --build . --config Release\n</code></pre></p>"},{"location":"getting-started/installation/#post-installation","title":"Post-Installation","text":""},{"location":"getting-started/installation/#1-verify-installation","title":"1. Verify Installation","text":"<pre><code># Check scmd version\nscmd --version\n\n# Check available backends\nscmd backends\n</code></pre> <p>Expected output: <pre><code>Available backends:\n\n\u2713 llamacpp     qwen2.5-1.5b\n\u2717 ollama       (not running)\n\u2717 openai       (not configured)\n</code></pre></p>"},{"location":"getting-started/installation/#2-first-run-model-download","title":"2. First Run (Model Download)","text":"<p>On first use, scmd will automatically download the default model (~1.0GB):</p> <pre><code>scmd /explain \"what is a channel in Go?\"\n</code></pre> <p>Output: <pre><code>[INFO] First run detected\n[INFO] Downloading qwen2.5-1.5b model (1.0 GB)...\n[INFO] Progress: \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 100%\n[INFO] Model downloaded to ~/.scmd/models/qwen2.5-1.5b-q4_k_m.gguf\n[INFO] Starting llama-server...\n\nA channel in Go is a typed conduit through which you can send\nand receive values with the channel operator &lt;-...\n</code></pre></p>"},{"location":"getting-started/installation/#3-set-up-shell-completions-optional","title":"3. Set Up Shell Completions (Optional)","text":"<p>Enable tab completion for scmd commands:</p> BashZshFish <pre><code># Generate completion script\nscmd completion bash &gt; /tmp/scmd-completion.bash\n\n# Install for current user\nmkdir -p ~/.bash_completion.d\nmv /tmp/scmd-completion.bash ~/.bash_completion.d/scmd\n\n# Or install system-wide (requires sudo)\nsudo scmd completion bash &gt; /etc/bash_completion.d/scmd\n\n# Reload\nsource ~/.bashrc\n</code></pre> <pre><code># Enable completion system\necho \"autoload -U compinit; compinit\" &gt;&gt; ~/.zshrc\n\n# Install completion\nscmd completion zsh &gt; \"${fpath[1]}/_scmd\"\n\n# Reload\nsource ~/.zshrc\n</code></pre> <pre><code># Install completion\nscmd completion fish &gt; ~/.config/fish/completions/scmd.fish\n\n# Reload\nsource ~/.config/fish/config.fish\n</code></pre>"},{"location":"getting-started/installation/#directory-structure","title":"Directory Structure","text":"<p>scmd uses the following directory structure:</p> <pre><code>~/.scmd/\n\u251c\u2500\u2500 config.yaml          # Configuration file\n\u251c\u2500\u2500 slash.yaml           # Slash command mappings\n\u251c\u2500\u2500 repos.json           # Repository list\n\u251c\u2500\u2500 models/              # Downloaded GGUF models\n\u2502   \u251c\u2500\u2500 qwen2.5-1.5b-q4_k_m.gguf\n\u2502   \u2514\u2500\u2500 qwen2.5-3b-q4_k_m.gguf\n\u251c\u2500\u2500 commands/            # Installed command specs\n\u2502   \u251c\u2500\u2500 git-commit.yaml\n\u2502   \u2514\u2500\u2500 explain.yaml\n\u2514\u2500\u2500 cache/               # Cached manifests\n    \u2514\u2500\u2500 official/\n        \u2514\u2500\u2500 manifest.yaml\n</code></pre>"},{"location":"getting-started/installation/#xdg-base-directory-support","title":"XDG Base Directory Support","text":"<p>scmd respects XDG environment variables if set:</p> <pre><code>export XDG_CONFIG_HOME=~/.config\nexport XDG_DATA_HOME=~/.local/share\nexport XDG_CACHE_HOME=~/.cache\n\n# scmd will use:\n# - $XDG_CONFIG_HOME/scmd/ for config\n# - $XDG_DATA_HOME/scmd/ for models and data\n# - $XDG_CACHE_HOME/scmd/ for cache\n</code></pre> <p>Or customize the data directory:</p> <pre><code>export SCMD_DATA_DIR=/path/to/custom/dir\nscmd /explain \"test\"\n</code></pre>"},{"location":"getting-started/installation/#updating-scmd","title":"Updating scmd","text":"HomebrewnpmShell ScriptLinux PackagesSource <pre><code>brew upgrade scmd\n</code></pre> <pre><code>npm update -g scmd-cli\n</code></pre> <p>Re-run the install script: <pre><code>curl -fsSL https://scmd.sh/install.sh | bash\n</code></pre></p> <pre><code># Debian/Ubuntu\nsudo apt upgrade scmd\n\n# Fedora/RHEL\nsudo dnf upgrade scmd\n</code></pre> <pre><code>cd scmd\ngit pull origin main\nmake build\nsudo make install\n</code></pre>"},{"location":"getting-started/installation/#uninstalling-scmd","title":"Uninstalling scmd","text":"HomebrewnpmShell ScriptLinux Packages <pre><code>brew uninstall scmd\n\n# Remove data (optional)\nrm -rf ~/.scmd\n</code></pre> <pre><code>npm uninstall -g scmd-cli\n\n# Remove data (optional)\nrm -rf ~/.scmd\n</code></pre> <pre><code># Use the uninstall script\ncurl -fsSL https://scmd.sh/uninstall.sh | bash\n\n# Or manually\nsudo rm /usr/local/bin/scmd\nrm -rf ~/.scmd\n</code></pre> <pre><code># Debian/Ubuntu\nsudo apt remove scmd\n\n# Fedora/RHEL\nsudo dnf remove scmd\n\n# Remove data (optional)\nrm -rf ~/.scmd\n</code></pre>"},{"location":"getting-started/installation/#troubleshooting","title":"Troubleshooting","text":"<p>For detailed troubleshooting, see the Troubleshooting Guide.</p>"},{"location":"getting-started/installation/#common-issues","title":"Common Issues","text":""},{"location":"getting-started/installation/#command-not-found-scmd","title":"Command not found: scmd","text":"<p>Issue: Shell can't find the scmd binary.</p> <p>Solution: Add scmd's installation directory to PATH:</p> <pre><code># For ~/.local/bin\necho 'export PATH=\"$HOME/.local/bin:$PATH\"' &gt;&gt; ~/.bashrc\nsource ~/.bashrc\n\n# For Homebrew on Apple Silicon\necho 'eval \"$(/opt/homebrew/bin/brew shellenv)\"' &gt;&gt; ~/.zprofile\neval \"$(/opt/homebrew/bin/brew shellenv)\"\n</code></pre>"},{"location":"getting-started/installation/#llama-server-not-found","title":"llama-server not found","text":"<p>Issue: Offline functionality requires llama.cpp.</p> <p>Solution: Install llama.cpp (see Prerequisites section above)</p>"},{"location":"getting-started/installation/#model-download-failed","title":"Model download failed","text":"<p>Issue: Network issues or firewall restrictions.</p> <p>Solution:</p> <pre><code># Check network\ncurl -I https://huggingface.co\n\n# Manually download model\nscmd models pull qwen2.5-1.5b\n\n# Use alternative model\nscmd models pull qwen3-4b\n</code></pre>"},{"location":"getting-started/installation/#permission-denied","title":"Permission denied","text":"<p>Issue: Binary is not executable.</p> <p>Solution:</p> <pre><code>chmod +x /path/to/scmd\n</code></pre>"},{"location":"getting-started/installation/#optional-additional-llm-backends","title":"Optional: Additional LLM Backends","text":""},{"location":"getting-started/installation/#ollama","title":"Ollama","text":"<pre><code># Install Ollama\ncurl -fsSL https://ollama.com/install.sh | sh\n\n# Pull a model\nollama pull qwen2.5-coder:1.5b\n\n# Start Ollama server\nollama serve\n\n# Use with scmd\nscmd -b ollama /explain main.go\n</code></pre>"},{"location":"getting-started/installation/#openai","title":"OpenAI","text":"<pre><code># Set API key\nexport OPENAI_API_KEY=sk-...\n\n# Use with scmd\nscmd -b openai -m gpt-4o-mini /review code.py\n</code></pre>"},{"location":"getting-started/installation/#togetherai-free-tier-available","title":"Together.ai (Free Tier Available)","text":"<pre><code># Get API key from https://together.ai\nexport TOGETHER_API_KEY=...\n\n# Use with scmd\nscmd -b together /explain main.go\n</code></pre>"},{"location":"getting-started/installation/#groq-free-tier-available","title":"Groq (Free Tier Available)","text":"<pre><code># Get API key from https://groq.com\nexport GROQ_API_KEY=gsk_...\n\n# Use with scmd\nscmd -b groq -m llama-3.1-8b-instant /review code.py\n</code></pre>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<ul> <li>Quick Start Tutorial - Learn basic usage in 5 minutes</li> <li>Your First Command - Create a custom command</li> <li>Shell Integration - Set up <code>/command</code> shortcuts</li> <li>Model Management - Download and manage models</li> </ul>"},{"location":"getting-started/installation/#getting-help","title":"Getting Help","text":"<ul> <li>Documentation: Full documentation</li> <li>Issues: GitHub Issues</li> <li>Discussions: GitHub Discussions</li> </ul> <p>For a detailed installation guide with platform-specific instructions and advanced options, see INSTALL.md in the repository.</p>"},{"location":"getting-started/quick-start/","title":"Quick Start","text":"<p>Get up and running with scmd in 5 minutes. This guide assumes you've already installed scmd.</p>"},{"location":"getting-started/quick-start/#your-first-command","title":"Your First Command","text":"<p>Type <code>/explain</code> to explain code or concepts:</p> <pre><code>./scmd /explain \"what is a goroutine in Go?\"\n</code></pre> <p>First Run</p> <p>On first run, scmd will download the default qwen2.5-1.5b model (~1.0GB). This takes 2-5 minutes depending on your connection, but only happens once.</p> <p>Output: <pre><code>A goroutine is a lightweight thread managed by the Go runtime. Goroutines\nare functions or methods that run concurrently with other goroutines in\nthe same address space. They are created with the `go` keyword...\n</code></pre></p>"},{"location":"getting-started/quick-start/#explaining-code","title":"Explaining Code","text":"<p>Explain a file directly:</p> <pre><code>./scmd /explain main.go\n</code></pre> <p>Or pipe code to the command:</p> <pre><code>cat main.go | ./scmd /explain\n</code></pre>"},{"location":"getting-started/quick-start/#common-use-cases","title":"Common Use Cases","text":""},{"location":"getting-started/quick-start/#1-generate-git-commit-messages","title":"1. Generate Git Commit Messages","text":"<pre><code># Stage your changes\ngit add .\n\n# Generate commit message from diff\ngit diff --staged | ./scmd /gc\n</code></pre> <p>Output: <pre><code>feat: add user authentication system\n\nImplemented JWT-based authentication with:\n- Login and registration endpoints\n- Token validation middleware\n- Password hashing with bcrypt\n- Session management\n\nBreaking changes: Auth header format changed from\nBearer to JWT.\n</code></pre></p>"},{"location":"getting-started/quick-start/#2-review-code-for-issues","title":"2. Review Code for Issues","text":"<pre><code># Review a file\n./scmd /review main.go\n\n# Or pipe code\ngit diff | ./scmd /review\n</code></pre> <p>Output: <pre><code>Code Review:\n\n\u2713 Good use of error handling\n\u2713 Functions are well-structured\n\u26a0\ufe0f Consider adding input validation in CreateUser()\n\u26a0\ufe0f SQL query should use parameterized queries to prevent injection\n\u274c Missing database connection cleanup - add defer db.Close()\n\nSecurity Concerns:\n- Line 45: Potential SQL injection vulnerability\n- Line 78: Password stored in plaintext\n\nSuggestions:\n1. Use prepared statements for database queries\n2. Hash passwords with bcrypt\n3. Add proper error messages for user feedback\n</code></pre></p>"},{"location":"getting-started/quick-start/#3-summarize-changes","title":"3. Summarize Changes","text":"<pre><code>git diff | ./scmd /sum\n</code></pre> <p>Output: <pre><code>**Summary of Changes:**\n\n- Added user authentication endpoints (/login, /register)\n- Implemented JWT token generation and validation\n- Created User model and database schema\n- Added password hashing utilities\n- Updated middleware to check authentication\n- Added tests for auth endpoints (15 new tests)\n\n**Files changed:** 8 modified, 3 new\n</code></pre></p>"},{"location":"getting-started/quick-start/#4-fix-errors","title":"4. Fix Errors","text":"<pre><code># Pipe error logs\ngo build 2&gt;&amp;1 | ./scmd /fix\n\n# Or from a file\ncat error.log | ./scmd /fix\n</code></pre> <p>Output: <pre><code>Error Analysis:\n\nError: \"undefined: User.Pasword\"\nCause: Typo in field name (should be \"Password\")\nFix: Line 42, change User.Pasword to User.Password\n\nError: \"cannot use string as int value in assignment\"\nCause: Type mismatch in ID field\nFix: Convert string to int using strconv.Atoi()\n\nSuggested fixes:\n```go\n// Line 42\n-user.Pasword = hash\n+user.Password = hash\n\n// Line 58\n-userID := \"123\"\n+userID, err := strconv.Atoi(\"123\")\n</code></pre></p>"},{"location":"getting-started/quick-start/#available-slash-commands","title":"Available Slash Commands","text":"Command Aliases Description <code>/explain</code> <code>/e</code>, <code>/exp</code> Explain code or concepts <code>/review</code> <code>/r</code>, <code>/rev</code> Review code for issues <code>/commit</code> <code>/gc</code>, <code>/gitc</code> Generate git commit messages <code>/summarize</code> <code>/s</code>, <code>/sum</code>, <code>/tldr</code> Summarize text <code>/fix</code> <code>/f</code>, <code>/err</code> Explain and fix errors"},{"location":"getting-started/quick-start/#using-different-models","title":"Using Different Models","text":"<p>List available models:</p> <pre><code>scmd models list\n</code></pre> <p>Download a specific model:</p> <pre><code>scmd models pull qwen2.5-3b\n</code></pre> <p>Use a specific model:</p> <pre><code>scmd -m qwen2.5-3b /explain main.go\n</code></pre>"},{"location":"getting-started/quick-start/#using-different-backends","title":"Using Different Backends","text":""},{"location":"getting-started/quick-start/#ollama-local-alternative","title":"Ollama (Local, Alternative)","text":"<pre><code># Start Ollama\nollama serve\n\n# Pull a model\nollama pull qwen2.5-coder:1.5b\n\n# Use with scmd\nscmd -b ollama /explain main.go\n</code></pre>"},{"location":"getting-started/quick-start/#openai-cloud","title":"OpenAI (Cloud)","text":"<pre><code>export OPENAI_API_KEY=sk-...\nscmd -b openai -m gpt-4o-mini /review code.py\n</code></pre>"},{"location":"getting-started/quick-start/#inline-prompts","title":"Inline Prompts","text":"<p>Use custom prompts on the fly:</p> <pre><code># With -p flag\necho \"SELECT * FROM users WHERE id = ?\" | scmd -p \"optimize this SQL query\"\n\n# File input\ncat config.yaml | scmd -p \"convert this to JSON\"\n</code></pre>"},{"location":"getting-started/quick-start/#saving-output","title":"Saving Output","text":"<pre><code># Save to file\ngit diff | ./scmd /review -o review.md\n\n# Append to file\ncat error.log | ./scmd /fix &gt;&gt; fixes.txt\n</code></pre>"},{"location":"getting-started/quick-start/#chaining-commands","title":"Chaining Commands","text":"<pre><code># Complex pipeline\ngit log -1 --pretty=format:\"%B\" | \\\n  ./scmd /sum | \\\n  ./scmd -p \"translate to Spanish\"\n</code></pre>"},{"location":"getting-started/quick-start/#debug-mode","title":"Debug Mode","text":"<p>Enable debug output to see what's happening:</p> <pre><code>SCMD_DEBUG=1 ./scmd /explain \"what is Docker?\"\n</code></pre> <p>Output: <pre><code>[DEBUG] Model path: /Users/you/.scmd/models/qwen2.5-1.5b-q4_k_m.gguf\n[DEBUG] Prompt length: 156 chars\n[DEBUG] Sending request to http://127.0.0.1:8089/completion\n[DEBUG] Response status: 200\n[DEBUG] Response length: 842 chars\n\nDocker is a platform for developing, shipping, and running\napplications in containers...\n</code></pre></p>"},{"location":"getting-started/quick-start/#performance-tips","title":"Performance Tips","text":""},{"location":"getting-started/quick-start/#faster-responses","title":"Faster Responses","text":"<p>Use a smaller, faster model for quick queries:</p> <pre><code>scmd models pull qwen2.5-0.5b  # Smallest, fastest\nscmd -m qwen2.5-0.5b /sum article.md\n</code></pre>"},{"location":"getting-started/quick-start/#gpu-acceleration","title":"GPU Acceleration","text":"<p>scmd automatically uses GPU if available:</p> <ul> <li>macOS: Metal (M1/M2/M3 chips)</li> <li>Linux: CUDA (NVIDIA GPUs)</li> <li>Windows: CUDA or CPU</li> </ul> <p>Verify GPU usage:</p> <pre><code># Check if GPU is being used\nllama-server --help | grep -E \"metal|cuda\"\n</code></pre>"},{"location":"getting-started/quick-start/#model-comparison","title":"Model Comparison","text":"Model Size Speed (tokens/sec) Best For qwen2.5-0.5b 379 MB ~60 (GPU), ~15 (CPU) Quick summaries qwen2.5-1.5b \u2b50 940 MB ~40 (GPU), ~10 (CPU) Default (fast, lightweight) qwen2.5-3b 1.9 GB ~25 (GPU), ~7 (CPU) Balanced qwen3-4b 2.5 GB ~20 (GPU), ~5 (CPU) Alternative (tool calling) qwen2.5-7b 4.4 GB ~12 (GPU), ~3 (CPU) Complex tasks"},{"location":"getting-started/quick-start/#workflow-examples","title":"Workflow Examples","text":""},{"location":"getting-started/quick-start/#code-review-workflow","title":"Code Review Workflow","text":"<pre><code># 1. Make changes\ngit add .\n\n# 2. Review changes\ngit diff --staged | ./scmd /review -o review.md\n\n# 3. Generate commit message\ngit diff --staged | ./scmd /gc &gt; commit.txt\n\n# 4. Commit with generated message\ngit commit -F commit.txt\n</code></pre>"},{"location":"getting-started/quick-start/#error-debugging-workflow","title":"Error Debugging Workflow","text":"<pre><code># 1. Run tests and capture errors\ngo test ./... 2&gt;&amp;1 | tee errors.txt\n\n# 2. Analyze errors\ncat errors.txt | ./scmd /fix &gt; fixes.md\n\n# 3. Explain specific error\ncat errors.txt | ./scmd /explain\n</code></pre>"},{"location":"getting-started/quick-start/#documentation-workflow","title":"Documentation Workflow","text":"<pre><code># 1. Explain code\n./scmd /explain src/auth.go &gt; docs/auth.md\n\n# 2. Summarize changes\ngit log --since=\"1 week ago\" --pretty=format:\"%s\" | ./scmd /sum &gt; CHANGELOG.md\n\n# 3. Generate README sections\nls -la | ./scmd -p \"describe this project structure\" &gt;&gt; README.md\n</code></pre>"},{"location":"getting-started/quick-start/#common-patterns","title":"Common Patterns","text":""},{"location":"getting-started/quick-start/#process-multiple-files","title":"Process Multiple Files","text":"<pre><code># Explain all Go files\nfor file in *.go; do\n  echo \"=== $file ===\" &gt;&gt; explanations.md\n  ./scmd /explain \"$file\" &gt;&gt; explanations.md\ndone\n</code></pre>"},{"location":"getting-started/quick-start/#watch-for-changes","title":"Watch for Changes","text":"<pre><code># Review changes on save (requires fswatch)\nfswatch -o src/*.go | xargs -n1 -I{} git diff | ./scmd /review\n</code></pre>"},{"location":"getting-started/quick-start/#interactive-mode","title":"Interactive Mode","text":"<pre><code># REPL-style interaction\nscmd slash interactive\n</code></pre> <pre><code>scmd&gt; /explain what is a mutex?\nA mutex (mutual exclusion) is a synchronization primitive...\n\nscmd&gt; /review\nPaste code (Ctrl+D when done):\nfunc main() {\n    x := 1\n    x = x + 1\n}\n^D\n\nReview: Simple code. Consider using x++ instead of x = x + 1\n</code></pre>"},{"location":"getting-started/quick-start/#troubleshooting","title":"Troubleshooting","text":""},{"location":"getting-started/quick-start/#slow-responses","title":"Slow Responses","text":"<ul> <li>Use a smaller model: <code>scmd -m qwen2.5-1.5b /explain</code></li> <li>Reduce max_tokens in command spec</li> <li>Enable GPU acceleration (check installation)</li> </ul>"},{"location":"getting-started/quick-start/#model-not-found","title":"Model Not Found","text":"<pre><code># List downloaded models\nscmd models list\n\n# Download missing model\nscmd models pull qwen2.5-1.5b\n</code></pre>"},{"location":"getting-started/quick-start/#command-not-found","title":"Command Not Found","text":"<pre><code># List available commands\nscmd slash list\n\n# Install missing command\nscmd repo install official/explain\n</code></pre>"},{"location":"getting-started/quick-start/#next-steps","title":"Next Steps","text":"<ul> <li> <p> Create Your First Command</p> <p>Build a custom AI command</p> </li> <li> <p> Set Up Shell Integration</p> <p>Use <code>/command</code> directly without <code>./scmd</code> prefix</p> </li> <li> <p> Explore Advanced Features</p> <p>Learn about tool calling, hooks, and composition</p> </li> <li> <p> Install Community Commands</p> <p>Browse and install commands from repositories</p> </li> </ul>"},{"location":"getting-started/quick-start/#quick-reference","title":"Quick Reference","text":"<pre><code># Basic usage\n./scmd /COMMAND [args]\ncat file | ./scmd /COMMAND\n\n# With options\nscmd -b BACKEND -m MODEL /COMMAND\nscmd -p \"custom prompt\" /COMMAND\n\n# Management\nscmd models list              # List models\nscmd backends                 # Check backends\nscmd slash list               # List commands\nscmd repo search QUERY        # Search commands\n\n# Help\nscmd --help\nscmd COMMAND --help\n</code></pre>"},{"location":"user-guide/safety-features/","title":"Safety Features","text":"<p>scmd includes powerful safety features to protect you from accidentally executing destructive commands. When tool-calling commands use the shell tool, scmd automatically detects dangerous operations and provides an interactive preview.</p> <p>Proactive Safety</p> <p>Safety features work automatically - no configuration needed. Destructive commands are detected and previewed before execution.</p>"},{"location":"user-guide/safety-features/#command-preview","title":"Command Preview","text":""},{"location":"user-guide/safety-features/#overview","title":"Overview","text":"<p>When scmd detects a potentially destructive shell command, it pauses execution and shows you:</p> <ul> <li>Warning banner with severity level</li> <li>Command breakdown with detected risks</li> <li>Impact estimate (affected files, size, scope)</li> <li>Interactive prompt with actions</li> </ul>"},{"location":"user-guide/safety-features/#severity-levels","title":"Severity Levels","text":"<p>Commands are classified by severity:</p> Severity Icon Examples Behavior Low \u2139\ufe0f <code>kill</code>, basic <code>chmod</code> Execute without preview Medium \u26a0\ufe0f <code>pkill</code>, <code>chmod 777</code> Show preview High \ud83d\udd25 <code>rm files</code>, <code>git reset --hard</code> Show preview Critical \ud83d\udc80 <code>rm -rf</code>, <code>DROP TABLE</code>, <code>dd</code> Show preview with emphasis <p>Threshold</p> <p>Only Medium severity and above trigger the preview. Low severity commands execute normally.</p>"},{"location":"user-guide/safety-features/#interactive-actions","title":"Interactive Actions","text":"<p>When a preview is shown, you have four options:</p>"},{"location":"user-guide/safety-features/#edit-modify-the-command","title":"[E]dit - Modify the Command","text":"<p>Opens your <code>$EDITOR</code> (or <code>vi</code> as fallback) to modify the command before execution:</p> <pre><code>What would you like to do?\n  [E]dit command\n  [D]ry-run (show what would happen)\n  [Enter] Execute anyway\n  [Q]uit / Cancel\n\nChoice: e\n</code></pre> <p>After editing, the modified command is re-validated and executed (or previewed again if still destructive).</p> <p>Example flow: <pre><code>Original: rm -rf /tmp/old-data\n(Edit in vi)\nModified: rm -rf /tmp/old-data/cache-only\n(Preview shown again if needed)\nExecute\n</code></pre></p>"},{"location":"user-guide/safety-features/#dry-run-preview-without-executing","title":"[D]ry-run - Preview Without Executing","text":"<p>Shows what would happen without making any changes:</p> <pre><code>Choice: d\n\n[DRY RUN] Would execute: rm -rf node_modules\n\nNo actual changes made.\n</code></pre> <p>This is useful for: - Verifying the command is correct - Understanding the scope of changes - Testing command composition</p>"},{"location":"user-guide/safety-features/#enter-execute-anyway","title":"[Enter] - Execute Anyway","text":"<p>Proceeds with execution of the original command. Use this when: - You've reviewed the command and it's correct - You understand the impact - You want to proceed with the operation</p> <pre><code>Choice: (press Enter)\n\nExecuting: rm -rf node_modules\n\n(command executes normally)\n</code></pre>"},{"location":"user-guide/safety-features/#quit-cancel-operation","title":"[Q]uit - Cancel Operation","text":"<p>Cancels the command entirely without executing anything:</p> <pre><code>Choice: q\n\nCommand cancelled by user\n</code></pre> <p>The LLM will receive a message that the command was cancelled.</p>"},{"location":"user-guide/safety-features/#detected-dangerous-patterns","title":"Detected Dangerous Patterns","text":"<p>scmd detects 20+ categories of destructive operations:</p>"},{"location":"user-guide/safety-features/#file-deletion","title":"File Deletion","text":"<pre><code>rm file.txt                    # High severity\nrm -r directory                # Critical severity\nrm -rf *                       # Critical severity\n</code></pre> <p>Detected patterns: - Recursive deletion (<code>-r</code>, <code>-R</code>, <code>-rf</code>) - Wildcard deletion (<code>*</code>, <code>?</code>) - Force deletion (<code>-f</code>)</p> <p>Impact estimate: - File count (estimated from patterns) - Directory vs. files - Special cases (e.g., <code>node_modules</code> = ~10,000 files)</p>"},{"location":"user-guide/safety-features/#git-operations","title":"Git Operations","text":"<pre><code>git push --force               # Critical severity\ngit push -f origin main        # Critical severity\ngit reset --hard HEAD          # High severity\ngit clean -fd                  # High severity\ngit branch -D feature          # Medium severity\n</code></pre> <p>Why dangerous: - <code>--force push</code>: Rewrites remote history, affects team - <code>--hard reset</code>: Discards uncommitted changes permanently - <code>clean -fd</code>: Removes untracked files (can't be recovered) - <code>-D branch</code>: Force deletes branch without merge check</p>"},{"location":"user-guide/safety-features/#docker-operations","title":"Docker Operations","text":"<pre><code>docker system prune -a         # High severity\ndocker rm -f container         # Medium severity\ndocker volume rm data-vol      # High severity (DATA LOSS)\n</code></pre> <p>Impact: - <code>prune -a</code>: Removes all unused resources - <code>volume rm</code>: Permanent data loss - <code>-f</code>: Force removal without confirmation</p>"},{"location":"user-guide/safety-features/#kubernetes","title":"Kubernetes","text":"<pre><code>kubectl delete pod my-pod      # High severity\nkubectl delete deployment app  # High severity\nkubectl delete namespace prod  # Critical severity\n</code></pre> <p>Impact: - Service disruption - Data loss if stateful - Affects production systems</p>"},{"location":"user-guide/safety-features/#database-operations","title":"Database Operations","text":"<pre><code>DROP TABLE users;              # Critical severity\nTRUNCATE TABLE logs;           # Critical severity\nDELETE FROM customers;         # Critical severity\n</code></pre> <p>Why critical: - Permanent data loss - No undo (unless backups exist) - Can affect production systems</p>"},{"location":"user-guide/safety-features/#system-operations","title":"System Operations","text":"<pre><code>shutdown now                   # Critical severity\nreboot                         # Critical severity\ndd if=/dev/zero of=/dev/sda    # Critical severity\nmkfs.ext4 /dev/sdb1            # Critical severity\n</code></pre> <p>Impact: - System downtime - Disk formatting (irreversible) - Data destruction</p>"},{"location":"user-guide/safety-features/#process-management","title":"Process Management","text":"<pre><code>kill -9 12345                  # Medium severity\npkill node                     # Medium severity\nkillall python                 # Medium severity\n</code></pre> <p>Risks: - Force kills (no graceful shutdown) - May kill multiple processes - Can disrupt services</p>"},{"location":"user-guide/safety-features/#permissions","title":"Permissions","text":"<pre><code>chmod 777 secret.key           # Medium severity (security risk)\nchown -R nobody:nobody /       # Medium severity\n</code></pre> <p>Why flagged: - Security vulnerabilities (world-writable) - Recursive changes can break system - Permission errors can lock you out</p>"},{"location":"user-guide/safety-features/#package-management","title":"Package Management","text":"<pre><code>npm uninstall -g typescript    # Medium severity\napt remove nginx               # High severity\npip uninstall -y pandas        # Medium severity\n</code></pre> <p>Impact: - Global package removal - System package removal (may break dependencies) - Can affect other projects</p>"},{"location":"user-guide/safety-features/#examples","title":"Examples","text":""},{"location":"user-guide/safety-features/#example-1-file-deletion-with-preview","title":"Example 1: File Deletion with Preview","text":"<p>A command using the shell tool tries to delete files:</p> <pre><code>\ud83d\udc80 CRITICAL DESTRUCTIVE COMMAND DETECTED\n============================================================\n\nCommand:\n  rm -rf node_modules dist build\n\nDetected Risks:\n  1. \ud83d\udc80 Recursive file deletion - CANNOT BE UNDONE\n     Matched: 'rm -rf'\n\nEstimated Impact:\n  Affects: directories (recursive)\n  Count: ~10000 items\n  Size: ~500 MB\n\nWhat would you like to do?\n  [E]dit command\n  [D]ry-run (show what would happen)\n  [Enter] Execute anyway\n  [Q]uit / Cancel\n\nChoice:\n</code></pre> <p>User chooses [D]ry-run:</p> <pre><code>[DRY RUN] Would execute: rm -rf node_modules dist build\n\nNo actual changes made.\n</code></pre> <p>LLM receives: \"Dry run completed. No changes made.\"</p>"},{"location":"user-guide/safety-features/#example-2-git-force-push-with-edit","title":"Example 2: Git Force Push with Edit","text":"<pre><code>\ud83d\udc80 CRITICAL DESTRUCTIVE COMMAND DETECTED\n============================================================\n\nCommand:\n  git push --force origin main\n\nDetected Risks:\n  1. \ud83d\udc80 Force push - rewrites remote history\n     Matched: 'git push --force'\n\nEstimated Impact:\n  Affects: git commits (remote)\n  Count: Unknown (potentially many)\n\nWhat would you like to do?\n  [E]dit command\n  [D]ry-run (show what would happen)\n  [Enter] Execute anyway\n  [Q]uit / Cancel\n\nChoice: e\n</code></pre> <p>User edits in $EDITOR:</p> <p>Original: <pre><code>git push --force origin main\n</code></pre></p> <p>Modified to safer option: <pre><code>git push --force-with-lease origin feature-branch\n</code></pre></p> <p>Result: - Safer <code>--force-with-lease</code> instead of <code>--force</code> - Target is feature branch, not main - Re-validated and executed</p>"},{"location":"user-guide/safety-features/#example-3-docker-cleanup","title":"Example 3: Docker Cleanup","text":"<pre><code>\ud83d\udd25 HIGH DESTRUCTIVE COMMAND DETECTED\n============================================================\n\nCommand:\n  docker system prune -a\n\nDetected Risks:\n  1. \ud83d\udd25 Remove all unused Docker resources\n     Matched: 'docker system prune -a'\n\nEstimated Impact:\n  Affects: Docker resources\n  Count: Unknown (potentially many)\n\nWhat would you like to do?\n  [E]dit command\n  [D]ry-run (show what would happen)\n  [Enter] Execute anyway\n  [Q]uit / Cancel\n\nChoice: (Enter to execute)\n\nExecuting: docker system prune -a\n\nWARNING! This will remove:\n  - all stopped containers\n  - all networks not used by at least one container\n  - all images without at least one container associated to them\n  - all build cache\n\nAre you sure you want to continue? [y/N]\n</code></pre> <p>Docker's own confirmation provides second layer of safety.</p>"},{"location":"user-guide/safety-features/#configuration","title":"Configuration","text":""},{"location":"user-guide/safety-features/#adjusting-sensitivity","title":"Adjusting Sensitivity","text":"<p>Currently, the severity threshold is hardcoded to Medium. Commands with Low severity execute without preview.</p> <p>Future versions will support configuration:</p> <pre><code># .scmdrc (planned)\nsafety:\n  preview_threshold: high  # Only preview high/critical\n  auto_dry_run: true       # Always dry-run first\n  require_confirmation: true\n</code></pre>"},{"location":"user-guide/safety-features/#custom-patterns","title":"Custom Patterns","text":"<p>Future support for custom destructive patterns:</p> <pre><code># .scmdrc (planned)\nsafety:\n  custom_patterns:\n    - pattern: \"terraform destroy\"\n      severity: critical\n      description: \"Destroys infrastructure\"\n</code></pre>"},{"location":"user-guide/safety-features/#whitelisting-commands","title":"Whitelisting Commands","text":"<p>Currently, the shell tool has a whitelist of allowed commands. Only whitelisted base commands can execute.</p> <p>See Tool Calling Guide for the full whitelist.</p>"},{"location":"user-guide/safety-features/#best-practices","title":"Best Practices","text":""},{"location":"user-guide/safety-features/#for-end-users","title":"For End Users","text":"<ol> <li>Read the Preview: Don't just hit Enter - read what command will execute</li> <li>Use Dry-Run: When in doubt, use dry-run mode first</li> <li>Edit for Safety: Modify commands to be safer (e.g., add specific paths instead of wildcards)</li> <li>Cancel if Unsure: It's always safe to quit and try again</li> </ol>"},{"location":"user-guide/safety-features/#for-command-authors","title":"For Command Authors","text":"<ol> <li>Trust the Safety Net: Let users leverage the preview system</li> <li>Educate the LLM: Include safety notes in system prompts</li> <li>Suggest Dry-Runs: Prompt LLMs to suggest dry-run for risky operations</li> <li>Provide Alternatives: LLMs should offer safer alternatives when possible</li> </ol> <p>Example system prompt:</p> <pre><code>prompt:\n  system: |\n    You are a helpful assistant that uses the shell tool.\n\n    IMPORTANT: The shell tool has automatic safety features:\n    - Destructive commands show interactive previews\n    - Users can edit, dry-run, execute, or cancel\n\n    When suggesting destructive operations:\n    1. Explain what will be deleted/changed\n    2. Suggest dry-run mode first\n    3. Offer safer alternatives if available\n    4. Use specific paths instead of wildcards when possible\n</code></pre>"},{"location":"user-guide/safety-features/#example-safe-cleanup-command","title":"Example: Safe Cleanup Command","text":"<pre><code>name: safe-cleanup\nprompt:\n  system: |\n    Help clean up build artifacts safely.\n\n    SAFETY PROTOCOL:\n    1. ALWAYS list what will be deleted first (ls or find)\n    2. Use specific paths, avoid wildcards when possible\n    3. Suggest dry-run for review\n    4. The preview system will catch dangerous operations\n\n  template: |\n    Clean up: {{.artifacts}}\n\n    Steps:\n    1. Use 'find' or 'ls' to list what will be deleted\n    2. Show the list to the user\n    3. Use 'rm' to delete (preview will activate automatically)\n    4. Confirm deletion completed\n</code></pre>"},{"location":"user-guide/safety-features/#troubleshooting","title":"Troubleshooting","text":""},{"location":"user-guide/safety-features/#preview-not-showing","title":"Preview Not Showing","text":"<p>Symptom: Destructive command executes without preview</p> <p>Possible causes: 1. Command severity is Low (below threshold) 2. Command not in detected patterns 3. Shell tool not being used (direct execution)</p> <p>Solutions: - Check if command matches patterns in detector - Verify tool-calling is enabled - Report missing patterns as feature requests</p>"},{"location":"user-guide/safety-features/#cant-edit-command","title":"Can't Edit Command","text":"<p>Symptom: Edit mode fails with \"editor not found\"</p> <p>Cause: <code>$EDITOR</code> environment variable not set</p> <p>Solution: <pre><code># Set your preferred editor\nexport EDITOR=nano  # or vim, emacs, code, etc.\n\n# Or set permanently in ~/.bashrc or ~/.zshrc\necho 'export EDITOR=nano' &gt;&gt; ~/.bashrc\n</code></pre></p> <p>Fallback: scmd uses <code>vi</code> if <code>$EDITOR</code> is not set.</p>"},{"location":"user-guide/safety-features/#false-positives","title":"False Positives","text":"<p>Symptom: Safe commands trigger preview</p> <p>Example: <code>mkdir /tmp/test-rm-backup</code> (contains \"rm\" substring)</p> <p>Current status: Pattern matching is substring-based, may have false positives</p> <p>Workaround: Just press Enter to execute if you know it's safe</p> <p>Planned fix: Improve regex patterns to be word-boundary aware</p>"},{"location":"user-guide/safety-features/#limitations","title":"Limitations","text":""},{"location":"user-guide/safety-features/#current-limitations","title":"Current Limitations","text":"<ol> <li>Pattern-Based Detection: Uses regex, not semantic analysis</li> <li>May have false positives (safe commands flagged)</li> <li> <p>May miss variations of dangerous commands</p> </li> <li> <p>No Undo: Preview prevents execution, but can't undo if you execute</p> </li> <li>Backups are your responsibility</li> <li> <p>Consider <code>git commit</code> before risky operations</p> </li> <li> <p>Limited to Shell Tool: Only works for shell tool calls</p> </li> <li>Direct file tool writes not previewed</li> <li> <p>HTTP requests not previewed</p> </li> <li> <p>English Only: Descriptions and UI in English only</p> </li> </ol>"},{"location":"user-guide/safety-features/#future-enhancements","title":"Future Enhancements","text":"<ul> <li> Semantic command analysis (understand intent, not just pattern)</li> <li> Preview for file writes (show diff before writing)</li> <li> Preview for HTTP requests (show what will be sent)</li> <li> Configurable sensitivity levels</li> <li> Custom pattern definitions</li> <li> Integration with <code>trash</code> for recoverable deletion</li> <li> Backup before destructive operations</li> <li> Multi-language support</li> </ul>"},{"location":"user-guide/safety-features/#related-documentation","title":"Related Documentation","text":"<ul> <li>Tool Calling Guide - How LLMs use tools</li> <li>Shell Tool Reference - Shell tool details</li> <li>Command Examples - Real-world usage</li> </ul>"},{"location":"user-guide/safety-features/#faq","title":"FAQ","text":"<p>Q: Can I disable the preview? A: Not currently. Safety features are always on. Future versions may add configuration.</p> <p>Q: What if I want to bypass the preview for a specific command? A: You can press Enter to execute anyway. The preview is informational, not blocking.</p> <p>Q: How do I report a missing dangerous pattern? A: Open an issue on GitHub with the command that should be detected.</p> <p>Q: Can I add custom patterns? A: Not yet, but it's planned for a future release.</p> <p>Q: Does this prevent all mistakes? A: No. It's a safety net, not a guarantee. Always review commands and maintain backups.</p>"}]}